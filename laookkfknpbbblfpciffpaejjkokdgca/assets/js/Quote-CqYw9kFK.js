import{computed as t}from"./reactiveCustomization-l1DAJU8W.js";import{I as e,r as o,G as s,A as i}from"./index-B9SbLlJ5.js";import{u as r}from"./useAllComponentsMounted-jOG8AT3X.js";import{s as a}from"./showAnyway-Bb-tkUYJ.js";import{B as n}from"./BaseDropdownOption-NzB_bdFk.js";import{B as d}from"./BaseDropdownDivider-Bay0Demn.js";import{B as c}from"./BaseDropdown-DNbKWQaF.js";import{a as u}from"./modal-DQlfZdMt.js";import{U as l}from"./enums-C0TfsRui.js";import p from"./AppContainer-BbrPMYLy.js";import{S as h}from"./settingsViewState-5xgdbrfZ.js";import{e as v}from"./DataSyncService-BIQVYvDv.js";import g from"./BaseIcon-CAXE-xBw.js";import{a as f,D as w}from"./constants-CALDQiUE.js";import{n as b}from"./_plugin-vue2_normalizer-DeUNqxFl.js";import"./Logger-BTKFyPnc.js";import"./style-cpFB66wV.js";import"./VueBase-BB-58KAg.js";import"./_commonjsHelpers-B3K3fdV-.js";import"./ClickOutside-DCLvi2fj.js";import"./pinia-4ulFHh2N.js";import"./portal-vue.esm-BlbL0ibK.js";import"./BaseDropdownContent-BfXd6hD-.js";import"./index-CbkRD371.js";import"./icon-ellipsis-D7nTOXaQ.js";import"./ViewState-CaQI4PuO.js";import"./appZStack-Duidf5Sm.js";import"./dynamic-import-helper-DIl3ayLm.js";const k=Backbone.Model.extend({defaults:{_id:"",body:"",source:"",is_custom:!1,detail_url:"",twitter:""},idAttribute:"forDate"}),y=m.models.FeedManager.extend({initialize:function(){m.models.FeedManager.prototype.initialize.call(this,m.models.Quote,"quote")}}),D=Backbone.Collection.extend({localStorage:new Backbone.LocalStorage("momentum-quote"),model:m.models.Quote,getActiveItem:function(){if(this.length>0){let t=m.utils.getDateString();return this.get(t)}}});var _=(t=>(t.BlueSky="bluesky",t.LinkedIn="linkedin",t.Reddit="reddit",t.Threads="threads",t.X="x",t))(_||{});const S=new i({feature:"quotes"});const q=b(e({name:"ShareDropdown",components:{BaseDropdown:c,BaseDropdownOption:n,BaseIcon:g},props:{quote:{type:Object,required:!0},isCustom:{type:Boolean,default:!1}},setup:()=>({DropdownPosition:f,DropdownAlignment:w,shareDropdown:o(),SharePlatform:_}),methods:{closeDropdown(){var t;null==(t=this.shareDropdown)||t.closeDropdown()},getShareText(t={}){const e=this.quote.get("body"),{includeAttribution:o=!0,platform:s=null}=t;let i=`“${e}”`;if(this.quote.get("twitter")?i+=` – @${this.quote.get("twitter")}`:this.quote.get("source")&&(i+=` – ${this.quote.get("source")}`),o)switch(s){case _.BlueSky:i+=" via @momentumdash.bsky.social";break;case _.Reddit:i+=" via r/MomentumDash";break;default:i+=" via @momentumdash"}return i},getShareLink(t){switch(t){case _.BlueSky:return`https://bsky.app/intent/compose?text=${encodeURIComponent(this.getShareText({platform:_.BlueSky}))}`;case _.LinkedIn:return`https://www.linkedin.com/feed/?shareActive=true&text=${encodeURIComponent(this.getShareText())}`;case _.Reddit:return`https://www.reddit.com/submit?title=${encodeURIComponent(this.getShareText({platform:_.Reddit}))}`;case _.Threads:return`https://www.threads.net/intent/post?text=${encodeURIComponent(this.getShareText({platform:_.Threads}))}`;case _.X:return`https://x.com/intent/tweet?text=${encodeURIComponent(this.getShareText({includeAttribution:!1}))}&via=momentumdash&related=momentumdash,levibucsis`}},share(t){this.closeDropdown();const e=this.getShareLink(t);s(e),this.captureShareAnalytics(t)},captureShareAnalytics(t){S.capture("quote share",{custom:this.isCustom,platform:t})}}}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("base-dropdown",{ref:"shareDropdown",attrs:{"container-class":"dash",position:t.DropdownPosition.Right,alignment:t.DropdownAlignment.Center,nipple:!1,"position-offset":-5},scopedSlots:t._u([{key:"toggle",fn:function(){return[e("base-dropdown-option",{attrs:{"data-test":"share"}},[e("base-icon",{attrs:{src:"share"}}),t._v(" Share ")],1)]},proxy:!0}])},[e("base-dropdown-option",{attrs:{"data-test":"share-bluesky"},on:{click:function(e){return t.share(t.SharePlatform.BlueSky)}}},[e("base-icon",{attrs:{src:"icon/social/bluesky"}}),t._v(" Bluesky ")],1),e("base-dropdown-option",{attrs:{"data-test":"share-linkedin"},on:{click:function(e){return t.share(t.SharePlatform.LinkedIn)}}},[e("base-icon",{attrs:{src:"icon/social/linkedin"}}),t._v(" LinkedIn ")],1),e("base-dropdown-option",{attrs:{"data-test":"share-reddit"},on:{click:function(e){return t.share(t.SharePlatform.Reddit)}}},[e("base-icon",{attrs:{src:"icon/social/reddit"}}),t._v(" Reddit ")],1),e("base-dropdown-option",{attrs:{"data-test":"share-threads"},on:{click:function(e){return t.share(t.SharePlatform.Threads)}}},[e("base-icon",{attrs:{src:"icon/social/threads"}}),t._v(" Threads ")],1),e("base-dropdown-option",{attrs:{"data-test":"share-x"},on:{click:function(e){return t.share(t.SharePlatform.X)}}},[e("base-icon",{attrs:{src:"icon/social/x"}}),t._v(" X ")],1)],1)}),[],!1,null,null).exports,Q=new i({feature:"quotes"});m.models.Quote=k,m.collect.Quotes=D,m.collect.quotes=new D,m.models.QuoteManager=y,m.models.quoteManager=new y;const C=b({name:"Quote",components:{AppContainer:p,BaseDropdown:c,BaseDropdownDivider:d,BaseDropdownOption:n,BaseIcon:g,ShareDropdown:q},bb:()=>({collection:m.collect.quotes}),setup:()=>({...r(),debouncedHover:null}),data:()=>({activeQuoteId:"",skipping:!1,dropdownActive:!1,quoteOverride:""}),computed:{showAnyway:()=>a.includes("quote"),quoteVisible:()=>t.quoteVisible,activeQuote(){return this.quoteOverride||this.collection.get(this.activeQuoteId)},quoteUuid(){return this.activeQuote?this.activeQuote.get("_id"):""},isCustom(){return!!this.activeQuote&&this.activeQuote.get("is_custom")},body(){return this.activeQuote?`“${this.activeQuote.get("body")}”`:""},bodyArray(){return this.body.split(" ")},source(){return this.activeQuote?this.activeQuote.get("source"):""},detailUrl(){return this.activeQuote?this.activeQuote.get("detail_url"):""},isFavorite(){return!!this.activeQuote&&this.activeQuote.get("is_favorite")}},created(){m.models.quoteManager.firstFetch(),this.setQuote(),m.on("newDay",this.setQuote),m.collect.quotes.on("reset add change sync refresh",this.setQuote),m.on("quote:override",this.overrideQuote),m.trigger("quote:created")},destroyed(){m.off("newDay",this.setQuote),m.collect.quotes.off("reset add change sync refresh",this.setQuote),m.off("quote:override",this.overrideQuote)},methods:{overrideQuote(t){this.quoteOverride=t?{body:t,forDate:m.utils.getDateString(),_id:m.utils.uuidv4(),get(t){return this[t]}}:null},handleClick(){var t;this.$touch&&(null==(t=this.$refs.settingsDropdown)||t.openDropdown()),this.detailUrl&&this.detailUrl.length>0&&s(this.detailUrl)},captureDebouncedHover(t){const e=t.target;this.cancelDebouncedHoverCapture(),this.debouncedHover=setTimeout((()=>{e.matches(":hover")&&Q.capture("quote hover",{custom:this.isCustom})}),1e3)},cancelDebouncedHoverCapture(){clearTimeout(this.debouncedHover)},toggleFavorite(){let t=this.activeQuote.is_favorite=!this.isFavorite;m.models.quoteManager.toggleFavorite(t).catch((()=>this.activeQuote.is_favorite=!t)),Q.capture("quote "+(t?"fav":"unfav"),{custom:this.isCustom,location:"dash"})},skipQuote(){var t;if(!this.$plus)return null==(t=this.$refs.settingsDropdown)||t.closeDropdown(),void u(l.QUOTES,"dash");this.skipping||(this.skipping=!0,setTimeout((()=>{m.models.quoteManager.skipItem().finally((()=>{this.skipping=!1})),Q.capture("quote skip",{is_paid_event:!0,custom:this.isCustom})}),450))},setQuote(){this.activeQuoteId=this.getActiveQuote()},getActiveQuote(){let t;return this.collection.length>0&&(t=this.collection.getActiveItem()),t?(m.trigger("quote:downloaded"),t.id):(m.trigger("sync:download","quote"),"")},openSettings(){var t;null==(t=this.$refs.settingsDropdown)||t.closeDropdown(),v.$emit("settings:open",h.Quotes)},openDropdown(){var t;null==(t=this.$refs.settingsDropdown)||t.openDropdown()},onDropdownToggle(t){this.dropdownActive=t},access:m.utils.access}},(function(){var t=this,e=t._self._c;return e("app-container",{attrs:{"app-name":"quote","data-test":"quote"},nativeOn:{mouseenter:function(e){return t.captureDebouncedHover.apply(null,arguments)},mouseleave:function(e){return t.cancelDebouncedHoverCapture.apply(null,arguments)},click:function(e){return e.preventDefault(),t.handleClick(e)},dblclick:function(e){return t.openDropdown.apply(null,arguments)}}},[e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.activeQuote?e("div",{key:t.quoteUuid,staticClass:"app-dash dark",class:{active:t.dropdownActive},attrs:{"data-test":"app-dash"}},[e("p",{staticClass:"body"},[e("span",{staticClass:"body-text",attrs:{"data-test":"body-text"}},[t._v(t._s(t.body))])]),e("div",{staticClass:"below",attrs:{"data-test":"below"}},[t.source?e("span",{staticClass:"source u--mobile-hide",attrs:{"data-test":"source"}},[t._v(t._s(t.source))]):t._e(),e("base-dropdown",{ref:"settingsDropdown",attrs:{"container-class":"dash","data-test":"settings-dropdown","mobile-toggle-hidden":!0},on:{toggle:t.onDropdownToggle},scopedSlots:t._u([{key:"toastHeader",fn:function(){return[e("div",{staticClass:"toast-title",attrs:{"data-test":"body-text"}},[t._v(t._s(t.body))]),t.source?e("div",{staticClass:"toast-source",attrs:{"data-test":"source"}},[t._v("– "+t._s(t.source))]):t._e()]},proxy:!0}],null,!1,3597242828)},[e("base-dropdown-option",{attrs:{"data-test":"favorite"},on:{click:t.toggleFavorite}},[e("base-icon",{class:{active:t.isFavorite},attrs:{src:t.isFavorite?"heart-off":"heart","data-test":"favorite-icon"}}),t._v(" "+t._s(t.isFavorite?"Unfavorite":"Favorite")+" ")],1),e("base-dropdown-option",{attrs:{"data-test":"skip"},on:{click:t.skipQuote}},[e("base-icon",{attrs:{src:"redo"}}),t._v(" Skip to new quote "),t.$plus?t._e():e("span",{staticClass:"badge badge-plus"},[t._v("PLUS")])],1),e("share-dropdown",{attrs:{quote:t.activeQuote,"is-custom":t.isCustom}}),e("base-dropdown-divider"),e("base-dropdown-option",{attrs:{"data-test":"manage"},on:{click:t.openSettings}},[e("base-icon",{attrs:{src:"icon/apps/quotes"}}),t._v(" Manage quotes ")],1),e("base-dropdown-divider"),e("base-dropdown-option",{attrs:{"data-test":"settings"},on:{click:t.openSettings}},[e("base-icon",{attrs:{src:"icon/apps/settings"}}),t._v(" Settings ")],1)],1)],1)]):t._e()])],1)}),[],!1,null,"57a48210").exports;export{C as default};