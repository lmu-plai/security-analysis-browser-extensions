import{D as e,M as t,d as a}from"./DataSyncService-BIQVYvDv.js";import{u as i}from"./Logger-BTKFyPnc.js";import{E as s}from"./ErrorPulseInput-CkNsRuJq.js";import{L as r,a9 as d,aa as l,V as o}from"./index-B9SbLlJ5.js";import{E as n,f as c,g as u}from"./constants-3_GhJRHQ.js";import{c as h}from"./compareObjects-R6Hcs7xe.js";class m{constructor(e){this.dataSyncService=e}get(e){this.dataSyncService.get(e)}create(e){return this.dataSyncService.create(e.id,e)}update(e,t){return this.dataSyncService.update(e,t)}delete(e){return this.dataSyncService.delete(e)}}class p{constructor(e){this.dataSyncService=e}get(e){this.dataSyncService.get(e)}create(e){return this.dataSyncService.create(e.id,e)}update(e,t){return this.dataSyncService.update(e,t)}delete(e){return this.dataSyncService.delete(e)}}const f=()=>({siteBlockerGroupsService:new m(new e("siteBlockerGroups",{mode:t.Timestamp,queueKey:"siteBlocker",path:"site-blocker/groups"})),siteBlockerWebsitesService:new p(new e("siteBlockerWebsites",{mode:t.Timestamp,queueKey:"siteBlocker",path:"site-blocker/websites"}))});class g{constructor({id:e=i(),name:t="",order:a,enabled:s=!0,defaultKey:r="",defaultDeleted:d=!1,totalWebsites:l=0}){this.id=e,this.name=t,this.enabled=s,this.defaultKey=r,this.defaultDeleted=d,this.totalWebsites=l,this.order=a}validate(){if(""===this.name)throw new s("name-input")}}class w{constructor({id:e=i(),url:t="",name:a="",order:s,enabled:r=!0,groupId:d,defaultKey:l="",defaultDeleted:o=!1}){this.id=e,this.name=a,this.url=t,this.enabled=r,this.groupId=d,this.defaultKey=l,this.defaultDeleted=o,this.order=s}validate(){if(""===this.name)throw new r({message:n.NameEmpty,input:"name-input"});if(""===this.url)throw new r({message:n.UrlEmpty,input:"url-input"});if(!d(l(this.urlWithReplacedWildcard)))throw new r({message:n.UrlInvalid,input:"url-input"});if(this.url.includes(" "))throw new r({message:n.UrlSpaces,input:"url-input"});if(this.url.includes("/"))throw new r({message:n.UrlPaths,input:"url-input"});const e=this.url.split("").filter((e=>"*"===e)).length;if(e>1||1===e&&!this.url.endsWith(".*"))throw new r({message:n.UrlWildcard,input:"url-input"})}get urlWithReplacedWildcard(){return this.url.replace(".*",".com")}get hostWithWildcard(){const e=new URL(l(this.urlWithReplacedWildcard)).host;return this.url.endsWith(".*")?e.replace(".com",".*"):e}}const b=(e,t)=>Object.values(t).find((t=>t.id===e.groupId||t.defaultKey===e.groupId)),v=(e=f().siteBlockerWebsitesService)=>a("siteBlockerWebsites",{state:()=>({data:{},loaded:!1,loading:!1,activeItem:null}),getters:{getWebsitesByGroup:e=>t=>(e=>{const t=Object.values(e);return Object.values(c).reduce(((e,a)=>(t.some((e=>e.defaultKey===a.defaultKey))||e.push(a),e)),t).filter((e=>!e.defaultDeleted))})(e.data).filter((e=>e.groupId===t.id||e.groupId===t.defaultKey)).sort(((e,t)=>t.order-e.order)).map((e=>new w(e))),activeItemHasChanges(e){if(!e.activeItem)return!1;const t=e.data[e.activeItem.id];return t?Object.keys(h(t,e.activeItem)).length>0:""!==e.activeItem.url||""!==e.activeItem.name},getWebsiteOrDefaultFromId:e=>t=>e.data[t]??c[t]},actions:{clearActiveItem(){this.activeItem=null},newItem(e){this.activeItem||(this.activeItem=new w({groupId:e.id,order:this.getWebsitesByGroup(e).length}))},editItem(e){const t=this.getWebsiteOrDefaultFromId(e);if(!t)throw new r({message:`No Site Blocker website found with id: ${e}`});this.activeItem=new w(t)},refresh(){this.loading||this.loaded||(this.loading=!0,e.get({success:e=>{this.data=Object.fromEntries(e.map((e=>[e.id,e]))),this.loading=!1,this.loaded=!0},failure:()=>{this.loading=!1}}))},async create(t){o.set(this.data,t.id,t);const a=W(),i=b(t,a.data),s=b(t,u);!i&&s&&await a.create({...s}),i?t.groupId=i.id:s&&(t.groupId=s.id),await e.create(t)},async update(t,a){const i=c[t];if(!this.data[t]&&i)return this.create({...i,...a});const s=this.data[t];if(!s)throw new r({message:`No Site Blocker website found with id: ${t}`});o.set(this.data,t,{...s,...a}),await e.update(t,a)},async delete(t){const a=c[t];if(!this.data[t]&&a)return this.update(t,{defaultDeleted:!0});this.data[t]&&(o.delete(this.data,t),await e.delete(t))}}}),y=v(),S=Object.freeze(Object.defineProperty({__proto__:null,default:y,makeSiteBlockerWebsitesStore:v},Symbol.toStringTag,{value:"Module"})),I=(e=f().siteBlockerGroupsService)=>a("siteBlockerGroups",{state:()=>({data:{},loaded:!1,loading:!1,activeItem:null}),getters:{items(e){const t=y();return(e=>{const t=Object.values(e);return Object.values(u).reduce(((e,a)=>(t.some((e=>e.defaultKey===a.defaultKey))||e.push(a),e)),t).filter((e=>!e.defaultDeleted))})(e.data).sort(((e,t)=>t.order-e.order)).map((e=>new g({...e,totalWebsites:t.getWebsitesByGroup(e).length})))},getGroupOrDefaultFromId:e=>t=>e.data[t]??u[t]},actions:{clearActiveItem(){this.activeItem=null},newItem(){this.activeItem||(this.activeItem=new g({order:this.items.length}))},editItem(e){const t=this.getGroupOrDefaultFromId(e);if(!t)throw new r({message:`No Site Blocker group found with id: ${e}`});const a=y();this.activeItem=new g({...t,totalWebsites:a.getWebsitesByGroup(t).length})},refresh(){this.loading||this.loaded||(this.loading=!0,e.get({success:e=>{this.data=Object.fromEntries(e.map((e=>[e.id,e]))),this.loading=!1,this.loaded=!0},failure:()=>{this.loading=!1}}))},async create(t){o.set(this.data,t.id,t),await e.create(t)},async update(t,a){const i=u[t];if(!this.data[t]&&i)return this.create({...i,...a});const s=this.data[t];if(!s)throw new r({message:`No Site Blocker group found with id: ${t}`});o.set(this.data,t,{...s,...a}),await e.update(t,a)},async delete(t){const a=this.getGroupOrDefaultFromId(t);if(!a)return;const i=y();if(await Promise.all([i.getWebsitesByGroup(a).map((e=>i.delete(e.id)))]),a.defaultKey)return this.update(t,{defaultDeleted:!0});o.delete(this.data,t),await e.delete(t)}}}),W=I(),k=Object.freeze(Object.defineProperty({__proto__:null,default:W,makeSiteBlockerGroupsStore:I},Symbol.toStringTag,{value:"Module"}));export{g as S,y as a,k as b,S as s,W as u};