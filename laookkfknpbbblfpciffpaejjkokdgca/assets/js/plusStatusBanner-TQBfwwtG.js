import{M as e,d as t}from"./DataSyncService-BIQVYvDv.js";import{S as i,a as s,u as a}from"./SubscriptionSummary-DTKaK_m5.js";import{a as r}from"./index-B9SbLlJ5.js";import{p as n}from"./persistStore-C6CQfgEA.js";const l="plusStatusBanner:trial:dismissed",o="plusStatusBanner:expired:dismissed",u="plusStatusBanner:pastDue:dismissed",d=n((({loadedRef:e,loadingRef:s,refresh:a})=>t("teamSubscriptionSummary",{state:()=>({active:!1,error:null,firstSubscriptionStart:null,hasPaymentMethod:!1,intent:null,pastDue:!1,subscriptionEnd:null,trialEnd:null,trialing:!1}),getters:{loaded:()=>e.value,loading:()=>s.value,status:e=>e.trialing&&e.hasPaymentMethod?i.TrialingCard:e.trialing&&!e.hasPaymentMethod?i.TrialingCardless:e.pastDue?i.PastDue:e.active?i.Plus:e.subscriptionEnd?i.ExpiredPlus:e.trialEnd?i.ExpiredTrial:i.Free,trialRemainingDays:e=>r.dateDiffIntegerDays(Date.now(),e.trialEnd??Date.now()),subscriptionDaysElapsed:e=>e.firstSubscriptionStart?r.dateDiffIntegerDays(new Date(e.firstSubscriptionStart),new Date)+1:0,expired(){return[i.ExpiredPlus,i.ExpiredTrial].includes(this.status)}},actions:{refresh(t=!1){if(m.conditionalFeatures.featureEnabled("team")||m.conditionalFeatures.featureEnabled("team-read-only"))return a(t);e.value=!0}}})),{path:"team/subscription_summary",mode:e.TimestampStrict}),D=t("plusStatusBanner",{state:()=>({trialDismissedDate:Number(localStorage.getItem(l)??0),pastDueDismissedDate:Number(localStorage.getItem(u)??0),expiredDismissedDate:Number(localStorage.getItem(o)??0)}),getters:{trialVisible(e){const t=this.activeSubscriptionSummaryStore;return t.status===i.TrialingCardless&&t.trialRemainingDays<=2&&!t.hasPaymentMethod&&r.dateDiffIntegerDays(e.trialDismissedDate,Date.now())>=1},expiredVisible(e){return this.activeSubscriptionSummaryStore.expired&&!e.expiredDismissedDate},requiresActionVisible(){var e;return(null==(e=this.activeSubscriptionSummaryStore.intent)?void 0:e.status)===s.RequiresAction},pastDueVisible(e){return this.activeSubscriptionSummaryStore.status===i.PastDue&&r.dateDiffIntegerDays(e.pastDueDismissedDate,Date.now())>=4},bannerVisible(){const e=this.activeSubscriptionSummaryStore;return e.loaded&&!e.loading&&(this.trialVisible||this.expiredVisible||this.requiresActionVisible||this.pastDueVisible)},bannerDismissDisabled(){return this.requiresActionVisible},trialDaysText(){const e=this.activeSubscriptionSummaryStore;return`${e.trialRemainingDays} day${1!==e.trialRemainingDays?"s":""}`},activeSubscriptionSummaryStore(){var e;const t=null==(e=m.models.teamInfo)?void 0:e.get("team");return(null==t?void 0:t.userIsAdmin)?d():a()}},actions:{dismissTrialBannerForDay(){const e=Date.now();localStorage.setItem(l,String(e)),this.trialDismissedDate=e},dismissExpiredBannerIndefinitely(){const e=Date.now();localStorage.setItem(o,String(e)),this.expiredDismissedDate=e},dismissPastDueBanner(){const e=Date.now();localStorage.setItem(u,String(e)),this.pastDueDismissedDate=e}}});export{D as u};