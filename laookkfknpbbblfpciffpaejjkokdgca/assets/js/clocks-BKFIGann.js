import{d as e,M as t}from"./DataSyncService-BIQVYvDv.js";import{E as s,M as i,p as a}from"./errors-CZrPVA9A.js";import{u as n,t as o,a as r}from"./Logger-BTKFyPnc.js";import{B as d}from"./BaseMetric-ClLQP9bU.js";import{computed as c}from"./reactiveCustomization-l1DAJU8W.js";import{L as h,f,V as l,u,C as p}from"./index-B9SbLlJ5.js";import{c as g}from"./compareObjects-R6Hcs7xe.js";import{P as w}from"./pinia-4ulFHh2N.js";class v{constructor({id:e=n(),timeZoneId:t="",timeZoneName:s="",currentOffset:i=0,name:a="",pinned:o=!1,isTeam:r=!1,archived:m=!1,readOnly:d=!1,icon:c}){this.id=e,this.timeZoneId=t,this.timeZoneName=s,this.currentOffset=i,this.name=a,this.pinned=o,this.isTeam=r,this.archived=m,this.readOnly=d,this.icon=c??"globe"}compare(e){return g((null==e?void 0:e.serialize())??new v({id:this.id}).serialize(),this.serialize())}validate(){if(""===this.timeZoneId||""===this.timeZoneName)throw new h({message:s.TimezoneEmpty,input:"timezone"});if(""===this.name)throw new h({message:s.NameEmpty,input:"name"});if(this.name.length>i)throw new h({message:s.NameTooLong,input:"name"})}serialize(){return{...this}}get type(){return d.Clock}get displayTooltip(){return this.difference}get displayValue(){return this.time}get date(){return m.models.date}get offset(){return this.currentOffset}set offset(e){this.currentOffset=e}get offsetDate(){const e=new Date(this.date.get("date"));return this.offset&&e.setUTCSeconds(e.getUTCSeconds()+this.offset),e}get time(){const e=this.offsetDate.getUTCHours(),t=o(this.offsetDate.getUTCMinutes());return c.hour12clock?`${e>12?e-12:0===e?12:e}:${t}${e>=12?"p":"a"}`:`${e<10?0:""}${e}:${t}`}get difference(){const e=this.date.get("date"),t=this.offsetDate,s=e.getDate()==t.getUTCDate()?"Today":e.getDate()+1==t.getUTCDate()?"Tomorrow":"Yesterday",i=e.getTime(),a=t.getTime()+60*t.getTimezoneOffset()*1e3,n=a>i?(a-i)/f.msPerHour:(i-a)/f.msPerHour;return s+", "+(i>a?"-":"+")+(n%1!=0?Math.round(10*n)/10:Math.round(n))+" hrs"}get timezone(){return{name:this.name,timeZoneName:this.timeZoneName,timeZoneId:this.timeZoneId,offset:this.offset}}set timezone(e){this.name||(this.name=e.name),this.timeZoneName=e.timeZoneName,this.timeZoneId=e.timeZoneId,this.offset=e.offset}}const I=((s=a().clocksService)=>{const i=e("clocks",{plugins:[w.MockData],state:()=>({data:{},loading:!1,loaded:!1,activeItem:null,randomItems:[]}),getters:{items:e=>Object.values(e.data).filter((e=>!e.archived)).map((e=>new v(e))).sort(((e,t)=>e.offset-t.offset)).sort(((e,t)=>+t.pinned-+e.pinned)),unpinnedItems:e=>Object.values(e.data).filter((e=>!e.archived&&!e.pinned)).map((e=>new v(e))),pinnedItems:e=>Object.values(e.data).filter((e=>!e.archived&&e.pinned)).map((e=>new v(e))).sort(((e,t)=>t.offset-e.offset)),archivedItems:e=>Object.values(e.data).filter((e=>e.archived)).map((e=>new v(e))),getItemById(e){const t=e.data;return e=>{const s=t[e];if(s)return new v(s)}},showRandom(){return 0===this.pinnedItems.length||!!c["showRandomMetric-clock"]}},actions:{clearActiveItem(){this.activeItem=null},setRandomItems(){!this.showRandom||this.unpinnedItems.length<=0?this.randomItems=[]:this.randomItems=[r(this.unpinnedItems)]},newItem(){this.activeItem||(this.activeItem=new v({}))},editItem(e){const t=this.data[e];if(!t)throw new h({message:`No clock found with id: ${e}`});this.activeItem=new v(t)},refresh(e){!(null==e?void 0:e.force)&&(this.loading||this.loaded&&!(null==e?void 0:e.archived))||(this.loading=!0,s.get({success:e=>{this.data=Object.fromEntries(e.map((e=>[e.id,e]))),this.loaded=!0,this.loading=!1},failure:()=>{this.loading=!1},...(null==e?void 0:e.archived)&&{queryParams:{includeArchived:"true"},mode:t.Server}}))},async create(e){l.set(this.data,e.id,e),await s.create(e)},async update(e,t){const i=this.data[e];if(!i)throw new h({message:`No clock found with id: ${e}`});l.set(this.data,e,{...i,...t}),await s.update(e,t)},async delete(e){l.delete(this.data,e),await s.delete(e)},async openItemOnTeamSite(e){let t=await s.getMetricServerId(e);t.toUpperCase().startsWith("T")&&(t=t.substring(1)),m.commandManager.execute("window.account.open.login",`/team/clocks?id=${t}`)}}});return(async()=>{const e=i();await u((()=>e.loaded)).toBe(!0),p((()=>e.showRandom),(()=>{e.setRandomItems()}))})(),i})(),y=Object.freeze(Object.defineProperty({__proto__:null,default:I,useClocksStore:I},Symbol.toStringTag,{value:"Module"}));export{v as C,y as c,I as u};