import{M as t}from"./Message-D0Rc36LQ.js";import{V as a,r as i,A as n}from"./index-B9SbLlJ5.js";import{V as s}from"./VueBase-BB-58KAg.js";import{u as e}from"./useAllComponentsMounted-jOG8AT3X.js";import{persistent as r}from"./reactiveCustomization-l1DAJU8W.js";import{T as o}from"./index-DQnUe-E8.js";import{s as p}from"./showAnyway-Bb-tkUYJ.js";import{a as d}from"./modal-DQlfZdMt.js";import{U as c}from"./enums-C0TfsRui.js";import{B as l}from"./BaseDropdownOption-NzB_bdFk.js";import g from"./BaseIcon-CAXE-xBw.js";import{B as u}from"./BaseDropdownDivider-Bay0Demn.js";import{B as h}from"./BaseDropdown-DNbKWQaF.js";import{e as f}from"./DataSyncService-BIQVYvDv.js";import{S as v}from"./settingsViewState-5xgdbrfZ.js";import{n as w}from"./_plugin-vue2_normalizer-DeUNqxFl.js";import"./MobileBlur-B2s9dLKD.js";import"./Logger-BTKFyPnc.js";import"./style-cpFB66wV.js";import"./_commonjsHelpers-B3K3fdV-.js";import"./ClickOutside-DCLvi2fj.js";import"./pinia-4ulFHh2N.js";import"./portal-vue.esm-BlbL0ibK.js";import"./localStorage-B4mFdj8F.js";import"./legacyUserMigration-BBmM2Q1F.js";import"./migrateLegacyUserMessageHandler-BMN9RYlR.js";import"./auth-B1eW30AJ.js";import"./persistStore-C6CQfgEA.js";import"./embeddedApp-K-x6feEl.js";import"./experiments-CUd_VD1Q.js";import"./flashMessageQueue-swNUH1jF.js";import"./info-DdD9a7JK.js";import"./constants-Bt_TxKWw.js";import"./dynamic-import-helper-DIl3ayLm.js";import"./index-CDlxyr_L.js";import"./appZStack-Duidf5Sm.js";import"./ResizeSensor-ZXOsDHeC.js";import"./promisifiedChrome-vGTrjPj6.js";import"./modal-CUt-4jrz.js";import"./constants-CALDQiUE.js";import"./BaseDropdownContent-BfXd6hD-.js";import"./index-CbkRD371.js";import"./icon-ellipsis-D7nTOXaQ.js";import"./ViewState-CaQI4PuO.js";a.use(s);const j=new(a.extend({name:"MantraManager",manager:m.models.mantraManager,bb:()=>({mantras:m.collect.mantras,mantraSettings:m.models.mantraSettings}),computed:{pinned(){return this.mantraSettings?this.mantraSettings.pinnedMantra:null},active(){let t;if(this.pinned)return t=this.mantras.findWhere({forDate:"pinned"}),t&&t.get("_id")===this.pinned.id?t:null;if(this.mantras&&this.isEnabled()){if(t=this.mantras.getActiveItem(),!t)return m.trigger("sync:download","mantra"),null;if(t.get("hardSkip"))return null}return t}},watch:{active(t){!t&&this.pinned&&this.mantras.create({forDate:"pinned",_id:this.pinned.id,body:this.pinned.body,is_custom:this.pinned.isCustom,is_favorite:this.pinned.isFavorite})}},methods:{isEnabled:function(){return this.$options.manager.isEnabled()},pinMantra:function(t,a){this.$options.manager.pinMantra(t,a)},toggleFav:function(t){this.$options.manager.toggleFav(t)},skipItem:function(t){return this.$options.manager.skipItem(t)},getMantraForDisplay:function(t,a){return this.$options.manager.getMantraForDisplay(t,a)},markGreetingAsSeenToday:function(){this.$options.manager.markGreetingAsSeenToday()}}})),y=new n({feature:"mantra"});const k=w({name:"Mantra",components:{BaseDropdownDivider:u,BaseIcon:g,BaseDropdownOption:l,BaseDropdown:h,ThreeColLayout:o,Message:t},props:{mantraOverride:{type:String,default:""}},setup:()=>({...e(),showAnyway:p,dropdown:i()}),data:()=>({editingName:!1,skipping:!1,useLastShowName:!1}),computed:{isFavorite(){return this.mantra&&this.mantra.activeMantra&&this.mantra.activeMantra.get("is_favorite")},isPinned(){return this.mantra&&this.mantra.activeMantra&&this.mantra.activeMantra.isPinned()},isCustom(){return this.mantra&&this.mantra.activeMantra&&this.mantra.activeMantra.get("is_custom")},mantra(){if(this.mantraOverride)return{activeMantra:"",content:this.mantraOverride,name:"",punctuation:""};const t=j.active,a=j.getMantraForDisplay(t,this.useLastShowName);return a?{activeMantra:t,content:a.start,name:a.name,punctuation:a.end||"."}:{activeMantra:"",content:" ",name:"",punctuation:""}},skipOrSkipping(){return this.skipping?"Skipping…":"Skip mantra"},pinOrUnpin(){return this.isPinned?"Unpin":"Pin"}},watch:{mantra(){this.useLastShowName=!0}},mounted(){m.trigger("mantra:mounted")},methods:{toggleDropdown(t){var a;this.$emit("stop-cycle",t),m.trigger("mantra:dropdown:visible",t),null==(a=this.dropdown)||a.openDropdown()},openMantraSettings(){var t;this.editingName||(f.$emit("settings:open",v.Mantras),null==(t=this.dropdown)||t.closeDropdown())},toggleFavorite(){j.toggleFav(this.mantra.activeMantra),y.capture("mantra "+(this.isFavorite?"fav":"unfav"),{location:"dash",custom:this.isCustom})},togglePin(){if(!this.$plus)return void d(c.MANTRAS,"dash");y.capture("mantra "+(this.isPinned?"unpin":"pin"),{location:"dash",custom:this.isCustom,is_paid_event:!0});const t=this.mantra.name===r.displayname;j.pinMantra(this.mantra.activeMantra,t)},skip(){if(this.$plus){if(!this.mantra.activeMantra)return m.trigger("sync:download","mantra"),void this.$emit("show-greeting");y.capture("mantra skip",{custom:this.isCustom,is_paid_event:!0}),this.skipping=!0,j.skipItem().finally((()=>{var t;null==(t=this.dropdown)||t.closeDropdown(),this.skipping=!1}))}else d(c.MANTRAS,"dash")},dontShowAgain(){j.skipItem(!0).finally((()=>{var t;null==(t=this.dropdown)||t.closeDropdown(),this.$plus||this.$emit("show-greeting")})),y.capture("mantra don't show again")},editing(t){this.$emit("stop-cycle",t),this.editingName=t},onEditNameClick(){var t;this.editingName=!0,null==(t=this.dropdown)||t.closeDropdown(),n.capture("display name change",{feature:"profile"})}}},(function(){var t=this,a=t._self._c;return a("three-col-layout",{directives:[{name:"mobile-click",rawName:"v-mobile-click",value:t.toggleDropdown.bind(null,!0),expression:"toggleDropdown.bind(null, true)"}],staticClass:"app-container has-dash-icon greeting",class:{"show-anyway":t.showAnyway.includes("greeting")},attrs:{"data-show-anyway":"greeting","data-test":"mantra"},scopedSlots:t._u([{key:"center",fn:function(){return[a("message",{attrs:{message:t.mantra,"editing-name":t.editingName},on:{editing:t.editing,toggle:t.toggleDropdown}})]},proxy:!0},{key:"right",fn:function(){return[a("base-dropdown",{ref:"dropdown",attrs:{"container-class":"dash","data-test":"more-toggle"},scopedSlots:t._u([{key:"toggle",fn:function(){return[a("div",{staticClass:"icon-wrapper dark dark-full"},[a("base-icon",{staticClass:"icon",attrs:{src:"icon-ellipsis",size:"18px"}})],1)]},proxy:!0}])},[a("base-dropdown-option",{attrs:{"data-test":"favorite"},on:{click:t.toggleFavorite}},[a("base-icon",{attrs:{src:t.isFavorite?"heart-off":"heart"}}),a("span",[t._v(t._s(t.isFavorite?"Unfavorite":"Favorite"))])],1),a("base-dropdown-option",{attrs:{"data-test":"pin"},on:{click:t.togglePin}},[a("base-icon",{attrs:{src:t.isPinned?"pin-off":"pin"}}),a("span",[t._v(t._s(t.pinOrUnpin))])],1),a("base-dropdown-option",{attrs:{disabled:t.skipping,"data-test":"skip"},on:{click:t.skip}},[a("base-icon",{attrs:{src:"redo-dot"}}),a("span",[t._v(t._s(t.skipOrSkipping))])],1),t.isCustom?t._e():a("base-dropdown-option",{attrs:{"data-test":"dont-show-again"},on:{click:t.dontShowAgain}},[a("base-icon",{attrs:{src:"thumbs-down"}}),a("span",[t._v("Don't show again")])],1),a("base-dropdown-divider"),a("base-dropdown-option",{attrs:{"data-test":"mantra-settings"},on:{click:function(a){return a.stopPropagation(),t.openMantraSettings.apply(null,arguments)}}},[a("base-icon",{attrs:{src:"settings-2"}}),a("span",[t._v("Mantra settings")])],1),t.mantra.name?a("base-dropdown-option",{attrs:{"data-test":"edit-name"},on:{click:t.onEditNameClick}},[a("base-icon",{attrs:{src:"pencil"}}),a("span",[t._v("Edit your name")])],1):t._e()],1)]},proxy:!0}])})}),[],!1,null,"cf39cc2d").exports;export{k as default};