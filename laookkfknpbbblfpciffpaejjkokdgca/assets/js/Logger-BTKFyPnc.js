async function e({method:e,url:t,data:r,headers:n}){const a=await fetch(t,{method:e,headers:n,body:"Object"===(null==r?void 0:r.constructor.name)?JSON.stringify(r):r}).catch((()=>({statusText:"No response from the server"}))),{status:s,headers:o,statusText:i}=a,c={status:s,headers:(null==o?void 0:o.entries)&&Object.fromEntries(o)||{},statusText:i};if(a.ok){const e=await a.text();return e&&(c.data=JSON.parse(e)),c}{let n="%c Request Error: "+(s||"");return i&&(n+=(s?" : ":"")+i),console.groupCollapsed(n,"color: #ff0505"),console.log("Request:",{method:e,url:t,data:r}),console.log("Response:",a),console.groupEnd(),c}}function t(e){return e>=200&&e<300}function r(e){const t=Number(e);return t>=10?t.toString():"0"+t.toString()}function n(e){return void 0===e?e=new Date:e instanceof Date||(e=new Date(e)),e.getFullYear().toString()+"-"+r(e.getMonth()+1)+"-"+r(e.getDate())+"T"+r(e.getHours())+":"+r(e.getMinutes())+":"+r(e.getSeconds())}function a(){const e=new Uint8Array(16);self.crypto.getRandomValues(e),e[6]=15&e[6]|64,e[8]=63&e[8]|128;return[e.subarray(0,4),e.subarray(4,6),e.subarray(6,8),e.subarray(8,10),e.subarray(10,16)].map((e=>Array.from(e).map((e=>e.toString(16).padStart(2,"0"))).join(""))).join("-")}function s(e){return e?e.slice(0,1).toUpperCase()+e.slice(1):null}function o(e){return e.endsWith("s")?e.substring(0,e.length-1):e}function i(e,t){return t.split(".").reduce(((e,t)=>null==e?void 0:e[t]),e)}function c(e){try{const r=e.split(".")[1];if(!r)return null;const n=r.replace(/-/g,"+").replace(/_/g,"/"),a=decodeURIComponent(atob(n).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")),s=JSON.parse(a);if(s.authenticated_user&&"string"==typeof s.authenticated_user)try{s.authenticated_user=JSON.parse(s.authenticated_user)}catch(t){console.warn("Failed to parse authenticated_user claim:",t)}return s}catch(t){return null}}const u=Object.freeze(Object.defineProperty({__proto__:null,arrayBufferToBase64:function(e){return btoa(String.fromCharCode(...new Uint8Array(e)))},base64ToArrayBuffer:function(e){return new Uint8Array(Array.from(atob(e)).map((e=>e.charCodeAt(0)))).buffer},camelCaseToReadable:function(e){return e?s(e=e.replace(/([A-Z])/gm,(e=>" "+e.toLowerCase()))):null},capitalizeFirstLetter:s,getLocalDateTimeString:n,getNestedProperty:i,getQueueKeyFromEntry:({type:e,queueKey:t=e})=>t,parseJwt:c,singularize:o,twoDigit:r,uuidv4:a},Symbol.toStringTag,{value:"Module"})),l=(e,t)=>t<0||t>=e.length,d=(e,t,r)=>{const n=e.length;return((t+r)%n+n)%n},h=e=>e[Math.floor(Math.random()*e.length)],g=e=>{let t=null==e?void 0:e.replaceAll("-","");if(!t)return null;const r=[];for(;t.length>0;){const e=t.slice(0,2);t=t.slice(2),r.push(parseInt(e,16))}return r},f=e=>0===e.length?0:e.reduce(((e,t)=>e+t)),p=async(e,t)=>await Promise.all(e.map((async e=>await t(e)))),m=Object.freeze(Object.defineProperty({__proto__:null,arrayIndexOutOfBounds:l,arraysAreEqual:(e,t)=>JSON.stringify(e)===JSON.stringify(t),asyncFilter:async(e,t)=>{const r=Symbol();return(await Promise.all(e.map((async e=>await t(e)?e:r)))).filter((e=>e!==r))},asyncMap:p,getNextIndex:(e,t)=>t===e.length-1||l(e,t)?0:t+1,getPrevIndex:(e,t)=>0===t||l(e,t)?e.length-1:t-1,getRandomItem:h,getRelativeIndex:d,sumArray:f,uuidToByteArray:g},Symbol.toStringTag,{value:"Module"})),y=e=>Object.entries(e),b=e=>Object.fromEntries(e),w=Object.freeze(Object.defineProperty({__proto__:null,entries:y,filterObject:(e,t)=>Object.fromEntries(Object.entries(e).filter((([,e])=>t(e)))),filterObjectKeysByObject:(e,t)=>Object.keys(t).reduce(((t,r)=>(t[r]=e[r],t)),{}),fromEntries:b,mergeObjects:(e,t)=>(e=e||{},Object.entries(t).forEach((([t,r])=>e[t]=r)),e)},Symbol.toStringTag,{value:"Module"})),S="store",v="_key",_="_value";function j(e){return void 0===e||"string"==typeof e||"object"==typeof(t=e)&&null!==t&&v in t&&_ in t;var t}class O{constructor(e,t){this.name="keyValueDb:"+e,this.version=10*t,this.database=null}get db(){return this.database?Promise.resolve(this.database):this.open().then((e=>this.database=e))}open(){return new Promise(((e,t)=>{const r=indexedDB.open(this.name,this.version);r.onerror=()=>t(r.error),r.onupgradeneeded=()=>{r.result.createObjectStore(S,{keyPath:v})},r.onsuccess=()=>{const t=r.result;t.onversionchange=()=>{t.close(),this.database=null},e(t)}}))}async bulkPatch(e){return b(await p(y(e),(async([e,t])=>{if(!t)throw new Error("");return[e,await this.patch(e,t)]})))}async patch(e,t){const r=await this.get(e);if("object"!=typeof r)throw new Error(`KeyValueDb:${this.name} Error: patch called on ${typeof r} value. Patch may only be called on objects or empty rows. Key: ${e}, Existing Value: ${String(r)}`);const n=Object.assign({},r||{},t),a={[v]:e,[_]:n};return await this.transaction("readwrite",(e=>e.put(a))),{newValue:n,previousValue:r}}set(e,t){const r={[v]:e,[_]:t};return this.transaction("readwrite",(e=>e.put(r)))}delete(e){return this.transaction("readwrite",(t=>t.delete(e)))}async get(e){const t=await this.transaction("readonly",(t=>t.get(e)));return t?t[_]:null}async transaction(e,t,r={retries:3}){let n=0;return new Promise(((a,s)=>{const o=async()=>{try{const r=(await this.db).transaction([S],e);r.onerror=()=>s(n.error);const n=t(r.objectStore(S));n.onsuccess=()=>{const e=n.result;if(!j(e))throw new Error(`Transaction result does not match schema (does not contain a property matching ${v})`);a(e)}}catch(i){if(++n>r.retries)return void s(i);(await this.db).close(),this.database=null,o()}};o()}))}}const R=new O("misc",1);var E="2.25.3";class P{constructor(e){this.endpoint=e,this.config=null,this.pendingRequest=null}async getConfig(){return this.config||(this.pendingRequest?await this.pendingRequest:(this.pendingRequest=this.fetchWithLocalFallback(),this.config=await this.pendingRequest,this.config&&await R.set(this.endpoint,this.config))),this.config}fetchWithLocalFallback(){return e({method:"GET",data:void 0,url:"https://api.momentumdash.com/"+this.endpoint,headers:{"X-Momentum-Version":E}}).then((({data:e})=>{if(!e)throw"Request for config from API failed";return e})).catch((e=>(console.error(e),R.get(this.endpoint))))}}let T=new P("config");async function A(e){const t=await T.getConfig();return t?e?i(t,e):t:{}}const x="extension",k=new URL(`https://browser-http-intake.logs.datadoghq.com/v1/input/pub18ef9128dd80db1a80dfc3f9180b55b5?ddsource=browser&ddtags=${encodeURIComponent(`env:production,service:${x},version:2.25.3`)}`).toString();class C{constructor(e,t=1e-5){this.name=e,this.defaultSampleRate=t,this.sampleRate=null}warn(e,t){return this._log(e,t,"warn")}error(e,t){return this._log(e,t,"error")}info(e,t){return this._log(e,t,"info")}async _log(...t){if(!(await this._isEligibleForSubmission()))return;const[r,n,a]=this._parseArgs(t),s={status:a,date:Date.now(),service:x,message:r,_logger:this.name,...n};this.tabId&&(s.tabId=this.tabId),await e({method:"POST",url:k,data:s})}_convertUndefinedPropertiesToStrings(e){const t={};for(const[r,n]of Object.entries(e))t[r]=void 0===n?"<undefined>":n;return t}_parseArgs(e){let[t,r,n]=e;if(r||"object"!=typeof t||(r=t,t=r.message),r instanceof ErrorEvent&&(r=r.error),r instanceof Error){const{name:e,stack:t}=r;r={name:e,errorMessage:r.message,stack:t}}else"string"==typeof r?(t=`${t}: ${r}`,r={}):"string"==typeof t&&(null==r?void 0:r.message)&&(r.message=`${t}: ${r.message}`);return r&&(r=this._convertUndefinedPropertiesToStrings(r)),[t,r,n]}async _isEligibleForSubmission(){return null===this.sampleRate&&(this.sampleRate=await this._getSampleRate()),Math.random()<=this.sampleRate}async _getSampleRate(){const{datadogLoggingSamplingRate:e}=await A();return e?this.name.split(".").reduce(((t,r,n,a)=>{const s=a.slice(0,n+1).join(".");return s in e?e[s]:t}),this.defaultSampleRate):this.defaultSampleRate}}export{O as K,C as L,P as O,h as a,n as b,s as c,g as d,u as e,m as f,A as g,d as h,t as i,f as j,y as k,R as m,w as o,c as p,e as r,o as s,r as t,a as u};