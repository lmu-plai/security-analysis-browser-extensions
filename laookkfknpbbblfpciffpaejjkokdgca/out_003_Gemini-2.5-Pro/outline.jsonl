{"file":"serviceWorker.js","beautified":"serviceWorker.beautified.js","chunk":{"id":"chunk-1/3","start_line":1,"end_line":2000,"same_function_group":null},"findings":{"chrome_apis":["chrome.storage.local.get","chrome.storage.local.set","chrome.tabs.query","chrome.scripting.executeScript","chrome.runtime.onMessage.addListener"],"event_listeners":["runtime.onMessage.addListener"],"messages":[{"name":"unknown","direction":"unknown","payload_keys":[]}],"storage":[{"key":"config","type":"local","op":"get"},{"key":"config","type":"local","op":"set"}],"endpoints":[{"url":"https://api.momentumdash.com/config","method":"GET"},{"url":"https://browser-http-intake.logs.datadoghq.com/v1/input/pub18ef9128dd80db1a80dfc3f9180b55b5?ddsource=browser&ddtags=env:production,service:extension,version:2.25.3","method":"POST"}],"dom":[],"dynamic_code":[],"wasm":[],"obfuscation_hints":["minified_vars","webpack_modules"],"risks":[]},"evidence":[{"file":"serviceWorker.js","start":1,"end":2000,"ast_id":null}],"notes":"Chunk 1 of service worker. Contains initialization, config fetching, logging, and a custom IndexedDB wrapper. It defines message handling and API wrappers."}
{"file":"serviceWorker.js","beautified":"serviceWorker.beautified.js","chunk":{"id":"chunk-2/3","start_line":2001,"end_line":4000,"same_function_group":null},"findings":{"chrome_apis":[],"event_listeners":[],"messages":[],"storage":[],"endpoints":[],"dom":[],"dynamic_code":[],"wasm":[],"obfuscation_hints":["minified_vars","webpack_modules"],"risks":[]},"evidence":[{"file":"serviceWorker.js","start":2001,"end":4000,"ast_id":null}],"notes":"Chunk 2 of service worker. Continues the implementation of a Dexie.js-like IndexedDB wrapper. This part of the file defines the Collection, WhereClause, Transaction, and Version classes, providing a rich API for database interaction. It also includes several middleware implementations for virtual indexes, hooks, caching, and observability."}
{"file":"serviceWorker.js","beautified":"serviceWorker.beautified.js","chunk":{"id":"chunk-3/3","start_line":4001,"end_line":5360,"same_function_group":null},"findings":{"chrome_apis":["chrome.runtime.getURL","chrome.runtime.getContexts","chrome.offscreen.createDocument","chrome.runtime.onInstalled.addListener","chrome.runtime.setUninstallURL","chrome.tabs.create","chrome.action.onClicked","chrome.browserAction.onClicked","chrome.runtime.onMessage.addListener","chrome.tabs.update","chrome.notifications.create","chrome.notifications.clear","chrome.alarms.create","chrome.alarms.clear","chrome.alarms.get","chrome.alarms.onAlarm.addListener","chrome.notifications.onClicked.addListener","chrome.notifications.onButtonClicked.addListener","chrome.tabs.onRemoved.addListener","chrome.tabs.onUpdated.addListener","chrome.runtime.sendMessage"],"event_listeners":["chrome.runtime.onInstalled.addListener","chrome.action.onClicked","chrome.browserAction.onClicked","chrome.runtime.onMessage.addListener","chrome.alarms.onAlarm.addListener","chrome.notifications.onClicked.addListener","chrome.notifications.onButtonClicked.addListener","chrome.tabs.onRemoved.addListener","chrome.tabs.onUpdated.addListener","self.addEventListener(fetch)","self.addEventListener(install)","self.addEventListener(activate)","self.registration.addEventListener(updatefound)"],"messages":[{"name":"oneTimeLogin","direction":"content->background","payload_keys":["legacy","updateSenderTab","params"]},{"name":"momentum:authState","direction":"content->background","payload_keys":["userId","src","loginState"]},{"name":"momentum:checkUserId","direction":"content->background","payload_keys":["userUuid"]},{"name":"momentum:getUserId","direction":"content->background","payload_keys":[]},{"name":"momentum:openNew","direction":"content->background","payload_keys":["updateSenderTab","params"]},{"name":"legacyUserMigration","direction":"content->background","payload_keys":["tabId"]},{"name":"legacyUserMigration:triggerOffscreenDocumentRequest","direction":"background->offscreen","payload_keys":["context","tabId","loggerName"]},{"name":"notificationClick","direction":"background->content","payload_keys":[]},{"name":"flashMessage","direction":"background->content","payload_keys":["message","error","id"]},{"name":"activateNewWorker","direction":"background->background","payload_keys":[]}],"storage":[{"key":"installDate","type":"local","op":"set"},{"key":"calculateUnregisteredDashboardExperiment","type":"local","op":"set"},{"key":"releaseUpdateModalCheck","type":"local","op":"set"},{"key":"authState","type":"local","op":"patch"},{"key":"momentum-customization-1","type":"localStorage","op":"getObject"},{"key":"client_uuid","type":"localStorage","op":"getItem"},{"key":"token","type":"localStorage","op":"setItem"},{"key":"token_uuid","type":"localStorage","op":"setItem"},{"key":"unregistered","type":"localStorage","op":"setItem"}],"endpoints":[{"url":"https://api.momentumdash.com/user:migrateLegacy?canceled=true","method":"POST"},{"url":"https://momentumdash.com/uninstall","method":"unknown"},{"url":"https://modash.blob.core.windows.net/","method":"GET"},{"url":"posthog.momentumdash.com/e/","method":"POST"},{"url":".posthog.com/e/","method":"POST"}],"dom":[],"dynamic_code":[],"wasm":[],"obfuscation_hints":["minified_vars","webpack_modules"],"risks":[]},"evidence":[{"file":"serviceWorker.js","start":4001,"end":5360,"ast_id":null}],"notes":"Chunk 3 of service worker. This final chunk contains the core extension logic, including lifecycle event listeners (onInstalled, onClicked), message listeners for various app functions (login, auth state, opening tabs), and a request queue for handling API calls. It also manages notifications, alarms, and offscreen documents for local storage access. It includes logic for legacy user migration and analytics reporting to PostHog."}
{"file":"content-scripts/momoSiteInterop.js","beautified":"content-scripts/momoSiteInterop.beautified.js","chunk":{"id":"whole-file","start_line":1,"end_line":55,"same_function_group":null},"findings":{"chrome_apis":["chrome.runtime.getURL","chrome.runtime.getManifest","chrome.runtime.sendMessage"],"event_listeners":["window.addEventListener(message)"],"messages":[{"name":"momentum:getUserId","direction":"content->background","payload_keys":[]},{"name":"momentum:oneTimeLogin","direction":"content->background","payload_keys":["payload","legacy","updateSenderTab"]},{"name":"momentum:authState","direction":"content->background","payload_keys":[]},{"name":"momentum:checkUserId","direction":"content->background","payload_keys":["payload"]},{"name":"momentum:openNew","direction":"content->background","payload_keys":[]},{"name":"momentum:callback:oneTimeLogin","direction":"background->content","payload_keys":["payload"]},{"name":"momentum:callback:checkUserId","direction":"background->content","payload_keys":["payload"]},{"name":"momentum:callback:openNew","direction":"background->content","payload_keys":["payload"]}],"storage":[],"endpoints":[],"dom":[{"selector":"body","action":"appendChild"},{"selector":"input","action":"createElement"}],"dynamic_code":[],"wasm":[],"obfuscation_hints":[],"risks":[]},"evidence":[{"file":"content-scripts/momoSiteInterop.js","start":1,"end":55,"ast_id":null}],"notes":"This content script acts as a bridge between the Momentum dashboard website and the extension's service worker. It injects hidden input fields into the page to share the extension's platform and version. It also sets up a message listener to proxy messages between the web page and the service worker for actions like one-time login, authentication state changes, and opening new tabs."}
{"file":"content-scripts/siteBlocker.js","beautified":"content-scripts/siteBlocker.beautified.js","chunk":{"id":"whole-file","start_line":1,"end_line":66,"same_function_group":null},"findings":{"chrome_apis":["chrome.runtime.getURL"],"event_listeners":["window.addEventListener('message')"],"messages":[{"name":"momentum-intervention:show","direction":"other","payload_keys":[]},{"name":"momentum-intervention:dismiss","direction":"other","payload_keys":[]}],"storage":[],"endpoints":[],"dom":["document.createElement","element.setAttribute","element.attachShadow","shadow.innerHTML","document.body.prepend","MutationObserver"],"dynamic_code":[],"wasm":[],"obfuscation_hints":[],"risks":[]},"evidence":[{"file":"content-scripts/siteBlocker.beautified.js","start":1,"end":66}],"notes":"This content script injects a site-blocking dialog as a custom element with a shadow DOM. The dialog contains an iframe pointing to site-blocker.html and is controlled by window messages."}
