(self.webpackChunk=self.webpackChunk||[]).push([[6488],{45128:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(28338);const i=class e{constructor(t,n=new URLSearchParams){this.base=t,this.params=n;const i=e._toString(t,n).length;(0,o.kG)(i<e.MAX_URL_LENGTH,"url exceeded length limit",String(i));const r=t.toLowerCase();(0,o.kG)(!1===r.startsWith("javascript:")&&!1===r.startsWith("data:"),"url is not allowed to use javascript: or data: protocols",t)}addParams(t){const n=Object.entries(t).reduce(((e,[t,n])=>(e.append(t,n),e)),(o=this.params,new URLSearchParams(o.toString())));var o;return new e(this.base,n)}toString(){return e._toString(this.base,this.params)}static _toString(e,t){const n=t.toString();return`${e}${n.length?`?${n}`:""}`}};i.MAX_URL_LENGTH=2083;let r=i},66878:(e,t,n)=>{n.d(t,{K:()=>a});var o=n(16537),i=n(96643),r=n(19064);function a(e){return(0,r.e)((function(t,n){var r,d=null,c=!1;d=t.subscribe((0,i.x)(n,void 0,void 0,(function(i){r=(0,o.Xf)(e(i,a(e)(t))),d?(d.unsubscribe(),d=null,r.subscribe(n)):c=!0}))),c&&(d.unsubscribe(),d=null,r.subscribe(n))}))}},78129:(e,t,n)=>{n.d(t,{G:()=>r});var o=n(19064),i=n(96643);function r(){return(0,o.e)((function(e,t){var n,o=!1;e.subscribe((0,i.x)(t,(function(e){var i=n;n=e,o&&t.next([i,e]),o=!0})))}))}},20171:(e,t,n)=>{var o,i,r,a;n.d(t,{A:()=>o,a:()=>a}),i=o||(o={}),(r=i.Kind||(i.Kind={})).markAsAddedButtonClick="markAsAddedButtonClick",r.dismissButtonClick="dismissButtonClick",r.generateCitationButtonClick="generateCitationButtonClick",r.cardShow="cardShow",i.markAsAddedButtonClick=function(e){return{kind:"markAsAddedButtonClick",pushedContentItemId:e}},i.dismissButtonClick=function(e){return{kind:"dismissButtonClick",pushedContentItemId:e}},i.generateCitationButtonClick=function(e){return{kind:"generateCitationButtonClick",pushedContentItemId:e}},i.cardShow=function(e){return{kind:"cardShow",pushedContentItemId:e}},(e=>{var t;(t=e.Kind||(e.Kind={})).openUphook="openUphook",t.trackUphook="trackUphook",t.textTooShortViewMounted="textTooShortViewMounted",t.loadingViewMounted="loadingViewMounted",t.loadedViewMounted="loadedViewMounted",t.lockedViewMounted="lockedViewMounted",e.openUphook=function(e){return{kind:"openUphook",paywallUphook:e}},e.trackUphook=function(e,t){return{kind:"trackUphook",paywallUphook:e,event:t}},e.textTooShortViewMounted=function(){return{kind:"textTooShortViewMounted"}},e.loadingViewMounted=function(){return{kind:"loadingViewMounted"}},e.loadedViewMounted=function(){return{kind:"loadedViewMounted"}},e.lockedViewMounted=function(){return{kind:"lockedViewMounted"}}})(a||(a={}))},70018:(e,t,n)=>{n.r(t),n.d(t,{activate:()=>_});var o=n(50750),i=n(66878),r=n(36344),a=n(90572),d=n(59179),c=n(954),s=n(8867),u=n(32073),l=n(84308),p=n(20161),k=n(84178),h=n(84714),C=n(78129),w=n(98189),g=n(74822),v=n(29416),S=n(45128),m=n(28338),b=n(64443),f=n(34967),A=n(20171),V=n(77115),M=n(13391),K=n(35020),I=n(40190),B=n(67177),x=n(12518),y=n(90023),U=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),D=e=>{throw TypeError(e)};var P=(e=>(e.ComponentImpression="componentImpression",e.ComponentClicked="componentClicked",e))(P||{}),E=(e=>(e.ContentReceived="aiDetectorContentReceived",e.CheckStartRequested="aiDetectorCheckStartRequested",e.CheckStarted="aiDetectorCheckStarted",e.CheckStartFailed="aiDetectorCheckStartFailed",e.CheckStopRequested="aiDetectorCheckStopRequested",e.CheckStopped="aiDetectorCheckStopped",e.CheckStoppedFailed="aiDetectorCheckStoppedFailed",e))(E||{}),L=(e=>(e.TextTooShortView="agentPanel/aiDetector/textTooShortView",e.LoadingView="agentPanel/aiDetector/loadingView",e.LoadedView="agentPanel/aiDetector/loadedView",e.LockedView="agentPanel/aiDetector/lockedView",e.MarkAsAddedButton="agentPanel/aiDetector/markAsAddedButton",e.DismissButton="agentPanel/aiDetector/dismissButton",e.GenerateCitationButton="agentPanel/aiDetector/generateCitationButton",e.Card="agentCard/aiDetector",e))(L||{});function T(e,t,n,o,w,g,v,S){return new s.y((m=>{const b=new u.w0,U=M.h.create(new Set);b.add(v.subscribe((e=>{if(e.kind===A.A.Kind.markAsAddedButtonClick)return U.modify((t=>new Set(t).add(e.pushedContentItemId)))})));const D=M.h.create(null);b.add((0,l.a)([t.asyncScores.view("ai_detector").pipe((0,a.h)(V.C_),(0,d.U)((e=>e.outcomeScores.ai_detector_score))),n.getCollection(I.i,w).view((e=>K.$.values(e).filter(I.i))),U,t.asyncCheckingState.view("ai_detector").view((e=>"idle"!==e))]).subscribe((([e,t,n,o])=>{S.next({event:E.ContentReceived,detail:{remainingSuggestionCount:t.length,citedSuggestionCount:n.size,aiDetectorScorePercent:e}}),D.set(f.A.loaded(n,new Set(t.map((e=>e.contentId))),e,o))})));const P=w.pipe((0,p.w)((e=>e?g.view(f.i).pipe((0,a.h)(Boolean),(0,k.q)(1)):(0,h.of)(!1))));return b.add(P.pipe((0,c.O)(null),(0,C.G)(),(0,p.w)((([t,n])=>n?function(e,t,n){return new s.y((o=>{const i=(0,y.zG)(e.request({commandId:"start",payload:"",agentId:f.a}),B.Vn((e=>(n.error("Error while starting checks",e),e))));t.next({event:E.CheckStartRequested,detail:{}}),i().then((e=>{x.nM(e)?(t.next({event:E.CheckStartFailed,detail:{error:e.left.message}}),o.error(e.left)):(t.next({event:E.CheckStarted,detail:{}}),o.next(null),o.complete())}))}))}(e,S,o).pipe((0,d.U)((()=>null)),(0,c.O)(D.get()??f.A.loading())):!0===t?function(e,t,n){return new s.y((o=>{const i=(0,y.zG)(e.request({commandId:"stop",payload:"",agentId:f.a}),B.Vn((e=>(n.error("Error while stopping checks",e),e))));t.next({event:E.CheckStopRequested,detail:{}}),i().then((e=>{x.nM(e)?(o.error(e.left),t.next({event:E.CheckStoppedFailed,detail:{error:e.left.message}})):(t.next({event:E.CheckStopped,detail:{}}),o.complete())}))}))}(e,S,o):r.E)),(0,i.K)((e=>(o.error("Error while starting/stopping checks",e),r.E))),(0,p.w)((e=>null!==e?(0,h.of)(e):D.pipe((0,a.h)(V.C_))))).subscribe(m)),b}))}function R(e){const t=e.capiConnectionStatus.view((e=>"connected"===e.kind?e.sessionId:null)).pipe((0,w.n)((e=>null===e))),n=new g.x;return{state:e.userService.user.view("free").pipe((0,p.w)((s=>s?function(e,t){return(0,o.D)(e.getUphookConfig("aiDetectorAgentPanelPaywall")).pipe((0,i.K)((e=>(t.error("Error while fetching uphook config",e),r.E))),(0,a.h)(V.C_),(0,d.U)((e=>f.A.locked(e))),(0,c.O)(f.A.locked(null)))}(e.uphookHubClient,e.logger):t.pipe((0,p.w)((t=>null===t?(0,h.of)(f.A.loading()):T(e.agentGenericService,e.capiCheckingState,e.pushedContentService,e.logger,e.isPanelOpen,e.wordCount,e.cardActions,n))),(0,c.O)(s?f.A.locked(null):(0,f.i)(e.wordCount.get())?f.A.loading():f.A.textTooShort()))))),trackingEvents:n}}const _=async({bus:e,userService:t,document:n,pushedContentService:o,capiConnectionStatus:i,capiCheckingState:r,navigation:d,uphookHubClient:c,environment:s,agentGenericService:u,trackingServiceProvider:l})=>{var p=[];try{const C=((e,t,n)=>{var o;return null!=t?("object"!=typeof t&&"function"!=typeof t&&D("Object expected"),n&&(o=t[U("asyncDispose")]),void 0===o&&(o=t[U("dispose")]),"function"!=typeof o&&D("Object not disposable"),e.push([n,o,t])):n&&e.push([n]),t})(p,new DisposableStack),w=b.C8.Logging.getLogger("AiDetectorAgent"),g=C.use(e.state.panelState.create(n.id,f.A.initial())),V=l.getTrackingService(),{state:M,trackingEvents:K}=R({agentGenericService:u,uphookHubClient:c,userService:t,capiCheckingState:r,pushedContentService:o,capiConnectionStatus:i,isPanelOpen:d.isPanelOpen,wordCount:n.textInfo.view((e=>(null==e?void 0:e.wordCount)??null)),cardActions:e.events.cardAction.view(n.id),logger:w});C.adopt(M.subscribe((e=>g.set(e))),(e=>e.unsubscribe()));const I=()=>{var e;const t=i.get();return{agentId:f.a,capiSessionId:"connected"===t.kind?t.sessionId:void 0,documentWordCount:null==(e=n.textInfo.get())?void 0:e.wordCount}};return C.adopt(K.pipe((0,a.h)((({event:e})=>e!==E.ContentReceived))).subscribe((({event:e,detail:t})=>V.trackEvent(e,{...I(),...t}))),(e=>e.unsubscribe())),C.adopt(K.pipe((0,a.h)((({event:e})=>e===E.ContentReceived)),(0,v.b)(100)).subscribe((({event:e,detail:t})=>V.trackEvent(e,{...I(),...t}))),(e=>e.unsubscribe())),C.adopt(e.events.panelAction.view(n.id).subscribe((e=>{const t=function(e,t,n){const o=t();switch(n.kind){case A.a.Kind.textTooShortViewMounted:case A.a.Kind.loadingViewMounted:case A.a.Kind.loadedViewMounted:case A.a.Kind.lockedViewMounted:return{event:P.ComponentImpression,detail:{componentId:{[A.a.Kind.textTooShortViewMounted]:L.TextTooShortView,[A.a.Kind.loadingViewMounted]:L.LoadingView,[A.a.Kind.loadedViewMounted]:L.LoadedView,[A.a.Kind.lockedViewMounted]:L.LockedView}[n.kind],detail:n.kind===A.a.Kind.loadedViewMounted&&o.kind===f.A.Kind.Loaded?{...e(),remainingSuggestionCount:o.pushedContentItemIds.size,citedSuggestionCount:o.citedPushedContentItemsIds.size,aiDetectorScorePercent:o.aiDetectorScorePercent}:e()}};case A.a.Kind.openUphook:case A.a.Kind.trackUphook:return null;default:(0,m.L0)(n)}}(I,(()=>g.get()),e);switch(t&&V.trackEvent(t.event,t.detail),e.kind){case A.a.Kind.openUphook:s.actions.openPopup(new S.Z(e.paywallUphook.content.ctaUrl));break;case A.a.Kind.trackUphook:c.trackUphookEvent(e.paywallUphook,e.event);break;case A.a.Kind.textTooShortViewMounted:case A.a.Kind.loadingViewMounted:case A.a.Kind.loadedViewMounted:case A.a.Kind.lockedViewMounted:break;default:(0,m.L0)(e)}})),(e=>e.unsubscribe())),C.adopt(e.events.cardAction.view(n.id).subscribe((e=>{const t=function(e,t){switch(t.kind){case A.A.Kind.markAsAddedButtonClick:case A.A.Kind.dismissButtonClick:case A.A.Kind.generateCitationButtonClick:return{event:P.ComponentClicked,detail:{componentId:{[A.A.Kind.markAsAddedButtonClick]:L.MarkAsAddedButton,[A.A.Kind.dismissButtonClick]:L.DismissButton,[A.A.Kind.generateCitationButtonClick]:L.GenerateCitationButton}[t.kind],detail:e()}};case A.A.Kind.cardShow:return{event:P.ComponentImpression,detail:{componentId:L.Card,detail:e()}};default:(0,m.L0)(t)}}(I,e);t&&V.trackEvent(t.event,t.detail)})),(e=>e.unsubscribe())),C.move()}catch(e){var k=e,h=!0}finally{((e,t,n)=>{var o="function"==typeof SuppressedError?SuppressedError:function(e,t,n,o){return(o=Error(n)).name="SuppressedError",o.error=e,o.suppressed=t,o},i=e=>t=n?new o(e,t,"An error was suppressed during disposal"):(n=!0,e),r=o=>{for(;o=e.pop();)try{var a=o[1]&&o[1].call(o[2]);if(o[0])return Promise.resolve(a).then(r,(e=>(i(e),r())))}catch(e){i(e)}if(n)throw t};r()})(p,k,h)}}},40190:(e,t,n)=>{n.d(t,{i:()=>r});var o=n(88028),i=n(34967);const r=e=>o.z.isVBar(e)&&o.h.isWithComment(e)&&e.surface.sourceAgent===i.a}}]);