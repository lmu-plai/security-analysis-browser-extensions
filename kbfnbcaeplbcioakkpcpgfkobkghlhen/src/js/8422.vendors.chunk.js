(self.webpackChunk=self.webpackChunk||[]).push([[8422],{92649:(e,t,n)=>{n.d(t,{g:()=>r,u:()=>i});var r=(e=>(e.Forbidden="Forbidden: User not assigned to feature",e.Unauthorized="Unauthorized: User not assigned to feature",e.UnprocessableContent="Document did not pass pre-filtering",e.Sensitivity="Document did not pass sensitivity filtering",e.InternalServerError="Internal server error",e.ServiceLimitExceeded="Service limit exceeded",e.UnsupportedLanguage="Unsupported language",e.UpdateClient="Client has to be updated to process the result of the requested action",e.Other="Other error",e.NothingToImprove="Nothing to improve",e))(r||{});const o=class e extends Error{constructor(e,t){super(`[${e}] ${t}`),this.kind=e}static fromMessageError(t){return new e(e.getKind(t),t.title)}};o.getKind=e=>{switch(e.errorType.kind){case"sensitivity":return"Document did not pass sensitivity filtering";case"serviceLimitExceeded":return"Service limit exceeded";case"unsupportedLanguage":return"Unsupported language";case"updateClient":return"Client has to be updated to process the result of the requested action";case"backendError":return"Internal server error";case"badRequest":switch(e.errorType.errorCode){case 403:return"Forbidden: User not assigned to feature";case 401:return"Unauthorized: User not assigned to feature";case 422:return"Document did not pass pre-filtering";default:return"Internal server error"}default:return"Other error"}};let i=o},62404:(e,t,n)=>{n.d(t,{D:()=>d,k:()=>o});var r=n(28338),o=(e=>(e.Sensitivity="Document did not pass sensitivity filtering",e.UnsupportedLanguage="Unsupported language",e.FailedProcessing="Failed to process file",e.ChecksumMismatch="Checksum mismatch",e.UnsupportedFileFormat="Unsupported file format",e.Other="Other error",e))(o||{});const i=class e extends Error{constructor(e,t){super(`[${e}] ${t}`),this.kind=e}static fromMessageError(t){return new e(e.getKind(t),t.title)}};i.getKind=e=>{const{kind:t}=e.errorType;switch(t){case"sensitivity":return"Document did not pass sensitivity filtering";case"unsupportedLanguage":return"Unsupported language";case"failedProcessing":return"Failed to process file";case"checksumMismatch":return"Checksum mismatch";case"unsupportedFileFormat":return"Unsupported file format";case"other":return"Other error";default:(0,r.vE)(t)}};let d=i},79530:(e,t,n)=>{n.d(t,{R:()=>r,k:()=>o});const r=8,o=1e3},82845:(e,t,n)=>{n.d(t,{O:()=>o,s:()=>r});var r=(e=>(e.ComponentImpression="componentImpression",e.ComponentClicked="componentClicked",e))(r||{}),o=(e=>(e.EditingView="agentPanel/paraphraser/editingView",e.ErrorView="agentPanel/paraphraser/errorView",e.LoadedView="agentPanel/paraphraser/loadedView",e.LoadingView="agentPanel/paraphraser/loadingView",e.SavingView="agentPanel/paraphraser/savingView",e.CustomVoiceButton="agentPanel/paraphraser/customVoiceButton",e.ModeButton="agentPanel/paraphraser/modeButton",e.ReloadButton="agentPanel/paraphraser/reloadButton",e.RemoveButton="agentPanel/paraphraser/removeButton",e.SaveButton="agentPanel/paraphraser/saveButton",e.NotificationPanel="agentPanel/paraphraser/notificationPanel",e.PushedContentReceived="agentPanel/paraphraser/pushedContentReceived",e.ModeCompleted="agentPanel/paraphraser/modeCompleted",e))(o||{})},24300:(e,t,n)=>{n.d(t,{B:()=>i,f:()=>o});var r=n(88028);const o=(e,t)=>t.filter((t=>r.h.isWithRewrite(t)&&t.surface.sourceAction===e.sourceAction));function i(e){return r.z.isVBar(e)&&r.h.isWithRewrite(e)&&"paraphraser"===e.surface.sourceAgent}},2577:(e,t,n)=>{n.d(t,{j:()=>i});var r=n(64443);const o="Paraphraser";function i(e=""){return r.C8.Logging.getLogger(e?`${o}.${e}`:o)}},73666:(e,t,n)=>{n.d(t,{I:()=>r});const r="Paraphraser"},48422:(e,t,n)=>{n.d(t,{Z:()=>T,c:()=>J});var r=n(88012),o=n(92649),i=n(62404),d=n(13391),s=n(90023),a=n(20232),c=n(67177),u=n(12518),l=n(2577),p=n(78123),g=n(58303),m=n(86399),v=n(33986),h=n(90572),f=n(63532),b=n(59179),k=n(24666),M=n(5588),I=n(84178),S=n(20161),C=n(29416),w=n(84308),y=n(64271),P=n(84714),U=n(93440),E=n(36344),L=n(83816),B=n(79530),O=n(82845),Z=n(24300),G=Object.defineProperty,K=Object.defineProperties,V=Object.getOwnPropertyDescriptors,x=Object.getOwnPropertySymbols,z=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable,F=(e,t,n)=>t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;function D(e){const{agenticService:t}=e,n=e,{agenticService:r}=n,o=((e,t)=>{var n={};for(var r in e)z.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&x)for(var r of x(e))t.indexOf(r)<0&&R.call(e,r)&&(n[r]=e[r]);return n})(n,["agenticService"]);return((e,t)=>K(e,V(t)))(((e,t)=>{for(var n in t||(t={}))z.call(t,n)&&F(e,n,t[n]);if(x)for(var n of x(t))R.call(t,n)&&F(e,n,t[n]);return e})({},o),{findFirstVBarForAction:e=>t.currentVBars.pipe((0,b.U)((t=>(0,Z.f)(e,t))),(0,b.U)((e=>m.YM(e)))),getSelectedAction:e=>(0,s.zG)(e.selectedModeId,g.tS((t=>(0,s.zG)(e.modes,m.Ew((e=>e.id===t)))))),equals:(e,t)=>p.ZM.Mode.optionalEqById.equals(e,t)&&!(0,s.zG)(t,g.Gg(p.LY.isLoadingAfterReload)),filterAllowedStates:e=>e.kind===p.ZM.Kind.Loaded})}var T,Y=n(73666),j=Object.defineProperty,A=Object.defineProperties,N=Object.getOwnPropertyDescriptors,W=Object.getOwnPropertySymbols,q=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable,_=(e,t,n)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,X=(e,t)=>{for(var n in t||(t={}))q.call(t,n)&&_(e,n,t[n]);if(W)for(var n of W(t))$.call(t,n)&&_(e,n,t[n]);return e},H=(e,t)=>A(e,N(t));function Q(e){return(0,s.zG)(e.selectedModeId,g.tS((t=>ee(t,e))))}function J(e){return p.ZM.Loaded.is(e)?Q(e):g.YP}function ee(e,t){return(0,s.zG)(g.G(t),g.hX(p.ZM.Loaded.is),g.tS((t=>(0,s.zG)(t.modes,m.Ew((t=>t.id===e))))))}function te(e,t,n){return(0,s.zG)(t,m.Ew((t=>t.label===e&&t.isCustom===n)),g.UI((e=>e)))}(e=>{e.create=e=>{var t;const{agenticService:n,capiSessionStarted:m,capiConnectionEvents:Z,editor:G,isPanelOpen:K,trackingServiceProvider:V,fileUploadService:x}=e,z=d.h.create(!1),R=new r.w.Keeper,F=(0,l.j)("ViewModel"),T=d.h.create(null!=(t=e.state)?t:{kind:p.ZM.Kind.Initial}),j=d.h.create(void 0),A=d.h.create(0),N=(0,v.XW)({fileUploadService:x,agentId:p.Rn}),W=()=>{(0,s.zG)(G.getContents().text,u.UI(L.iD),u.g_((()=>A.set(0)),(e=>A.set(e))))};W();const q=Z.pipe((0,h.h)((e=>"connect"===e.kind)),(0,f.b)((()=>F.debug("[DEBUG]: WebSocket connected")))),$=Z.pipe((0,h.h)((e=>"disconnect"===e.kind)),(0,f.b)((()=>F.debug("[DEBUG]: WebSocket disconnected")))),_=m.pipe((0,f.b)((()=>F.debug("[DEBUG]: Session started")))),ne=T.view(J),re=V.getTrackingService(),oe=(0,w.a)([T,(0,y.T)(q.pipe((0,b.U)((()=>"connected"))),$.pipe((0,b.U)((()=>"disconnected"))),(0,P.of)("unknown"))]).pipe((0,b.U)((([e,t])=>e.kind===p.ZM.Kind.Error||"disconnected"===t)),(0,k.x)(),(0,M.D)((e=>(0,U.H)(e?500:0))),(0,f.b)((e=>z.set(e)))),ie=()=>(z.get()&&n.clearVBars(),(0,s.zG)(ue(g.YP),a.UI((e=>T.set(e))))()),de=_.pipe((0,I.q)(1),(0,S.w)((()=>K.pipe((0,S.w)((e=>{const t=T.get();return e&&t.kind!==p.ZM.Kind.Loading&&t.kind!==p.ZM.Kind.Loaded?ge()?(F.debug("Editor has not enough text, skipping loading modes"),T.set({kind:p.ZM.Kind.Empty}),E.E):ie():E.E})))))),se=T.pipe((0,h.h)(p.ZM.Empty.is),(0,S.w)((()=>G.changes.pipe((0,h.h)((()=>!0===K.get())),(0,C.b)(B.k),(0,h.h)((()=>!ge())),(0,I.q)(1),(0,h.h)((()=>p.ZM.Empty.is(T.get()))),(0,S.w)((()=>(F.debug("Editor has enough text in Empty state, try loading modes"),ie()))))))),ae=e.featureFlags.focusCard?(0,v.bH)(D({state:T,isPanelOpen:K,agenticService:n,decorationService:e.decorationService,agentId:p.Rn})):void 0,ce=(0,y.T)(n.currentVBars,ne).pipe((0,h.h)((()=>!z.get())),(0,M.D)((()=>(0,U.H)(500))),(0,f.b)((()=>{(0,s.zG)(ne.get(),g.hX((e=>e.state.kind===p.LY.Kind.Idle)),g.UI((e=>T.modify((t=>{if(!p.ZM.Loaded.is(t))return t;const r=n.getCurrentVBarsForMode(e).length,o=e.state.kind===p.LY.Kind.Idle&&0===r&&!0!==ge();if(o){const t={agentId:p.Rn,capiSessionId:j.get(),textWordsCount:A.get(),modeName:e.label,trackingSourceAction:e.trackingSourceAction};F.debug("Track event",{component:O.O.ModeCompleted,detail:t}),re.trackEvent(O.s.ComponentImpression,{componentId:O.O.ModeCompleted,detail:t})}return p.ZM.Loaded.updateMode(t,e.id,{state:o?{kind:p.LY.Kind.Completed}:{kind:p.LY.Kind.Idle,vBarsCount:r}})})))))})));R.push(de.subscribe(),se.subscribe(),oe.subscribe(),q.subscribe(),$.subscribe(),ce.subscribe(),_.pipe((0,b.U)((e=>e.sessionId))).subscribe((e=>j.set(e))),G.changes.subscribe(W),x.on("removePersistentDataStarted",(e=>{const t=e.useCaseParameters;if("customTone"===(null==t?void 0:t.kind)&&t.name){const e=t.name;F.debug("Removing custom voice mode from state",{voiceName:e}),(0,s.zG)(T.get(),g.DT(p.ZM.Loaded.is),g.tS((t=>(0,s.zG)(te(e,t.modes,!0),g.UI((e=>({loadedState:t,modeToRemove:e})))))),g.g_(s.Q1,(({loadedState:e,modeToRemove:t})=>{const n=(0,s.zG)(e.selectedModeId,g.tS((e=>e===t.id?g.YP:g.G(e))));T.set(H(X({},e),{selectedModeId:n,modes:e.modes.filter((e=>e.id!==t.id))}))})))}})),x.on("uploadTextFinished",(e=>pe()))),ae&&R.push(ae.subscribe());const ue=e=>{F.debug("Loading evaluation");const t=T.get();return p.ZM.Loading.is(t)?()=>Promise.resolve(t):(T.set({kind:p.ZM.Kind.Loading}),(0,s.zG)(n.getModes(),a.UI(u.g_((e=>e instanceof o.u&&e.kind===o.g.Sensitivity?(F.debug("Sensitivity error detected in _loadModes, setting state to blocked",{error:e}),{kind:p.ZM.Kind.Blocked}):{kind:p.ZM.Kind.Error,title:"Something went wrong",description:"To chat with Grammarly, please close this sidebar, then reopen it."}),(r=>({kind:p.ZM.Kind.Loaded,evaluation:r.evaluation,selectedModeId:(0,s.zG)(e,g.hX((e=>r.modes.some((t=>t.id===e.id)))),g.UI((e=>e.id)),g.wp((()=>(0,s.zG)(t,g.DT(p.ZM.Saving.is),g.tS((e=>te(e.voiceName,r.modes,!0))),g.UI((e=>e.id)))))),modes:r.modes.map((e=>H(X({},e),{state:{kind:p.LY.Kind.Idle,vBarsCount:n.getCurrentVBarsForMode(e).length}})))}))))))},le=(e,t=!1)=>((e,t,n)=>new Promise(((r,o)=>{var i=e=>{try{s(n.next(e))}catch(e){o(e)}},d=e=>{try{s(n.throw(e))}catch(e){o(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,d);s((n=n.apply(e,t)).next())})))(void 0,null,(function*(){if(ge())return F.debug("Editor has not enough text, skipping action execution"),void T.set({kind:p.ZM.Kind.Empty});const r=T.get(),i=z.get(),d=ee(e,r);if(g.Wi(d))return void F.debug("Cannot execute mode that is not in the current state",{modeId:e,currentState:r});const u=d.value,l=r;return u.state.kind===p.LY.Kind.Loading?(F.debug("Mode is already loading, only update selected mode w/o execution",{modeId:e}),void T.set(H(X({},l),{selectedModeId:g.G(u.id)}))):(F.debug("Executing mode",{modeId:e}),i&&n.clearVBars(),T.set(H(X(X({},l),p.ZM.Loaded.updateMode(l,u.id,{state:{kind:p.LY.Kind.Loading,isAfterReload:t}})),{selectedModeId:g.G(u.id)})),(0,s.zG)(n.getRewrites(u),c.g_((e=>(e instanceof o.u&&e.kind===o.g.Sensitivity&&(F.debug("Sensitivity error detected, setting state to blocked",{error:e}),T.set({kind:p.ZM.Kind.Blocked})),a.of(void 0))),(()=>(T.modify((e=>{if(!p.ZM.Loaded.is(e))return e;const t=n.getCurrentVBarsForMode(u).length,r=p.ZM.Loaded.updateMode(e,u.id,{state:0===t?{kind:p.LY.Kind.IdleNoSuggestions}:{kind:p.LY.Kind.Idle,vBarsCount:t}}),o={agentId:p.Rn,capiSessionId:j.get(),textWordsCount:A.get(),modeName:u.label,trackingSourceAction:u.trackingSourceAction,suggestionsCount:t};return F.debug("Track event",{componentId:O.O.PushedContentReceived,detail:o}),re.trackEvent(O.s.ComponentImpression,{componentId:O.O.PushedContentReceived,detail:o}),r})),a.of(void 0)))))())})),pe=()=>{if(F.debug("Reloading agent"),ge())return F.debug("Editor has not enough text, skipping re-load"),void T.set({kind:p.ZM.Kind.Empty});const e=ne.get();return n.clearVBars(),void(0,s.zG)(ue(e),a.UI((e=>(T.set(e),p.ZM.Loaded.is(e)?(0,s.zG)(Q(e),g.UI((e=>(F.debug("Loading vBars after agent reload",{mode:e}),le(e.id,!0))))):s.Q1))))()};return{featureFlags:e.featureFlags,selectedMode:ne,title:Y.I,state:T,loadModes:()=>(0,s.zG)(ue(g.YP),a.UI((e=>T.set(e))))(),executeMode:le,reloadAgent:pe,editCustomVoice:()=>{F.debug("Editing custom voice");const e=T.get();T.set({kind:p.ZM.Kind.Editing,previousState:e})},saveCustomVoice:(e,t)=>(T.set({kind:p.ZM.Kind.Saving,voiceName:e,sampleLength:t.length}),void(0,s.zG)(N.createCustomVoice({toneName:e,content:t}),a.UI(u.Vn((e=>{e instanceof i.D&&e.kind===i.k.Sensitivity?(F.debug("Sensitivity error detected in saveCustomVoice, setting state to blocked",{error:e}),T.set({kind:p.ZM.Kind.Blocked})):(F.error("Failed to create custom voice",e),T.set({kind:p.ZM.Kind.Error,title:e.name,description:`${e.message}. Press the "Reload" button to continue working.`}))}))))()),removeCustomVoice:e=>{(0,s.zG)(N.removeCustomVoice({toneName:e}),a.UI(u.Vn((e=>{F.error("Failed to remove custom voice",e),T.set({kind:p.ZM.Kind.Error,title:e.name,description:`${e.message}. Press the "Reload" button to continue working.`})}))))()},context:{capiSessionId:j,tracking:re,textWordsCount:A},dispose:()=>{R.dispose()},goBack:e=>{T.set(e)}};function ge(){return(0,s.zG)(G.getContents().text,u.UI(L.iD),u.UI((e=>e<B.R)),u.fS((()=>!1)))}}})(T||(T={}))}}]);