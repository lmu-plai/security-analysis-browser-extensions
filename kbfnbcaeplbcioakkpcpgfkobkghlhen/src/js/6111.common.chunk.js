(self.webpackChunk=self.webpackChunk||[]).push([[6111],{16111:(e,t,a)=>{a.r(t),a.d(t,{BugReportForm:()=>E});var r=a(92379),l=a(53768),n=a(69554),o=a(50635),i=a(83542),s=a(31702),c=a(52348),u=a(405),g=a(39397),d=a(15380),m=a(44675),p=a(20905),h=a(40594),b=a(56623),x=a(67960),f=a(29483);const y=h.Y.create("BugReportUtils");async function v(){try{if(!(0,f.OB)().historyLogsService.isHistoryEnabled())return y.debug("debug reports feature is not enabled"),null;const e=[],t=[new b.r("bg",(()=>(0,f.OB)().bgRpc.api.getBGLogs()),b.r.getLogsFromSessionStorageFallbackGetter(x.v.bgHistoryLogs)),new b.r("popup",(()=>Promise.resolve((0,f.OB)().historyLogsService.getLogs())),b.r.getLogsFromSessionStorageFallbackGetter(x.v.popupHistoryLogs)),new b.r("cs",(async()=>{const e=[],t=t=>{e.push(...t.option.logs.map((e=>({...e,loggerName:`${t.option.isIframeIntegration?`iframe.[${t.caller.frameId}].`:""}${e.loggerName}`}))))};return(0,f.OB)().bgRpc.api.sendToFocusTab({kind:d.B.Kind.sendCsLogsToPopup}),(0,f.OB)().message.on(d.I.Kind.sendCsLogs,t),await(0,m.gw)(p.E0),e.length||await(0,m.gw)(p.E0),(0,f.OB)().message.off(d.I.Kind.sendCsLogs,t),e.length?e:void 0}),b.r.getLogsFromSessionStorageFallbackGetter(x.v.csHistoryLogs))];try{await(0,m.Fb)(p.E0,async function(){y.info("latest experiments state",await(0,f.OB)().bgRpc.api.getExperimentTreatment()),y.info("latest storage state",await(0,f.OB)().browserApi.preferences.getAll()),y.info("browser info",(0,f.OB)().browserApi.getBrowserInfo())}())}catch(e){y.warn("cannot get latest app state",e)}t.sort((e=>e.envName===(0,f.OB)().context?1:-1));for(const a of t){const t=await a.getLogs();e.push(...null!=t?t:[])}e.sort(((e,t)=>e.timestamp-t.timestamp));const a=function(e){const t=e=>{try{return JSON.stringify(e)}catch(t){return String(e)}};return[["Level","Logger","Timestamp","Message"].join("\t"),...e.map((e=>{const a=[e.level,e.loggerName,new Date(e.timestamp).toISOString(),e.message];return e.data&&a.push(t(e.data)),e.exception&&a.push(t(e.exception)),a.join("\t")}))].join("\n")}(e),r=`grammarly-logs-${(new Date).toISOString().replace(/[:.]/g,"-")}.tsv`;return new File([a],r,{type:"text/tab-separated-values"})}catch(e){return y.error("Failed to generate debug logs file",e),null}}const k={dark:{background:l.NeutralGray90,text:l.NeutralGray10,border:l.NeutralGray80,helperText:l.NeutralGray30,link:l.Blue40,error:l.Red40,calloutBg:l.NeutralGray80,calloutBorder:l.NeutralGray60,calloutText:l.NeutralGray20},light:{background:l.White,text:l.NeutralGray90,border:"transparent",helperText:l.NeutralGray40,link:l.Blue60,error:l.Red60,calloutBg:l.NeutralGray10,calloutBorder:l.NeutralGray20,calloutText:l.NeutralGray80},backdropDark:"rgba(0, 0, 0, 0.8)",backdropLight:"rgba(0, 0, 0, 0.5)",shadowDark:"0 8px 16px rgba(0, 0, 0, 0.24)",shadowLight:"0 8px 16px rgba(0, 0, 0, 0.15)"},E=({isOpen:e,onClose:t,onSubmit:a})=>{const[l,d]=r.useState(""),[m,p]=r.useState(""),[h,b]=r.useState([]),[x,f]=r.useState(!1),[y,E]=r.useState(!1),[w,L]=r.useState(null),[S,B]=r.useState(null),C=r.useRef(null),T=r.useRef(null),[F,R]=r.useState((0,g.Y)());r.useEffect((()=>{const e=self.matchMedia("(prefers-color-scheme: dark)"),t=()=>R(e.matches);return e.addEventListener("change",t),()=>e.removeEventListener("change",t)}),[]),r.useEffect((()=>{e&&T.current&&T.current.focus();const a=e=>{"Escape"===e.key&&t()};return e&&document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}}),[e,t]);const N=r.useMemo((()=>(e=>{const t=e?k.dark:k.light;return{backdrop:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:e?k.backdropDark:k.backdropLight,display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},dialog:{backgroundColor:t.background,color:t.text,borderRadius:"8px",padding:"20px",maxWidth:"500px",width:"90%",maxHeight:"85%",overflow:"auto",border:e?`1px solid ${t.border}`:"none",boxShadow:e?k.shadowDark:k.shadowLight},helperText:{opacity:.7,color:t.helperText},hiddenFileInput:{display:"none"},ticketLink:{color:t.link,textDecoration:"underline",cursor:"pointer",fontSize:"14px"},errorText:{color:t.error},clickableLabel:{cursor:"pointer"},fileText:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginRight:"8px"},calloutBox:{backgroundColor:t.calloutBg,border:`1px solid ${t.calloutBorder}`,borderRadius:"6px",padding:"10px 12px",margin:"0"},calloutText:{color:t.calloutText,fontSize:"13px",lineHeight:"1.4"}}})(F)),[F]);return e?r.createElement("div",{role:"presentation",style:N.backdrop,onMouseDown:e=>{e.target===e.currentTarget&&t()}},r.createElement("div",{ref:T,role:"dialog","aria-modal":"true","aria-labelledby":"bug-report-title",style:N.dialog,tabIndex:-1},S?r.createElement(r.Fragment,null,r.createElement(n.X,{as:"h2",variant:"heading-medium",marginBottom:3,id:"bug-report-title"},"Bug Report Submitted Successfully!"),r.createElement(o.k,{direction:"column",gap:4},r.createElement(i.x,null,r.createElement(s.x,{as:"span",variant:"text-small",weight:"medium",color:"base-default"},"JIRA Ticket:"," ",r.createElement("a",{href:S.ticketUrl,target:"_blank",rel:"noopener noreferrer",style:N.ticketLink},S.ticketKey)))),r.createElement(o.k,{gap:2,justify:"end",marginTop:4},r.createElement(c.z,{variant:"primary",text:"Close",onClick:()=>{B(null),t()}}))):r.createElement(r.Fragment,null,r.createElement(n.X,{as:"h2",variant:"heading-medium",marginBottom:2,id:"bug-report-title"},"Report a Bug"),r.createElement(o.k,{direction:"column",gap:3},r.createElement(i.x,null,r.createElement(u.g,{label:"Title",placeholder:"Briefly describe the issue",value:l,onChange:d,rows:1})),r.createElement(i.x,null,r.createElement(u.g,{label:"Description",placeholder:"Provide details about what went wrong and steps to reproduce the issue",value:m,onChange:p})),r.createElement(i.x,null,r.createElement(s.x,{as:"span",variant:"text-small",weight:"medium",color:"base-default"},"Attachment (optional)"),r.createElement(o.k,{direction:"column",gap:2,marginTop:1},r.createElement("input",{ref:C,type:"file",accept:"image/*,video/*",multiple:!0,onChange:e=>{(async e=>{const t=Array.from(e.target.files||[]);if(t.length>0){const a=["image/png","image/jpeg","image/gif","video/mp4","video/mov","video/quicktime","video/avi","video/x-msvideo"],r=t.filter((e=>a.includes(e.type)));if(r.length>0){const e=(await Promise.all(r.map((async e=>{try{const t=await e.arrayBuffer();return new File([t],e.name,{type:e.type})}catch(e){return null}})))).filter((e=>null!==e));e.length>0&&b((t=>[...t,...e]))}e.target.value=""}})(e)},style:N.hiddenFileInput,id:"bug-report-file"}),r.createElement(o.k,{gap:2},r.createElement(c.z,{variant:"secondary",text:"Choose Files",onClick:()=>{var e;return null===(e=C.current)||void 0===e?void 0:e.click()}}),h.length>0&&r.createElement(c.z,{variant:"ghost",text:"Clear All",size:"small",onClick:()=>{b([]),C.current&&(C.current.value="")}})),h.length>0&&r.createElement(o.k,{direction:"column",gap:1},h.map(((e,t)=>r.createElement(o.k,{key:`${e.name}-${t}`,align:"center",gap:2},r.createElement(s.x,{as:"span",variant:"text-small",color:"base-default",style:N.fileText},e.name," (",Math.round(e.size/1024)," KB)"),r.createElement(c.z,{variant:"ghost",text:"Remove",size:"small",onClick:()=>(e=>{b((t=>t.filter(((t,a)=>a!==e))))})(t),style:{flexShrink:0}}))))))),r.createElement(i.x,{style:N.calloutBox},r.createElement(s.x,{as:"span",variant:"text-small",style:N.calloutText},"⚠️ Logs will be auto-collected and may include a portion of your text to help us investigate the issue.")),w&&r.createElement(i.x,null,r.createElement(s.x,{as:"span",variant:"text-small",style:N.errorText},"❌ ",w))),r.createElement(o.k,{gap:2,justify:"end",marginTop:3},r.createElement(c.z,{variant:"secondary",text:"Cancel",onClick:t,isDisabled:x}),r.createElement(c.z,{variant:"primary",text:y?"Collecting logs...":x?"Submitting...":"Submit",onClick:async()=>{if(l.trim()&&m.trim()){f(!0),E(!0),L(null);try{const e=await v();if(!e)throw new Error("Failed to collect debug logs");E(!1);const t=await a({title:l.trim(),description:m.trim(),attachments:h,debugLogs:e});B(t),L(null),d(""),p(""),b([]),C.current&&(C.current.value="")}catch(e){L(e instanceof Error?e.message:"Failed to submit bug report"),E(!1)}finally{f(!1)}}},isDisabled:!l.trim()||!m.trim()||x}))))):null}},405:(e,t,a)=>{a.d(t,{g:()=>s});var r=a(92379),l=a(45550),n=a(82285),o=a(67283),i=a(42684);const s=r.forwardRef((function(e,t){const{label:a,className:s,helperMessage:c,errorMessage:u,isRequired:g,isOptional:d,placeholder:m,labelDisplay:p="visible",labelIndicatorForOptional:h,labelIndicatorForRequired:b,rows:x=3,resizable:f="on",minLength:y,maxLength:v,spellCheck:k}=e,E=r.useRef(null);r.useImperativeHandle(t,(()=>E.current));const{labelProps:w,inputProps:L}=(0,n.h)({...e,validationState:null!=u?"invalid":"valid",inputElementType:"textarea"},E),S={minLength:y,maxLength:v,spellCheck:k};return r.createElement("div",{className:"gds-text-area"},r.createElement(o.A,{label:a,labelDisplay:p,helperMessage:c,isRequired:g,isOptional:d,labelIndicatorForRequired:b,labelIndicatorForOptional:h,errorMessage:u,...w}),r.createElement("div",{className:"gds-text-area-container"},r.createElement("textarea",{className:(0,l.W)("gds-text-area-input",!0===L.disabled?"":`gds-text-area-resize-${f}`,s),...S,...L,placeholder:m,ref:E,rows:x,style:e.style})),r.createElement(i.f,{errorMessage:u}))}))}}]);