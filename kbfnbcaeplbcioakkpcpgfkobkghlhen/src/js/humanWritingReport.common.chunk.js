(self.webpackChunk=self.webpackChunk||[]).push([[5739],{58799:(e,t,n)=>{var r=n(57401),i="chrome-extension://__MSG_@@extension_id__/",a="moz-extension://__MSG_@@extension_id__/",o="safari-web-extension://__MSG_@@extension_id__/",s=self.GR_RESOURCE_ROOT||i,c=self.GR_RESOURCE_ROOT||a,l=self.GR_RESOURCE_ROOT||o;e.exports={__css:r.toString().replace(new RegExp(i,"g"),s).replace(new RegExp(a,"g"),c).replace(new RegExp(o,"g"),l),...r.locals}},95957:(e,t,n)=>{n.d(t,{m:()=>i});var r=n(74822);const i=new class{constructor(){this._messageSubject=new r.x,this.messages=this._messageSubject}forwardMessage(e){this._messageSubject.next(e)}}},78370:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(6824),i=n(36661),a=n(97204);function o(e,t){const n=a.Sy((e=>e.struct({kind:e.literal(t)}))),o=a.Sy((t=>t.intersect(n(t))(e(t))));return{ResultMessage:o,isResultMessage:i.n(a.l7(r.Schemable)({sensitiveString:r.string}))(o).is}}},42175:(e,t,n)=>{n.d(t,{QU:()=>i,Uv:()=>r,XW:()=>s,_f:()=>a,bd:()=>l,dL:()=>o,yg:()=>c,ym:()=>d});const r=2,i=20,a=92,o=10,s=["chat.openai.com","gemini.google.com","www.perplexity.ai","perplexity.ai","chatgpt.com","claude.ai","www.wikipedia.org",".wikipedia.org"],c=["docs.google.com"],l=1e4,d={howItWorks:"https://grammarly.com",learnMoreTransparency:"https://grammarly.com",learnMoreSafety:"https://grammarly.com",learnMoreControl:"https://grammarly.com",reportAnIssue:"https://support.grammarly.com/hc/en-us"}},21685:(e,t,n)=>{n.r(t),n.d(t,{EditsTrackingControllerImpl:()=>$n});var r=n(90023),i=n(28338),a=n(13391),o=n(32073),s=n(74822),c=n(59179),l=n(63532),d=n(90572),u=n(20161),h=n(84178),m=n(36344),p=n(66878),g=n(58303),f=n(95957),_=n(39565),k=n(97204),b=n(28060),v=n(78370);const{isResultMessage:y,ResultMessage:C}=(0,v.A)(k.nO,b.PU.Final),x=y;var w=n(18838),S=n(21243),E=n(25693),I=n(90189),T=n(9542),D=n(29999),A=n(15083),R=n(4271),M=n(90595),L=n(40594),F=n(91745);var U=n(73642),P=n(49955),G=n(26156),B=n(14969),N=n(53976),O=n(18519),$=n(31789),H=n(10883),z=n(2613),W=n(17543),Z=n(84714),K=n(29479),q=n(78326),j=n(33494),V=n(14527),Y=n(95869),J=n(2187),Q=n(19830),X=n(3199),ee=n(61797),te=n(42175),ne=n(59835),re=n(78767),ie=n(23650),ae=n(48758),oe=n(5388),se=n(7833);class ce{constructor(e){this._document=e,this._log=L.Y.create("GeminiSourcedContentStore"),this._storedGeminiContent=null,this._clickHandler=e=>{const t=e.target;if(null==t?void 0:t.matches(se.QO)){const e=this._extractGeminiPromptFromUI(t)||"",n=this._extractGeminiTextFromUI(t);n&&this._storeGeminiSourcedContent(e,n)}},this._document.addEventListener("click",this._clickHandler,!0)}getMatch(e){try{if(this._storedGeminiContent){const t=e.inserted.length&&e.inserted===e.deleted?e.inserted.trim():e.maximalReplacement.trim();if(0===(0,S.mS)(this._storedGeminiContent.text,t)){const e=this._storedGeminiContent;return this._storedGeminiContent=null,{sourcedContent:e}}}return null}catch(e){return this._log.error("Error in getMatch",e),null}}_storeGeminiSourcedContent(e,t){try{const n=P.F.create("hwr://delta/generate/google/gemini/","Gemini",t,void 0,e);this._storedGeminiContent=n}catch(e){this._log.error("Failed to store sourced content",e)}}_extractGeminiTextFromUI(e){const t=e.closest(se.qz);if(!t)return null;const n=t.querySelector(se.tN),r=null==n?void 0:n.innerText;return r&&r.length>0?r:null}_extractGeminiPromptFromUI(e){const t=e.closest(se.qz);if(!t)return null;const n=t.previousElementSibling;if(!n||!n.matches(se.yv))return null;const r=n.querySelector(se.Q),i=null==r?void 0:r.value;return i&&i.length>0?i:null}dispose(){this._storedGeminiContent=null,this._document.removeEventListener("click",this._clickHandler,!0)}}function le(e,t,n=3){var r;let i=0;const a=Math.min(e.length,t.length,n)-1;for(let n=a;n>=0&&e[e.length-1-n]===(null===(r=t[a-n])||void 0===r?void 0:r.key);n--)i++;return i}function de(e,t,n){if(0===t.length)return 0;const r=(0,S.k4)(n,e,t);return r>0?r:e.ops.reduce(((e,r,i,a)=>{if(e.eventsIndex>=t.length)return i!==a.length-1||!("delete"in r)||"insert"in r&&""!==r.insert?{...e,matched:0,eventsIndex:e.eventsIndex}:e;if("retain"in r){const o=function(e,t,n,r,i,a){const o=le(a.substring(0,t.textIndex+n.retain),e);if(o){let n=t.eventsIndex+o,s=t.textIndex+o;r.slice(i+1).every((t=>{var r;if("retain"in t){if(!(0,S.fo)(a.substring(s,s+t.retain),e.slice(n)))return!1;n+=t.retain,s+=t.retain}if("delete"in t){if(""!==(null===(r=e[n])||void 0===r?void 0:r.key)&&void 0!==e[n])return!1;n+=t.delete}if("insert"in t){const r=t.insert;if(!(0,S.fo)(r,e.slice(n)))return!1;n+=r.length}return!0}))&&(t.matched+=o,t.eventsIndex+=o)}return t.textIndex+=n.retain,t}(t,e,r,a,i,n);e.eventsIndex=o.eventsIndex,e.matched=o.matched,e.textIndex=o.textIndex}if("delete"in r&&r.delete>0){const n=function(e,t,n){t.textIndex+=n.delete;for(;t.eventsIndex<e.length&&""===e[t.eventsIndex].key;)t.matched+=1,t.eventsIndex+=1;return t}(t,e,r);e.eventsIndex=n.eventsIndex,e.matched=n.matched,e.textIndex=n.textIndex}if("insert"in r){const n=function(e,t,n){const r=n.insert,i=e.slice(t.eventsIndex);let a=0;for(;i[0]&&""===i[0].key;)i.shift(),t.eventsIndex++,a++;if(!(0,S.fo)(r,i))return{...t,matched:0,eventsIndex:1/0};if(i[0].repeat){let e=i.shift();const t=null==e?void 0:e.key;for(;e&&(e.repeat&&e.key===t||/^\d$/.test(e.key));)a++,e=i.shift()}else a+=r.length;t.matched+=a,t.eventsIndex+=a;return t}(t,e,r);e.eventsIndex=n.eventsIndex,e.matched=n.matched,e.textIndex=n.textIndex}return e}),{matched:0,eventsIndex:0,textIndex:0}).matched}function ue(e,t){return null===e||Date.now()-e.timestamp>200?{id:crypto.randomUUID(),timestamp:Date.now(),events:[t],source:t.source}:e.source===t.source?{id:e.id,timestamp:Date.now(),events:[t,...e.events],source:t.source}:{id:crypto.randomUUID(),timestamp:Date.now(),events:[t],source:t.source}}const he=n(72138);function me(e,t,n){var r;let i=null,a=0;try{if(t.length&&e.inserted.length===t.length+1&&1===e.deleted.length&&e.deleted.toUpperCase()===e.inserted[0]&&t.some((e=>/^\s$/.test(e.key)))&&le(e.inserted.slice(1),t,t.length))i=P.F.create("hwr://delta/rewrite/google/correct/","Google Docs Corrections",e.maximalReplacement),a=le(e.maximalReplacement,t);else if(t.length&&e.deleted.length>0&&e.deleted.length<=te.QU&&e.maximalReplacement.startsWith(`${e.deleted[0].toUpperCase()}${e.deleted.substring(1)}`)){const n=e.maximalReplacement.substring(e.deleted.length),r=n.split("").filter(((e,n)=>e===t[n].key)).length;r===n.length&&(i=P.F.create("hwr://delta/rewrite/google/correct/","Google Docs Corrections",e.maximalReplacement),a=r)}else t.length&&e.inserted.length<=te.QU&&/\S[\s)."'?!]$/.test(e.inserted)&&(he(e.maximalReplacement,e.deleted)<=e.deleted.length/1.5||e.inserted.length+e.deleted.length<e.retained.length/1.5)&&e.maximalReplacement[e.maximalReplacement.length-1]===t[0].key?(i=P.F.create("hwr://delta/rewrite/google/correct/","Google Docs Corrections",e.maximalReplacement),a=1):0==e.deleted.length&&e.inserted.length<=te._f&&e.inserted.trim().length>0&&"\t"===(null===(r=t[0])||void 0===r?void 0:r.key)&&(i=P.F.create("hwr://delta/rewrite/google/completion/","Google Docs Smart Compose Suggestions",e.maximalReplacement),a=1)}catch(e){n.error("getMatch has thrown",e)}return i&&n.debug(`[GoogleDocsSuggestionStore] getMatch('${e.maximalReplacement}') returning:`,i),i?{sourcedContent:i,matchedTrustedEventsCount:a}:null}class pe{constructor(){this._log=L.Y.create("GoogleDocsSourcedContentStore")}getMatch(e,t){return Promise.resolve(me(e,t,this._log))}getSyncMatch(e,t){return me(e,t,this._log)}}var ge;!function(e){e.Internal="internal",e.Exportable="exportable",e.Selection="selection",e.GrammarlyPrevious="grammarly-previous",e.GrammarlyCurrent="grammarly-current",e.GrammarlyApplied="grammarly-applied",e.External="external",e.GDocs="gdocs",e.Startup="startup",e.Temporary="temporary",e.Test="test"}(ge||(ge={}));class fe{constructor(e,t=[],n=1/0){this.kind=e,this.data=t,this._maxRecordsCount=n,this._sourcedContentById=new Map,this.data.forEach((e=>{this._sourcedContentById.set(e.id,e)})),this._log=L.Y.create(`[${this.kind}] ${fe.name}`),this._keepLastN()}getMatch(e,t){var n;let r=this.data;t&&(r=this.data.filter(t));const i=e.inserted.length&&e.inserted===e.deleted?e.inserted.trim():e.maximalReplacement.trim(),a=r.find((({text:e})=>0===(0,S.mS)(e,i)))||null;return a&&(null===(n=this._log)||void 0===n||n.info(`[${this.kind}] getMatch('${(0,S.aS)(e.maximalReplacement,40)}') returning:`,a)),a}getFuzzyMatch(e,t){var n;const r=e.maximalReplacement,i=(1-t)*r.length,a=this.data.find((e=>{var t,n;const a=(0,S.$2)(e.text),o=ee.zI.diffAsChanges(a,r);return null===(t=this._log)||void 0===t||t.info(`[FuzzyMatch] text length: ${r.length}, amount changed: ${o.amount}`),null===(n=this._log)||void 0===n||n.info("Delta",o),!S.Hq.hasPerLetterTags(e)&&(o.amount<=i||0===(0,S.mS)(a,r))}))||null;return a&&(null===(n=this._log)||void 0===n||n.info(`[${this.kind}] getFuzzyMatch('${(0,S.aS)(r,40)}') returning:`,a)),a}getPartialMatch(e,t=10){var n;const r=e.inserted.length&&e.inserted===e.deleted?e.inserted.trim():e.maximalReplacement.trim();if(r.length<t)return null;const i=e=>(0,S.$2)(e.toLowerCase().replace(/\s+/g," ").trim()),a=i(r),o=this.data.find((e=>{if(S.Hq.hasPerLetterTags(e))return!1;return i(e.text).includes(a)}))||null;return o&&(null===(n=this._log)||void 0===n||n.info(`[${this.kind}] getPartialMatch('${(0,S.aS)(e.maximalReplacement,40)}') returning:`,o)),o}getContentById(e){return this._sourcedContentById.get(e)||null}addContent(e){var t,n;null===(t=this._log)||void 0===t||t.debug("addContent",e),this._sourcedContentById.has(e.id)?null===(n=this._log)||void 0===n||n.debug("addContent: id already exists",e.id):(this.data.push(e),this._sourcedContentById.set(e.id,e),this._keepLastN())}removeContent(e){const t=this.data.findIndex((({id:t})=>t===e));t>-1&&(this.data.splice(t,1),this._sourcedContentById.delete(e))}_keepLastN(){this.data.length<=this._maxRecordsCount||(this.data.slice(0,this.data.length-this._maxRecordsCount).forEach((({id:e})=>{this._sourcedContentById.delete(e)})),this.data=this.data.slice(-this._maxRecordsCount))}}class _e{constructor({documentId:e,sessionId:t,textObserver:n,editsTrackingEvents:r,keyboardEvents:i,selectionChanges:s,alertStateChanges:c,replacementAppliedEvents:l,copiedTextMessage:u,trackingState:h,reportState:m,env:p}){this._exportableSourcedContentStore=new fe(ge.Exportable,[]),this._internalCopyStore=new fe(ge.Internal,[]),this._externalCopyStore=new fe(ge.External,[],4),this._selectionStore=new fe(ge.Selection,[],2),this._grammarlyStore=new fe(ge.GrammarlyApplied,[],10),this._googleDocsSourcedContentStore=new pe,this._geminiSourcedContentStore=new ce(document),this._untrackedContentStore=new fe(ge.Startup,[],4),this._charsList=new P.Jo,this._deltaEdits=[],this._trustedEvents=a.h.create([]),this._subs=new o.w0,this._log=L.Y.create("EditsTracker"),this._knownDeltaEditMetadata=a.h.create({clientInfo:null,sessionId:null}),this._readyForEvents=a.h.create(!1),this._currentDesyncCount=0,this._documentId=e,this._sessionId=t,this._felog=(0,S.Cc)({variant:"decoupled tracking",documentId:e}),this._editsTrackingEvents=r,this._env=p,this._textObserver=n,this._reportState=m,this._subs.add(m.pipe(d.h((e=>Boolean(e)))).subscribe((e=>{e.report.deltaEdits.length<this._deltaEdits.length&&this._felog.error("changeTracking","Document update with history loss",void 0,{currentHistoryLength:this._deltaEdits.length,newHistoryLength:e.report.deltaEdits.length,documentUpdateKind:e.kind})}))),this._currentDeltaEditMetadata=t.view((e=>({clientInfo:{clientName:p.config.appConfig.gnar.appName,version:p.config.buildInfo.version},sessionId:g.WG(e)}))),this._validDocumentStateUpdates=m.pipe(d.h((e=>Boolean(e&&("new"===e.kind||"storage"===e.kind))))),this._isActive=a.h.combine(this._readyForEvents,h,((e,t)=>e&&"active"===t)),this._subs.add(this._validDocumentStateUpdates.pipe(B.P(),K.h(!0)).subscribe(J.wW(this._readyForEvents))),this._subs.add(this._setupTextChangeHandling()),this._subs.add(this._setupTrustedEventsHandling(i)),this._subs.add(this._setupSelectionChangeHandling(s)),this._subs.add(this._setupDocumentStateChangeHandling()),this._subs.add(this._setupEditsTrackingEventsHandling()),this._subs.add(this._setupAlertCollectionChangesHandling(c)),this._subs.add(this._setupReplacementEventsHandling(l)),this._subs.add(this._setupCopiedTextMessageHandling(u))}_setupTextChangeHandling(){return this._textObserver.contentChanges.async.pipe(Q.u(this._validDocumentStateUpdates),H.M(this._isActive),d.h((([e,t])=>t)),c.U((([e])=>e)),d.h((({changes:e})=>e.length>0))).subscribe((e=>{this._handleTextChange(new V.i(e.deltaChange.delta.ops))}))}_setupTrustedEventsHandling(e){const t=this._env.config.systemInfo.os.isMac;return e.pipe(d.h((e=>e.isTrusted&&(1===e.key.length||"Enter"===e.key||"Tab"===e.key||"Backspace"===e.key||"Delete"===e.key)&&!e.ctrlKey&&(t?!e.metaKey:!e.altKey))),H.M(this._isActive),d.h((([e,t])=>t)),c.U((([e])=>e))).subscribe((e=>{this._trustedEvents.modify((t=>{return t.concat({timestamp:Date.now(),key:(n=e,"Enter"===n.key?"\n":"Tab"===n.key?"\t":"Backspace"===n.key||"Delete"===n.key?"":n.key),repeat:e.repeat});var n}))}))}_setupSelectionChangeHandling(e){return e.pipe(H.M(this._isActive),d.h((([e,t])=>t)),c.U((([e])=>e))).subscribe((e=>this._handleSelectionChange(e)))}_setupDocumentStateChangeHandling(){return this._validDocumentStateUpdates.pipe(H.M(this._isActive),d.h((([e,t])=>t)),c.U((([e])=>e))).subscribe((e=>this._handleDocumentUpdate(e)))}_setupEditsTrackingEventsHandling(){return this._editsTrackingEvents.pipe(H.M(this._isActive),d.h((([e,t])=>t)),c.U((([e])=>e))).subscribe((e=>{"genAIResultCopied"===e.kind?this._handleGenAICopyEvents(e.text,e.prompt):"chatResponseReceived"===e.kind&&this._handleChatResponseReceived(e)}))}_setupAlertCollectionChangesHandling(e){return e.pipe(H.M(this._isActive),d.h((([e,t])=>t)),c.U((([e])=>e)),c.U((({removedAlerts:e})=>(this._log.info("removedAlerts",e),e.filter((({reason:e})=>e._tag===ie.i.alertAccepted))))),d.h((e=>e.length>0))).subscribe((e=>this._handleAppliedAlerts(e)))}_setupReplacementEventsHandling(e){return e.pipe(H.M(this._isActive),d.h((([e,t])=>t)),c.U((([e])=>e)),d.h(ne.q7),X.R(ue,null),d.h((e=>Boolean(e)))).subscribe((e=>{this._handleReplacementGroupApplied(e)}))}_setupCopiedTextMessageHandling(e){return e.subscribe((e=>this._handleCopiedTextMessage(e)))}_handleCopiedTextMessage(e){if(!e.valid)return;const t=e.copiedText||"";null==this._externalCopyStore.getMatch(S.QY.getSummary("",(new V.i).insert(t)))&&this._externalCopyStore.addContent(P.F.create(e.sourceURL||"",e.sourceName||"",t,void 0,e.userPrompt))}_handleAppliedAlerts(e){for(const t of e){if(void 0===t||!ae.S.isCapiAlert(t.alert))continue;const e=t.alert.text;t.alert.replacements.forEach((n=>{const r=S.QY.extractMaximalReplacementString(e,S.QY.singleDelta(e,n));r&&this._grammarlyStore.addContent(P.F.create("hwr://delta/rewrite/grammarly/correct/?id="+t.alert.id,"Grammarly edited: ("+e+" -> "+n+")",r))}))}}_handleReplacementGroupApplied(e){this._log.debug("_handleReplacementGroupApplied",{eventsGroup:e});const t=function(e,t){const n=t.events.sort(((e,t)=>e.replacement.pos.start-t.replacement.pos.end)).reduce(((t,{replacement:n})=>{const r=t.oldText.substring(n.pos.start,n.pos.end),i="string"==typeof n.value?n.value:S.QY.extractMaximalReplacementString(r,n.value);return t.newText=`${t.newText}${e.slice(t.textPosition,n.pos.start).map((e=>e.character)).join("")}${i||""}`,t.replacements.push({before:r,after:i||""}),t.textPosition=n.pos.end,t}),{replacements:[],newText:"",textPosition:0,oldText:e.map((e=>e.character)).join("")}),r=S.QY.getSummary(n.oldText,ee.zI.diffAsChanges(n.oldText,`${n.newText}${n.oldText.substring(n.textPosition)}`).delta);return(0,ne.z_)(t.source)?r.maximalReplacement.length?{...P.F.create("hwr://delta/rewrite/grammarly/correct/",`Grammarly edited: (${n.replacements.map((e=>`${e.before} -> ${e.after}`)).join(", ")})`,r.maximalReplacement),id:t.id}:null:{...P.F.create(`hwr://delta/rewrite/grammarly/${t.source}`,`Grammarly generated (${t.source})`,r.maximalReplacement),id:t.id}}(this._charsList.chars,e);t&&(this._grammarlyStore.removeContent(t.id),this._grammarlyStore.addContent(t))}_pruneTrustedEvents(e){this._trustedEvents.modify((t=>t.length-e>15?(this._log.debug("too many unmatched events, clearing them up"),this._felog.error("changeTracking","Too many trusted events left unmatched",void 0,{count:t.length,max:15}),[]):(this._log.debug("cleaned up trusted events",{before:t,after:t.slice(e),matched:e}),t.slice(e))))}_handleDocumentUpdate(e){const t=e.report;if(e.report.deltaEdits.length<this._deltaEdits.length)return void this._updateDocumentState();if(this._documentId!==t.documentId){const t="Document id mismatch in state update";this._felog.error("changeTracking",t,void 0,{incomingDocumentId:e.report.documentId}),this._log.error(t)}this._charsList=new P.Jo(t.chars),this._deltaEdits=t.deltaEdits,t.sourcedContentStore.data.forEach((e=>{this._exportableSourcedContentStore.addContent(e)}));const n=t.deltaEdits.reduce(((e,t)=>{let n=e;return t.clientInfo&&(n={...n,clientInfo:t.clientInfo}),t.sessionId&&(n={...n,sessionId:t.sessionId}),n}),{clientInfo:null,sessionId:null});this._knownDeltaEditMetadata.set(n);const r=this._textObserver.getCurrentTextMap().getPlainText(),i=ee.zI.diffAsChanges(this._charsList.text,r).delta;if(S.QY.isNoTextChangesDelta(i))this._log.info("No changes since last known state."),this._editsTrackingEvents.next({kind:"knownStateMatch"});else{const e=Math.abs(S.QY.getNumInsertedLetters(i)+S.QY.getNumDeletedLetters(i));this._log.info("Known document state is different from current",i),this._editsTrackingEvents.next({kind:"knownStateMismatch",lengthDifference:e}),this._felog.info("Untracked text found",void 0,{documentLength:r.length,untrackedDiffLength:e})}this._handleTextChange(i,!0)}_handleTextChange(e,t=!1,n=!1){const r=Y.s.normalizeDelta(Y.s.cleanAllAttrs(e));if(0===r.ops.length)return;const i=t?0:de(r,this._trustedEvents.get(),this._charsList.text);t?this._log.debug("got tracking start delta",{normalizedDelta:r}):i||this._log.debug("delta is not typed",{normalizedDelta:r,trustedEvents:this._trustedEvents.get()}),this._pruneTrustedEvents(i);const a=t?this._applyStartingDelta(r):this._applyDelta(r,Date.now(),i);this._deltaEdits.push(a),this._knownDeltaEditMetadata.modify((({clientInfo:e,sessionId:t})=>({clientInfo:a.clientInfo||e,sessionId:a.sessionId||t}))),this._updateDocumentState();const o=this._textObserver.getCurrentTextMap().getPlainText();if(this._charsList.text.length!==o.length||this._charsList.text!==o){this._currentDesyncCount++,this._log.debug("text state is out of sync",{delta:e,normalizedDelta:r,currentDesyncCount:this._currentDesyncCount});const t=ee.zI.diffAsChanges(this._charsList.text,o).delta;this._currentDesyncCount>2&&!n?this._recoverFromDesync(e,t):this._felog.info("Text state is out of sync",void 0,{deltaEdit:Y.s.anonymizeTextAndStringAttrs(e),difference:Y.s.anonymizeTextAndStringAttrs(t),count:this._currentDesyncCount}),n&&this._felog.error("changeTracking","Text state sync recovery failed")}else this._log.info("text state is in sync"),this._currentDesyncCount&&(this._log.info("out of sync recovered",this._currentDesyncCount),this._felog.info("Text state sync recovered",void 0,{forced:n,count:this._currentDesyncCount}),this._currentDesyncCount=0)}_recoverFromDesync(e,t){S.QY.isNoTextChangesDelta(t)||(this._log.debug("sync diff",t),this._felog.error("changeTracking","Text state is out of sync",void 0,{deltaEdit:Y.s.anonymizeTextAndStringAttrs(e),difference:Y.s.anonymizeTextAndStringAttrs(t)}),this._handleTextChange(t,!0,!0))}_updateDocumentState(){this._reportState.set({kind:"updated",report:this._getDocumentState()})}_handleSelectionChange(e){e.forEach((e=>{if(e.start!=e.end&&e.end-e.start>1){const t=this._charsList.text.substring(e.start,e.end),n=this._charsList.getCharRange(e.start,e.end-e.start);this._selectionStore.addContent(P.F.create(`hwr://delta/document/google/${this._documentId}`,self.name||"Unnamed",t,n)),this._editsTrackingEvents.next({kind:"sourceAdded",textLength:n.length,sourceDomain:self.location.origin,promptDetected:!1})}}))}_handleGenAICopyEvents(e,t){e.length&&this._internalCopyStore.addContent(P.F.create(`hwr://delta/rewrite/grammarly/${oe.P.oggyGenAI}`,`Grammarly generated (${oe.P.oggyGenAI})`,e,void 0,t))}_handleChatResponseReceived(e){e.content.length&&this._grammarlyStore.addContent(P.F.create(`hwr://delta/generate/grammarly/aaa/${e.responseId}`,"Always Available Assistant Response",e.content,void 0,e.prompt))}_applyDeltaOps(e,t,n=!1){const r=Date.now();t&&this._exportableSourcedContentStore.addContent(t);let i=0;for(const a of e.ops)if(Y.s.isRetain(a))i+=a.retain;else if(Y.s.isInsertString(a)){try{this._applySingleInsertion(i,new P.XV(a.insert,e,r,t||null,n))}catch(t){this._felog.error("changeTracking","Delta application with source failed",void 0,{error:String(t)}),this._applySingleInsertion(i,new P.XV(a.insert,e,r,null,n))}i+=a.insert.length}else Y.s.isDelete(a)&&(this._trackDeletion(i,a.delete),this._applySingleDeletion(i,a.delete))}_applyStartingDelta(e){const t=this._charsList.text,n=S.QY.getSummary(t,e),r=P.F.create("hwr://delta/startup/","Delta on Document load",n.maximalReplacement);this._applyDeltaOps(e,r);const i=this._knownDeltaEditMetadata.get(),a=this._currentDeltaEditMetadata.get();return{timestamp:Date.now(),delta:e,sourceContentId:r.id,isSelfAuthored:!1,clientInfo:(0,re.fS)(i.clientInfo,a.clientInfo)?void 0:a.clientInfo||void 0,sessionId:i.sessionId===a.sessionId?void 0:a.sessionId||void 0}}_applyDelta(e,t,n){let r=null;const i=this._charsList.text,a=S.QY.getSummary(i,e),o=n>0&&a.maximalReplacement.length<=te.dL;n>0&&a.maximalReplacement.length>te.dL&&this._felog.error("changeTracking","False positive typed match",void 0,{insertionLength:a.maximalReplacement.length,matchedLength:n,trustedEvents:(0,S.tg)(this._trustedEvents.get())}),this._log.debug("_applyDelta summary",a),this._log.debug("_applyDelta matchedLength",n);let s=null;if(o||(s=a.maximalReplacement.length?this._searchAllSourcedContentStores(a):null),s){const t=function(e,t){if(t.text.length===e.length)return t;if(0===t.timestamps.length)return{...t,text:e,id:crypto.randomUUID()};const n=Date.now(),r=ee.zI.diffAsChanges(t.text,e).delta;let i=0,a=0;return r.ops.reduce(((e,t)=>{if("retain"in t){const n=e.text.substring(i,i+t.retain);return i+=n.length,a+=[...n].length,e}if("delete"in t){const n=[...e.text.substring(i,i+t.delete)].length;return{...e,text:`${e.text.substring(0,i)}${e.text.substring(i+t.delete)}`,timestamps:e.timestamps.slice(0,a).concat(e.timestamps.slice(a+n)),originalSourceContentIds:e.originalSourceContentIds.slice(0,a).concat(e.originalSourceContentIds.slice(a+n)),isSelfAuthoredTags:e.isSelfAuthoredTags.slice(0,a).concat(e.isSelfAuthoredTags.slice(a+n))}}if("insert"in t){const r=[...t.insert].length,o={...e,text:`${e.text.substring(0,i)}${t.insert}${e.text.substring(i)}`,timestamps:e.timestamps.slice(0,a).concat(Array(r).fill(n),e.timestamps.slice(a)),originalSourceContentIds:e.originalSourceContentIds.slice(0,a).concat(Array(r).fill(null),e.originalSourceContentIds.slice(a)),isSelfAuthoredTags:e.isSelfAuthoredTags.slice(0,a).concat(Array(r).fill(!1),e.isSelfAuthoredTags.slice(a))};return i+=t.insert.length,a+=r,o}return e}),{...t,id:crypto.randomUUID()})}(a.maximalReplacement,s.sourcedContent);r=t.id,this._applyDeltaOps(e,t,o)}else this._applyDeltaOps(e,void 0,o);if(!o&&r){const e=this._exportableSourcedContentStore.getContentById(r);e?this._editsTrackingEvents.next({kind:"sourcedTextAdded",sourceDomain:(0,S.Xw)(e.url),textLength:a.maximalReplacement.length,promptDetected:Boolean(e.prompt)}):this._editsTrackingEvents.next({kind:"unknownSourceTextAdded",textLength:a.maximalReplacement.length})}else o||this._editsTrackingEvents.next({kind:"unknownSourceTextAdded",textLength:a.maximalReplacement.length});const c=this._knownDeltaEditMetadata.get(),l=this._currentDeltaEditMetadata.get();return(null==s?void 0:s.matchedTrustedEventsCount)&&this._pruneTrustedEvents(s.matchedTrustedEventsCount),{timestamp:t,delta:e,sourceContentId:r||void 0,isSelfAuthored:o,clientInfo:(0,re.fS)(c.clientInfo,l.clientInfo)?void 0:l.clientInfo||void 0,sessionId:c.sessionId===l.sessionId?void 0:l.sessionId||void 0}}_trackDeletion(e,t){const n=this._charsList.getCharRange(e,t),r=n.map((e=>e.character)).join("");this._onCopyDelete(r,n)}_onCopyDelete(e,t){e.length>=te.Uv&&this._internalCopyStore.addContent(P.F.create(`hwr://delta/document/google/${this._documentId}`,self.name||"Unnamed",e,t))}_applySingleDeletion(e,t){this._charsList.deleteAt(e,t)}_applySingleInsertion(e,t){this._charsList.insertAt(e,t)}_searchAllSourcedContentStores(e){let t=this._grammarlyStore.getMatch(e);if(t)return this._grammarlyStore.removeContent(t.id),{storeKind:ge.GrammarlyApplied,sourcedContent:t,matchedTrustedEventsCount:0};if(t=this._grammarlyStore.getPartialMatch(e,10),t)return this._grammarlyStore.removeContent(t.id),{storeKind:ge.GrammarlyApplied,sourcedContent:t,matchedTrustedEventsCount:0};if(t=this._internalCopyStore.getMatch(e,(e=>"hwr://delta/startup/"!=e.url)),t)return{storeKind:this._internalCopyStore.kind,sourcedContent:t,matchedTrustedEventsCount:0};if(t=this._selectionStore.getMatch(e),t)return{storeKind:ge.Selection,sourcedContent:t,matchedTrustedEventsCount:0};if(t=this._externalCopyStore.getMatch(e),t)return{storeKind:ge.External,sourcedContent:t,matchedTrustedEventsCount:0};const n=this._geminiSourcedContentStore.getMatch(e);if(n)return{storeKind:ge.External,sourcedContent:n.sourcedContent,matchedTrustedEventsCount:0};const r=this._googleDocsSourcedContentStore.getSyncMatch(e,this._trustedEvents.get());return r?{storeKind:ge.GDocs,sourcedContent:r.sourcedContent,matchedTrustedEventsCount:r.matchedTrustedEventsCount}:(t=this._untrackedContentStore.getMatch(e),t?{storeKind:ge.Startup,sourcedContent:t,matchedTrustedEventsCount:0}:(t=this._externalCopyStore.getFuzzyMatch(e,.95),t?{storeKind:ge.External,sourcedContent:t,matchedTrustedEventsCount:0}:null))}_getDocumentState(){return{documentId:this._documentId,chars:this._charsList.chars.slice(0),sourcedContentStore:{kind:"internal",data:this._exportableSourcedContentStore.data.slice(0)},deltaEdits:this._deltaEdits.slice(0)}}dispose(){this._subs.unsubscribe()}}const ke=4096;class be{constructor(e){this._reportState=a.h.create(null),this._trackingState=a.h.create("dormant"),this._storageState=a.h.create("idle"),this._log=L.Y.create("EditsTrackingFeatureImpl"),this._subs=new o.w0,this._deps=e,this._felog=(0,S.Cc)({variant:"decoupled tracking",documentId:e.documentId,storageType:e.storageClient instanceof j.T?"extension":"document"}),this._advancedLoggingEnabled=e.advancedLoggingEnabled,this._editsTracker=new _e({documentId:e.documentId,sessionId:e.sessionId,reportState:this._reportState,env:e.env,trackingState:this._trackingState.view(),textObserver:e.textObserver,keyboardEvents:e.keyboardEvents,selectionChanges:e.selectionChanges,alertStateChanges:e.alertStateChanges,replacementAppliedEvents:e.replacementAppliedEvents,editsTrackingEvents:e.editsTrackingEvents,copiedTextMessage:e.copiedTextMessage}),this._subs.add(this._handleTrackingStateChange().subscribe()),this._subs.add(this._handleDocumentUpdates().subscribe()),this._setupIntegrationTestsLogging(),this._felog.info("Init")}startTracking(){this._log.info("Starting document tracking"),this._trackingState.set("active"),this._felog.info("Started tracking")}stopTracking(){this._log.info("Stopping document tracking"),this._trackingState.set("paused"),this._felog.info("Stopped tracking")}async getReportableDocument(){const e=this._reportState.get(),t=this._reportState.pipe(d.h((e=>Boolean(e))));return e?"storage"===e.kind||"updated"===e.kind||"saved"===e.kind?Promise.resolve({...e.report,title:document.title}):"new"===e.kind?(this._felog.warning("reportGenerationFailed","Cannot get report for an empty new document"),Promise.reject("Report Generation Failed: Empty document")):(this._felog.error("reportGenerationFailed","Cannot get report",void 0,{documentState:e.kind}),Promise.reject(new Error("Report Generation Failed: Cannot get report"))):(0,U.z)(G.S([t,this._storageState.pipe(d.h((e=>"idle"===e)),B.P(),l.b((()=>{this._retreiveReportFromStorage()})),N.c(t),O.V(4e3),p.K((()=>(this._felog.error("reportGenerationFailed","Cannot get report, retrieval timeout"),$._(new Error("Document state is not OK after 4000ms, failing"))))))]).pipe(c.U((e=>({...e.report,title:document.title})))))}_handleTrackingStateChange(){return this._trackingState.pipe(u.w((e=>"active"===e?this._storageState.pipe(d.h((e=>"idle"===e)),B.P(),l.b((()=>{this._retreiveReportFromStorage()}))):"paused"===e?this._storageState.pipe(d.h((e=>"idle"===e)),H.M(this._reportState),d.h((([e,t])=>Boolean(t&&"updated"===t.kind))),B.P(),l.b((([e,t])=>{t&&this._writeReportToStorage(t.report)}))):m.E)))}_handleDocumentUpdates(){return this._reportState.pipe(d.h((e=>!!e&&"updated"===e.kind)),z.e(2e3),H.M(this._storageState),u.w((([e,t])=>W.s((()=>"idle"===t),Z.of(e),this._storageState.pipe(d.h((e=>"idle"===e)),B.P(),K.h(e))))),l.b((({report:e})=>{this._writeReportToStorage(e)})))}async _retreiveReportFromStorage(){this._log.info("Retrieving report from storage"),this._storageState.set("loading");let e=null;try{e=await this._deps.storageClient.retrieve(this._deps.documentId),this._log.info("Document state was read from storage"),this._handleStorageRetrieval(e)}catch(e){this._handleStorageError(e)}this._storageState.set("idle")}async _writeReportToStorage(e){this._log.info("Saving report to storage"),this._storageState.set("saving");try{await this._deps.storageClient.store(e),this._log.info("Storage write to storage: success"),this._reportState.modify((e=>e?{...e,kind:"saved"}:e))}catch(e){return this._log.error("Error writing to storage:",e),this._handleStorageError(e),this._storageState.set("idle"),Promise.reject(e)}this._storageState.set("idle")}_handleStorageRetrieval(e){this._reportState.modify((t=>null===t?null===e?(this._felog.info("New report created",void 0,{documentLength:this._deps.textObserver.getCurrentTextMap().getPlainText().length}),{report:P.z.create(this._deps.documentId),kind:"new"}):(this._felog.info("Saved report retrieved",void 0,{historyLength:e.deltaEdits.length}),{report:e,kind:"storage"}):e?t.report.deltaEdits.length>(null==e?void 0:e.deltaEdits.length)?(this._felog.error("storageError","Document in the storage is older than the current one",void 0,{currentHistoryLength:t.report.deltaEdits.length,storageHistoryLength:e.deltaEdits.length,lastCurrentDeltaEdit:t.report.deltaEdits[t.report.deltaEdits.length-1],lastStorageDeltaEdit:e.deltaEdits[e.deltaEdits.length-1]}),t):(this._felog.info("Saved report retrieved",void 0,{historyLength:e.deltaEdits.length}),{report:e,kind:"storage"}):(this._felog.error("storageError","Document disappeared from storage during editing session"),t)))}_handleStorageError(e){e instanceof q.EK?(this._reportState.modify((e=>null===e||"new"===e.kind?{report:P.z.create(this._deps.documentId),kind:"corrupted"}:e)),this._deps.editsTrackingErrors.next({kind:"databaseCorrupted"}),this._felog.error("storageError",`Database corrupted: ${e.name}, '${e.message}'`)):e instanceof q.nl?(this._deps.editsTrackingErrors.next({kind:"serverError",errorMessage:e.message}),this._felog.error("storageError",`Server error: ${e.name}, '${e.message}'`)):e instanceof q.e0?(this._deps.editsTrackingErrors.next({kind:"unrecoverableError",errorMessage:e.message}),this._felog.error("storageError",`Couldn't migrate document to encrypted storage: ${e.name}, '${e.message}'`)):e instanceof q._P?(this._deps.editsTrackingErrors.next({kind:"unrecoverableError",errorMessage:e.message}),this._felog.error("storageError",`Unrecoverable error: ${e.name}, '${e.message}'`)):(this._deps.editsTrackingErrors.next({kind:"unrecoverableError",errorMessage:e.message}),this._felog.error("storageError",`Unknown error: ${e.name}, '${e.message}'`))}_setupIntegrationTestsLogging(){const e=function(){const e=L.Y.create("HWRLETEL");return function(t){let n="";if("contentChanges"===t.kind){const e=t.data;n=JSON.stringify({...e,deltaChange:{...e.deltaChange,delta:JSON.parse(JSON.stringify(e.deltaChange.delta))}})}else if("keyboardEvent"===t.kind){const e=t.data;n=JSON.stringify({isTrusted:e.isTrusted,altKey:e.altKey,charCode:e.charCode,code:e.code,composed:e.composed,ctrlKey:e.ctrlKey,isComposing:e.isComposing,key:e.key,keyCode:e.keyCode,location:e.location,metaKey:e.metaKey,repeat:e.repeat,shiftKey:e.shiftKey,type:e.type,which:e.which})}else n=JSON.stringify(t.data);for(let r=0;r<n.length/ke;r++){const i={timestamp:t.timestamp,kind:t.kind,append:r>0,string:n.substring(ke*r,ke*(r+1))};e.info(t.kind,JSON.stringify(i))}}}();this._subs.add(this._deps.replacementAppliedEvents.pipe(H.M(this._advancedLoggingEnabled),d.h((([e,t])=>t)),c.U((([e])=>e))).subscribe((t=>{e({kind:"replacement",data:t,timestamp:Date.now()})}))),this._subs.add(this._deps.alertsState.pipe(H.M(this._advancedLoggingEnabled),d.h((([e,t])=>t)),c.U((([e])=>e))).subscribe((t=>{e({kind:"alertState",data:t,timestamp:Date.now()})}))),this._subs.add(this._deps.alertStateChanges.pipe(H.M(this._advancedLoggingEnabled),d.h((([e,t])=>t)),c.U((([e])=>e))).subscribe((t=>{e({kind:"alertStateChange",data:t,timestamp:Date.now()})}))),this._subs.add(this._deps.textObserver.contentChanges.async.pipe(H.M(this._advancedLoggingEnabled),d.h((([e,t])=>t)),c.U((([e])=>e))).subscribe((t=>{e({kind:"contentChanges",data:t,timestamp:Date.now()})}))),this._subs.add(this._deps.selectionChanges.pipe(H.M(this._advancedLoggingEnabled),d.h((([e,t])=>t)),c.U((([e])=>e))).subscribe((t=>{e({kind:"selectionChange",data:t,timestamp:Date.now()})}))),this._subs.add(this._deps.copiedTextMessage.pipe(H.M(this._advancedLoggingEnabled),d.h((([e,t])=>t)),c.U((([e])=>e))).subscribe((t=>{e({kind:"copiedTextMessage",data:t,timestamp:Date.now()})}))),this._subs.add(this._deps.keyboardEvents.pipe(H.M(this._advancedLoggingEnabled),d.h((([e,t])=>t)),c.U((([e])=>e))).subscribe((t=>{e({kind:"keyboardEvent",data:t,timestamp:Date.now()})})))}dispose(){this._subs.unsubscribe(),this._editsTracker.dispose();const e=this._reportState.get();e&&"updated"===e.kind&&"saving"!==this._storageState.get()&&this._deps.storageClient.store(e.report)}}var ve=n(92379),ye=n(99887),Ce=n(90517),xe=n(954),we=n(81933),Se=n(20932),Ee=n(1182),Ie=n(83507),Te=n(84308),De=n(64271),Ae=n(44071),Re=n(45523);const Me={offsetLeft:"20px",offsetBottom:"20px"},Le=()=>Z.of(Me);const Fe=()=>{const e=document.querySelector(".left-sidebar-container-content .navigation-widget"),t=document.querySelector(se.Qy),n=document.querySelector(se.os),r=document.querySelector(".kix-documentmetrics-widget");return t&&n?Te.a(function(e){return e?Re.x.create(e,{attributes:!0,subtree:!1,childList:!1}).pipe(d.h((e=>e.some((e=>"style"===e.attributeName)))),c.U((t=>/opacity: 0/.test(e.getAttribute("style")||""))),xe.O(/opacity: 0/.test(e.getAttribute("style")||""))):Z.of(!0)}(e),function(e){return e?Re.x.create(e,{attributes:!0,subtree:!1,childList:!1}).pipe(d.h((e=>e.some((e=>"style"===e.attributeName)))),c.U((t=>/display: none/.test(e.getAttribute("style")||""))),xe.O(/display: none/.test(e.getAttribute("style")||"")),c.U((()=>e.getBoundingClientRect().height))):Z.of(0)}(r)).pipe(u.w((([e,r])=>e?Z.of({...Me,offsetBottom:r?`${r+30}px`:Me.offsetBottom}):De.T(Re.x.create(t,{attributes:!0,subtree:!1,childList:!1}).pipe(d.h((e=>e.some((e=>"style"===e.attributeName))))),Ae.R(self,"resize")).pipe(c.U((()=>n.getBoundingClientRect().x)),xe.O(n.getBoundingClientRect().x),c.U((e=>({offsetLeft:`${e+20}px`,offsetBottom:"20px"}))))))):Z.of(Me)};var Ue=n(33885),Pe=n(63349),Ge=n(8842),Be=n(37639),Ne=n(50635),Oe=n(59819),$e=n(69554),He=n(31702),ze=n(52348),We=n(27327),Ze=n(72032);const Ke={$nest:{"& .gds-modal-content":{minWidth:"438px"},"& .gds-modal-medium":{width:"438px"},"& .gds-modal-header":{display:"none"},"& .gds-modal-body":{padding:Pe.ux.rem(Ge.x0)},"& .gds-heading-large":{fontSize:Pe.ux.rem(2.25),lineHeight:"1.11em"}}},qe=Pe.ux.stylesheet({modal:[Ke]}),je=Se.UI.Node.make((({notify:e})=>{const t=(0,Ze.T)("go");return ve.createElement(Be.u_,{isOpen:!0,onClose:e({kind:"clipboardRequestResult",result:"close"}),title:"",dismissOnOutsideClick:!1,width:"small",role:"alertdialog",className:qe.modal},ve.createElement(Be.u_.Body,null,ve.createElement(We.o,null,ve.createElement(Ne.k,{direction:"column",gap:10},ve.createElement(Oe.T,{composition:"lockup",brand:t,accessibilityLabel:"",height:21}),ve.createElement(Ne.k,{direction:"column",gap:3},ve.createElement($e.X,{as:"h1",variant:"heading-large"},"Allow clipboard",ve.createElement("br",null),"access to track",ve.createElement("br",null),"writing accurately"),ve.createElement(He.x,{as:"p"},"We need access to your clipboard so we can record the sources you use. We’ll use it to identify text you copy and paste from websites plus links to those sites.")),ve.createElement(Ne.k,{direction:"row",gap:3},ve.createElement(ze.z,{text:"Allow access",variant:"primary",onClick:e({kind:"clipboardRequestResult",result:"allow"})}),ve.createElement(ze.z,{text:"Deny",variant:"ghost",onClick:e({kind:"clipboardRequestResult",result:"deny"})}))))))}));var Ve=n(46154);const Ye=Se.UI.Node.make((({notify:e})=>ve.createElement(Be.u_,{isOpen:!0,onClose:e({kind:"feedbackPopupClose"}),title:"",dismissOnOutsideClick:!1,width:"small",role:"alertdialog"},ve.createElement(Be.u_.Body,null,ve.createElement(Ve.q,{onClose:e({kind:"feedbackPopupClose"}),align:"left",onSubmit:t=>e({kind:"feedbackSubmit",feedback:t.text})(),withScore:!1,fixSubmitButtonOverflowBottomPadding:!0,hideLogo:!0,title:"How can we improve?"})))));var Je=n(15484),Qe=n(3498),Xe=n(36279),et=n(19347),tt=n(85837),nt=n(74437);var rt=n(77375);const it=[{id:"transparency",title:ve.createElement(Ne.k,{align:"center",gap:2},ve.createElement((()=>ve.createElement("svg",{width:"23",height:"32",viewBox:"0 0 23 32",fill:"none"},ve.createElement("path",{d:"M3.58829 4.35H15.2974C17.0724 4.35 18.5357 5.85744 18.5357 7.75342V23.8537C18.5357 25.7497 17.0724 27.2571 15.2974 27.2571H3.58829C1.81326 27.2571 0.35 25.7497 0.35 23.8537V7.75342C0.35 5.85744 1.81326 4.35 3.58829 4.35Z",fill:"white",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),ve.createElement("path",{d:"M4 8.5H11.89",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),ve.createElement("path",{d:"M4 17.5H14.89",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),ve.createElement("path",{d:"M4 13H14.89",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),ve.createElement("path",{d:"M13.704 24.3143C17.1757 24.3143 19.9901 21.4731 19.9901 17.9684C19.9901 14.4637 17.1757 11.6226 13.704 11.6226C10.2323 11.6226 7.41797 14.4637 7.41797 17.9684C7.41797 21.4731 10.2323 24.3143 13.704 24.3143Z",fill:"#B3F8F8",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinejoin:"round"}),ve.createElement("path",{d:"M8 19.4951C8 19.4951 8.17677 19.4951 9.69062 19.4951",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),ve.createElement("path",{d:"M12 19.4951C12 19.4951 12.4182 19.4951 16 19.4951",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),ve.createElement("path",{d:"M8 15.5645H10.9419",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),ve.createElement("path",{d:"M13.5 15.5645H16",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),ve.createElement("path",{d:"M21.9414 26.6366C22.0781 26.7733 22.2997 26.7733 22.4364 26.6366C22.5731 26.4999 22.5731 26.2783 22.4364 26.1416L21.9414 26.6366ZM18.0523 22.7475L21.9414 26.6366L22.4364 26.1416L18.5473 22.2525L18.0523 22.7475Z",fill:"#1C1C1C"}))),null),ve.createElement(He.x,{variant:"text-small",as:"p",weight:"normal"},"We’re transparent about data")),Content:({learnMoreURL:e})=>ve.createElement(Ne.k,{direction:"column",gap:2},ve.createElement(He.x,{variant:"text-xsmall",as:"p"},"Grammarly Authorship records your writing activity when you turn it on in a document. The data it gathers includes: text you type and delete, text you paste from other websites and links to those sites, and prompts you send to generative AI tools."),ve.createElement(Je.r,{href:e,variant:"primary",weight:"bold",target:"_blank",underline:"hover"},ve.createElement(He.x,{variant:"text-xsmall",as:"span"},"Learn more"," ",ve.createElement(Xe.J,{icon:et.n,accessibilityLabel:"",variant:"inherit",className:rt.linkIcon}))))},{id:"safety",title:ve.createElement(Ne.k,{align:"center",gap:2},ve.createElement((()=>ve.createElement("svg",{width:"21",height:"32",viewBox:"0 0 21 32",fill:"none"},ve.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.09141 3C6.66135 3 4.69141 4.96994 4.69141 7.4V13.0256C4.69141 15.4557 6.66136 17.4256 9.09141 17.4256H11.947C14.3771 17.4256 16.347 15.4557 16.347 13.0256V7.4C16.347 4.96995 14.3771 3 11.947 3H9.09141ZM9.98539 5.49507C8.57706 5.49507 7.43539 6.63675 7.43539 8.04507V11.8101C7.43539 13.2184 8.57706 14.3601 9.98538 14.3601H11.0786C12.4869 14.3601 13.6286 13.2184 13.6286 11.8101V8.04507C13.6286 6.63675 12.4869 5.49507 11.0786 5.49507H9.98539Z",fill:"white"}),ve.createElement("path",{d:"M5.04141 7.4C5.04141 5.16324 6.85465 3.35 9.09141 3.35V2.65C6.46805 2.65 4.34141 4.77664 4.34141 7.4H5.04141ZM5.04141 13.0256V7.4H4.34141V13.0256H5.04141ZM9.09141 17.0756C6.85466 17.0756 5.04141 15.2624 5.04141 13.0256H4.34141C4.34141 15.649 6.46806 17.7756 9.09141 17.7756V17.0756ZM11.947 17.0756H9.09141V17.7756H11.947V17.0756ZM15.997 13.0256C15.997 15.2624 14.1838 17.0756 11.947 17.0756V17.7756C14.5704 17.7756 16.697 15.649 16.697 13.0256H15.997ZM15.997 7.4V13.0256H16.697V7.4H15.997ZM11.947 3.35C14.1838 3.35 15.997 5.16325 15.997 7.4H16.697C16.697 4.77665 14.5704 2.65 11.947 2.65V3.35ZM9.09141 3.35H11.947V2.65H9.09141V3.35ZM7.78539 8.04507C7.78539 6.83005 8.77036 5.84507 9.98539 5.84507V5.14507C8.38376 5.14507 7.08539 6.44345 7.08539 8.04507H7.78539ZM7.78539 11.8101V8.04507H7.08539V11.8101H7.78539ZM9.98538 14.0101C8.77036 14.0101 7.78539 13.0251 7.78539 11.8101H7.08539C7.08539 13.4117 8.38376 14.7101 9.98538 14.7101V14.0101ZM11.0786 14.0101H9.98538V14.7101H11.0786V14.0101ZM13.2786 11.8101C13.2786 13.0251 12.2936 14.0101 11.0786 14.0101V14.7101C12.6802 14.7101 13.9786 13.4117 13.9786 11.8101H13.2786ZM13.2786 8.04507V11.8101H13.9786V8.04507H13.2786ZM11.0786 5.84507C12.2936 5.84507 13.2786 6.83004 13.2786 8.04507H13.9786C13.9786 6.44345 12.6802 5.14507 11.0786 5.14507V5.84507ZM9.98539 5.84507H11.0786V5.14507H9.98539V5.84507Z",fill:"#1C1C1C"}),ve.createElement("rect",{x:"0.35",y:"10.5629",width:"20.3",height:"17.5082",rx:"2.41596",fill:"#B3F8F8",stroke:"#1C1C1C",strokeWidth:"0.7",strokeLinecap:"round"}),ve.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.4866 20.0964C12.2255 19.7611 12.7339 19.0611 12.7339 18.2517C12.7339 17.1165 11.7338 16.1963 10.5002 16.1963C9.26654 16.1963 8.26648 17.1165 8.26648 18.2517C8.26648 19.061 8.77474 19.7611 9.51355 20.0963V22.3355C9.51355 22.8803 9.95524 23.322 10.5001 23.322C11.045 23.322 11.4866 22.8803 11.4866 22.3355V20.0964Z",fill:"white"}),ve.createElement("path",{d:"M11.4866 20.0964L11.342 19.7776L11.1366 19.8708V20.0964H11.4866ZM9.51355 20.0963H9.86355V19.8708L9.65818 19.7776L9.51355 20.0963ZM12.3839 18.2517C12.3839 18.9067 11.9722 19.4918 11.342 19.7776L11.6313 20.4151C12.4789 20.0305 13.0839 19.2154 13.0839 18.2517H12.3839ZM10.5002 16.5463C11.5685 16.5463 12.3839 17.3367 12.3839 18.2517H13.0839C13.0839 16.8964 11.8991 15.8463 10.5002 15.8463V16.5463ZM8.61648 18.2517C8.61648 17.3367 9.43186 16.5463 10.5002 16.5463V15.8463C9.10121 15.8463 7.91648 16.8964 7.91648 18.2517H8.61648ZM9.65818 19.7776C9.02814 19.4917 8.61648 18.9066 8.61648 18.2517H7.91648C7.91648 19.2154 8.52134 20.0304 9.36892 20.415L9.65818 19.7776ZM9.86355 22.3355V20.0963H9.16355V22.3355H9.86355ZM10.5001 22.972C10.1485 22.972 9.86355 22.687 9.86355 22.3355H9.16355C9.16355 23.0736 9.76194 23.672 10.5001 23.672V22.972ZM11.1366 22.3355C11.1366 22.687 10.8517 22.972 10.5001 22.972V23.672C11.2383 23.672 11.8366 23.0736 11.8366 22.3355H11.1366ZM11.1366 20.0964V22.3355H11.8366V20.0964H11.1366Z",fill:"#1C1C1C"}))),null),ve.createElement(He.x,{variant:"text-small",as:"p",weight:"normal"},"We’ll keep your data safe")),Content:({learnMoreURL:e})=>ve.createElement(Ne.k,{direction:"column",gap:2},ve.createElement(He.x,{variant:"text-xsmall",as:"p"},"When you start Authorship, its data is stored on your device in an encrypted format. When you see or share your report, this data is sent to Grammarly over an encrypted connection."),ve.createElement(Je.r,{href:e,variant:"primary",weight:"bold",target:"_blank",underline:"hover"},ve.createElement(He.x,{variant:"text-xsmall",as:"span"},"Learn more"," ",ve.createElement(Xe.J,{icon:et.n,accessibilityLabel:"",variant:"inherit",className:rt.linkIcon}))))},{id:"control",title:ve.createElement(Ne.k,{align:"center",gap:2},ve.createElement((()=>ve.createElement("svg",{width:"22",height:"32",viewBox:"0 0 22 32",fill:"none"},ve.createElement("rect",{x:"0.375",y:"6.375",width:"21.25",height:"7.25",rx:"3.625",fill:"#B3F8F8",stroke:"#1C1C1C",strokeWidth:"0.75"}),ve.createElement("circle",{cx:"18",cy:"10",r:"3.625",fill:"white",stroke:"#1C1C1C",strokeWidth:"0.75"}),ve.createElement("rect",{x:"-0.375",y:"0.375",width:"21.25",height:"7.25",rx:"3.625",transform:"matrix(-1 0 0 1 21.25 18)",fill:"white",stroke:"#1C1C1C",strokeWidth:"0.75"}),ve.createElement("circle",{cx:"4",cy:"4",r:"3.625",transform:"matrix(-1 0 0 1 8 18)",fill:"white",stroke:"#1C1C1C",strokeWidth:"0.75"}))),null),ve.createElement(He.x,{variant:"text-small",as:"p",weight:"normal"},"You’re always in control")),Content:({learnMoreURL:e})=>ve.createElement(Ne.k,{direction:"column",gap:2},ve.createElement(He.x,{variant:"text-xsmall",as:"p"},"You choose when Authorship tracks your writing activity and when you share your report. You can stop sharing your report or delete your writing activity data anytime."),ve.createElement(Je.r,{href:e,variant:"primary",weight:"bold",target:"_blank",underline:"hover"},ve.createElement(He.x,{variant:"text-xsmall",as:"span"},"Learn more"," ",ve.createElement(Xe.J,{icon:et.n,accessibilityLabel:"",variant:"inherit",className:rt.linkIcon}))))}],at={width:Pe.ux.rem(5.1875),height:Pe.ux.rem(5.1875/4.61)},ot={$nest:{"& .gds-modal-content":{minWidth:"860px"},"& .gds-modal-medium":{width:"860px"},"& .gds-modal-header":{display:"none"},"& .gds-modal-body":{padding:Pe.ux.rem(Ge.x0)},"& .gds-heading-large":{fontSize:Pe.ux.rem(2.25),lineHeight:"1.11em"}}},st=Pe.ux.stylesheet({logo:[at],link:[{whiteSpace:"normal"}],linkIcon:[{verticalAlign:"top"}],flip:[{transform:"rotate(180deg)"}],modal:[ot]}),ct=(0,tt.xb)(Je.r),lt=(0,tt.xb)((({learnMoreURLs:e})=>{const[t,n]=ve.useState([]);return ve.createElement("div",{className:rt.accordionRoot},ve.createElement("div",null,it.map((({id:r,title:i,Content:a})=>{const o=t.includes(r),s=`optInAccordion-title-${r}`,c=`optInAccordion-content-${r}`;return ve.createElement("div",{key:r,className:`${rt.accordionItem}`},ve.createElement("button",{id:s,className:rt.accordionHeader,onClick:()=>{n(o?[]:[r])},"aria-controls":c,"aria-expanded":o},ve.createElement("div",{className:rt.accordionTrigger},i,ve.createElement(Ne.k,{className:`${rt.accordionIcon} ${o?rt.rotate:""}`},ve.createElement(Xe.J,{size:"large",icon:nt.p,accessibilityLabel:o?"Collapse section":"Expand section"})))),ve.createElement("div",{role:"region","aria-labelledby":s,className:`${rt.accordionContent} ${o?rt.shown:""}`},ve.createElement(a,{learnMoreURL:e[r]})))}))))})),dt=Se.UI.Node.make((({view:e,state:t,notify:n})=>ve.createElement(Be.u_,{isOpen:!0,onClose:n({kind:"closeOptInPopup"}),title:"",dismissOnOutsideClick:!1,width:"medium",role:"alertdialog",className:st.modal},ve.createElement(Be.u_.Body,null,ve.createElement(We.o,null,ve.createElement(Ne.k,{direction:"row",gap:6},ve.createElement(Ne.k,{direction:"column",gap:10,flex:"1 1 50%"},ve.createElement(Qe.c,{className:st.logo}),ve.createElement(Ne.k,{direction:"column",gap:3},ve.createElement($e.X,{as:"h1",variant:"heading-large"},"Prove where your",ve.createElement("br",null),"words come from"),ve.createElement(He.x,{as:"p"},"With Grammarly Authorship, you can certify what you type, copy, or generate with AI. You choose how to share this information."),ve.createElement(ct,{href:e("howItWorksURL"),variant:"primary",weight:"bold",target:"_blank",underline:"hover"},"See how it works"," ",ve.createElement(Xe.J,{icon:et.n,accessibilityLabel:"",variant:"inherit",className:st.linkIcon}))),ve.createElement(ze.z,{text:"OK",onClick:n({kind:"optIn"})})),ve.createElement(Ne.k,{direction:"column",gap:3,flex:"1 1 50%",align:"stretch"},ve.createElement(Ne.k,{direction:"row",flex:"1 0 0%",align:"center"},ve.createElement(lt,{learnMoreURLs:t.pipe(c.U((({learnMoreTransparencyURL:e,learnMoreSafetyURL:t,learnMoreControlURL:n})=>({transparency:e,safety:t,control:n}))))})),ve.createElement(He.x,{as:"p",color:"base-subdued",variant:"text-xsmall"},"By tracking writing activity, the terms in your agreement with Grammarly (",ve.createElement(Je.r,{href:"https://www.grammarly.com/terms/customer-business-agreement",variant:"secondary",className:st.link},"Customer Business Agreement"),", ",ve.createElement(Je.r,{href:"https://www.grammarly.com/terms",variant:"secondary",className:st.link},"Terms and Conditions")," ","and our"," ",ve.createElement(Je.r,{href:"https://www.grammarly.com/privacy-policy",variant:"secondary",className:st.link},"Privacy Policy"),", as applicable) will apply.")))))))),ut=Se.UI.Union.make("kind",{optIn:dt,clipboardAccess:je,feedback:Ye}),ht=Se.UI.Union.asOption(ut);var mt=n(81259);const pt=Pe.ux.stylesheet({toast:[{$nest:{"&&":{minWidth:"376px"}}}]}),gt=Se.UI.Node.make((({notify:e})=>ve.createElement(mt.F,{variant:"success",text:"Grammarly is tracking your writing activity in this document. Click the icon to stop tracking or see your report.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:pt.toast}))),ft=(0,tt.xb)(mt.F),_t=Se.UI.Node.make((({state:e,notify:t})=>ve.createElement(ft,{variant:"success",text:e.pipe(c.U((({domain:e,wasNewDocument:t})=>`Authorship ${t?"is tracking your writing activity in this doc. It will start tracking":"will start tracking your writing activity"} anytime you create a new ${"docs.google.com"===e?"Google doc":`doc on ${e}`}.`))),onClose:t({kind:"dismissToast"}),onMouseEnter:t({kind:"toastHover",hovered:!0}),onMouseLeave:t({kind:"toastHover",hovered:!1}),className:pt.toast}))),kt=Se.UI.Node.make((({notify:e})=>ve.createElement(mt.F,{variant:"success",text:"Grammarly Authorship is turned off. If you want the option to track your writing activity, you can turn it on in Settings.",primaryAction:ve.createElement(ze.z,{text:"OK",variant:"primary",onClick:e({kind:"optOutToastOkClick"})}),onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:pt.toast}))),bt=Se.UI.Node.make((({notify:e})=>ve.createElement(mt.F,{variant:"success",text:"Grammarly Authorship is now available. Start it to track your writing activity in a doc.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:pt.toast}))),vt=Se.UI.Node.make((({notify:e})=>ve.createElement(mt.F,{variant:"critical",text:"Could not generate Authorship Report. Please try again later.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:pt.toast}))),yt=Se.UI.Node.make((({notify:e})=>ve.createElement(mt.F,{variant:"critical",text:"An error occurred while saving your editing history data.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:pt.toast}))),Ct=Se.UI.Node.make((({notify:e})=>ve.createElement(mt.F,{variant:"critical",text:"Could not retrieve editing history data. Tracking will start from scratch.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:pt.toast}))),xt=Se.UI.Node.make((({notify:e})=>ve.createElement(mt.F,{variant:"critical",text:"An error occurred while communicating with the server. Please try again later.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:pt.toast}))),wt=Se.UI.Node.make((({notify:e})=>ve.createElement(mt.F,{variant:"warning",text:"Authorship lost access to your clipboard, so it can’t accurately record text you copy and paste. Try restarting your browser.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:pt.toast}))),St=Se.UI.Node.make((({notify:e})=>ve.createElement(mt.F,{variant:"warning",text:"Without clipboard access, Authorship will mark any text you paste as “Copied from unknown source.” To accurately record your sources, allow clipboard access.",primaryAction:ve.createElement(ze.z,{text:"Allow clipboard access",variant:"primary",onClick:e({kind:"clipboardWarningResult",result:"allow"})}),secondaryAction:ve.createElement(ze.z,{text:"Deny",variant:"ghost",onClick:e({kind:"clipboardWarningResult",result:"deny"})}),onClose:e({kind:"clipboardWarningResult",result:"close"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:pt.toast}))),Et=Se.UI.Union.make("kind",{documentTrackingStarted:gt,domainTrackingStarted:_t,domainTrackingStartedWhenAlreadyTracked:_t,optedOut:kt,optedIn:bt,reportGenerationFailed:vt,clipboardWarning:St,clipboardPermissionRequestFailed:wt,storageUnrecoverableError:yt,storageDatabaseCorrupted:Ct,storageServerError:xt}),It=Se.UI.Union.asOption(Et);var Tt=n(61483),Dt=n(68148),At=n(53768);const Rt=Pe.ux.keyframes({"0%":{backgroundColor:At.Red40},"100%":{backgroundColor:At.Red20}}),Mt={width:Pe.ux.rem(.5),height:Pe.ux.rem(.5),borderRadius:Pe.ux.rem(.25),borderWidth:Pe.ux.rem(.125),borderStyle:"solid",borderColor:Tt.I.Background.Base.Default,backgroundColor:At.Red40,boxShadow:Dt.H8.boxShadow,animationName:Rt,animationDuration:"1.5s",animationIterationCount:"infinite",animationDirection:"alternate",animationFillMode:"both",animationTimingFunction:"ease-in-out"},Lt=Pe.ux.stylesheet({dot:[Mt]}),Ft=()=>ve.createElement("div",{className:Lt.dot}),Ut=()=>ve.createElement("svg",{viewBox:"0 0 20 20",fill:"none",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2"},ve.createElement("path",{d:"M8.46121 16.6668V10.0641C8.46121 9.21446 9.15001 8.52567 9.99967 8.52567C10.8493 8.52567 11.5381 9.21446 11.5381 10.0641V11.6668M11.5381 14.4446V16.6668M14.1022 15.0001V10.0641C14.1022 7.79834 12.2655 5.96156 9.99967 5.96156C7.73389 5.96156 5.89711 7.79834 5.89711 10.0641V11.1112M5.89711 15.5557V13.889M3.33301 12.2223V10.0641C3.33301 6.38223 6.31778 3.39746 9.99967 3.39746C11.7507 3.39746 13.344 4.07253 14.5336 5.1766M16.6663 13.3334V10.0641C16.6663 9.26096 16.5243 8.49096 16.264 7.77789",stroke:"inherit",strokeWidth:"1.25",strokeLinecap:"round",fill:"inherit"})),Pt={width:Pe.ux.rem(1.5),height:Pe.ux.rem(1.5),display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",borderRadius:"50%",$nest:{svg:{width:Pe.ux.rem(1.25),height:Pe.ux.rem(1.25),stroke:Tt.I.Icon.Base.Default},"&.active":{backgroundColor:Tt.I.Icon.Brand.Default,$nest:{svg:{stroke:Tt.I.Icon.Base.Inverse}}}}},Gt={background:"none",border:"none",borderRadius:"50%",width:Pe.ux.rem(1.5),height:Pe.ux.rem(1.5),cursor:"pointer",position:"relative",boxShadow:Dt.H8.boxShadow,padding:0,$nest:{"&:focus-visible":{outline:`2px solid ${Tt.I.Border.Brand.Default}`,outlineOffset:"2px"}}},Bt={position:"absolute",right:Pe.ux.rem(-.375),top:Pe.ux.rem(-.375)},Nt=Pe.ux.stylesheet({icon:[Pt],button:[Gt],activityIndicator:[Bt]}),Ot=Se.UI.Node.make((({view:e,notify:t})=>ve.createElement(ve.Fragment,null,ve.createElement(Ue.F.button,{className:Nt.button,"aria-label":e("trackingState").pipe(c.U((e=>"tracking"===e?"Press to pause authorship tracking":"Press to start authorship tracking"))),onClick:t({kind:"trackingButtonClick"})},ve.createElement(Ue.F.div,{className:e("trackingState").pipe(c.U((e=>"tracking"===e?`${Nt.icon} active`:`${Nt.icon}`)))},ve.createElement(Ut,null),e("trackingState").pipe(c.U((e=>"tracking"===e?ve.createElement("div",{className:Nt.activityIndicator},ve.createElement(Ft,null)):null))))))));var $t=n(18473),Ht=n(37632),zt=n(12712),Wt=n(64803),Zt=n(19220);const Kt=e=>ve.createElement("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},ve.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.2625 13.1803C16.6996 12.2512 15.2954 12.2512 14.7325 13.1803L5.21017 28.8601C4.45482 30.1036 5.88068 31.5114 7.18364 30.8153L15.289 26.4999C15.7282 26.2684 16.2668 26.2684 16.706 26.4999L24.8113 30.8153C26.1219 31.5111 27.5402 30.1035 26.793 28.8601L17.2625 13.1803ZM15.9975 1C13.4221 1 11.3318 3.03027 11.3318 5.52497C11.3324 8.02727 13.4224 10.0479 15.9975 10.0479C18.5802 10.0479 20.6688 8.02724 20.6693 5.52497C20.6693 3.0303 18.5805 1.00005 15.9975 1Z",fill:"var(--color-logo-superhuman-default)"}));Kt.__brand="nocolor";var qt=n(24664);const jt=()=>ve.createElement("svg",{viewBox:"0 0 18 18",fill:"none"},ve.createElement("rect",{y:"0.00585938",width:"18",height:"18",rx:"9",fill:"#B356B3"}),ve.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.26851 7.71073C6.50719 7.16012 6.81849 6.6436 7.19862 6.1694C7.25292 6.1012 7.27692 6.01343 7.26429 5.92692C7.25229 5.84042 7.2043 5.76338 7.13295 5.7135C6.8166 5.49123 6.49899 5.27591 6.18074 5.05996C6.0715 4.98608 5.9288 4.98797 5.81956 5.06501C4.53711 5.98565 3.60321 7.32998 3.19088 8.85051C2.98819 9.59371 2.76656 11.0094 3.56217 12.1403C4.07995 12.8702 4.97722 13.3034 5.86439 13.3034C6.10055 13.3034 6.33607 13.2731 6.56402 13.2093C7.4714 12.9593 8.17674 12.2571 8.45015 11.3308C8.7343 10.3672 8.51456 9.35502 7.86165 8.62256C7.44551 8.1534 6.881 7.83323 6.26851 7.71073Z",fill:"white"}),ve.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.2897 8.62294C13.8736 8.15378 13.3084 7.83363 12.6966 7.71113C12.9353 7.15926 13.2478 6.64211 13.626 6.16916C13.681 6.1016 13.705 6.01383 13.693 5.92669C13.6804 5.84081 13.6324 5.76378 13.561 5.71326C13.244 5.49163 12.927 5.27505 12.6088 5.05973C12.4989 4.98585 12.3556 4.98837 12.2476 5.06478C10.9645 5.98541 10.0313 7.33038 9.61894 8.85025C9.41562 9.59472 9.19525 11.0117 9.98897 12.14C10.5074 12.8706 11.4046 13.3038 12.2925 13.3038C12.5286 13.3038 12.7648 13.2728 12.9921 13.2097C13.8995 12.9597 14.6048 12.2581 14.8782 11.3324C15.1623 10.3689 14.9426 9.3554 14.2897 8.62294Z",fill:"white"})),Vt={$nest:{"&&":{paddingLeft:Pe.ux.rem(Ge.x),paddingRight:Pe.ux.rem(Ge.x)}}},Yt={width:Pe.ux.rem(Ge.Ze),$nest:{svg:{display:"inline-block",width:"18px",padding:"2px"}}},Jt=Pe.ux.stylesheet({aipd:[Yt],button:[Vt]}),Qt=Se.UI.Union.asOption(Se.UI.Node.make((({notify:e})=>ve.createElement(ze.z,{onClick:e({kind:"plagiarismCheckRequest"}),variant:"tertiary",size:"2xlarge",width:"full",className:Jt.button,ref:t=>{t&&e({kind:"plagiarismCheckButtonRender"})()}},ve.createElement(Ne.k,{direction:"row",gap:3,align:"start",justify:"start",width:"100%"},ve.createElement("div",{className:Jt.aipd},ve.createElement(jt,null)),ve.createElement(Ne.k,{direction:"column",gap:1,width:"100%"},ve.createElement(Ne.k,{direction:"row",gap:2,justify:"space-between"},ve.createElement(He.x,{as:"span",color:"base-default",variant:"text-small",weight:"medium"},"Check for AI & plagiarism"),ve.createElement(qt.O,{variant:"pro",size:"xsmall"})),ve.createElement(He.x,{as:"span",color:"base-subdued",variant:"text-xsmall"},"Verify originality and get citations")))))));var Xt=n(7043),en=n(76282);const tn={pointerEvents:"none",transition:"box-shadow 0.3s",transitionTimingFunction:"ease-out",borderRadius:"11px",overflow:"visible",boxShadow:"0px 0 0 0 rgba(0,0,0,0)",$nest:{"&.active":{boxShadow:Dt.H8.boxShadow},".bg":{transition:"fill 0.3s",transitionTimingFunction:"ease-out",fill:Tt.I.Background.Base.Subdued},".stroke":{transition:"stroke 0.3s",transitionTimingFunction:"ease-out",stroke:Tt.I.Border.Base.Default},"&.active .bg":{fill:Tt.I.Background.Brand.Default},"&.active .stroke":{stroke:Tt.I.Background.Brand.Default}}},nn={transition:"all 0.3s",transitionTimingFunction:"ease-out",$nest:{"path:last-child":{stroke:Tt.I.Icon.Base.Default},"&.active":{transform:"translateX(10px)",$nest:{"path:last-child":{stroke:Tt.I.Icon.Brand.Default}}}}},rn=Pe.ux.stylesheet({root:[tn],icon:[nn]}),an=({active:e,className:t})=>ve.createElement("svg",{width:"32",height:"22",viewBox:"0 0 32 22",fillRule:"evenodd",clipRule:"evenodd",className:`${rn.root} ${t||""} ${e?"active":""}`},ve.createElement("path",{className:"bg",d:"M31.75,11C31.75,5.067 26.933,0.25 21,0.25L11,0.25C5.067,0.25 0.25,5.067 0.25,11C0.25,16.933 5.067,21.75 11,21.75L21,21.75C26.933,21.75 31.75,16.933 31.75,11Z",fill:"inherit"}),ve.createElement("path",{className:"stroke",d:"M31.75,11C31.75,5.067 26.933,0.25 21,0.25L11,0.25C5.067,0.25 0.25,5.067 0.25,11C0.25,16.933 5.067,21.75 11,21.75L21,21.75C26.933,21.75 31.75,16.933 31.75,11Z",fill:"none",stroke:"inherit",strokeWidth:"0.5px"}),ve.createElement("g",{filter:"url(#switchVisual_filter_1)",className:`${rn.icon} ${e?"active":""}`},ve.createElement("path",{d:"M20,11.003C20,6.036 15.967,2.003 11,2.003C6.033,2.003 2,6.036 2,11.003C2,15.97 6.033,20.003 11,20.003C15.967,20.003 20,15.97 20,11.003Z",fill:"white"}),ve.createElement("path",{d:"M9.615,17.003L9.615,11.061C9.615,10.296 10.235,9.676 11,9.676C11.765,9.676 12.385,10.296 12.385,11.061L12.385,12.503M12.385,15.003L12.385,17.003M14.692,15.503L14.692,11.061C14.692,9.021 13.039,7.368 11,7.368C8.961,7.368 7.308,9.021 7.308,11.061L7.308,12.003M7.308,16.003L7.308,14.503M5,13.003L5,11.061C5,7.747 7.686,5.061 11,5.061C12.576,5.061 14.01,5.668 15.081,6.662M17,14.003L17,11.061C17,10.338 16.872,9.645 16.638,9.003",fill:"none",fillRule:"nonzero",stroke:"inherit",strokeWidth:"1px",strokeLinecap:"round"})),ve.createElement("defs",null,ve.createElement("filter",{id:"switchVisual_filter_1",x:"0",y:"0.00891113",width:"24",height:"24",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},ve.createElement("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),ve.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),ve.createElement("feOffset",{dy:"1"}),ve.createElement("feGaussianBlur",{stdDeviation:"1.5"}),ve.createElement("feComposite",{in2:"hardAlpha",operator:"out"}),ve.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"}),ve.createElement("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_9756_7855"}),ve.createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_9756_7855",result:"shape"})))),on={position:"relative",display:"inline-block",alignSelf:"flex-start",$nest:{"&& div[data-size]":{width:Pe.ux.rem(Ge.Ze)},"&& input":{width:Pe.ux.rem(Ge.Ze)},"input + svg":{visibility:"hidden"}}},sn=Pe.ux.stylesheet({switch:[on],switchVisual:[{position:"absolute",right:0,top:0,$nest:{"&.labelRight":{left:0,right:"auto"}}}]}),cn=e=>ve.createElement("span",{className:sn.switch},ve.createElement(en.r,{...e},e.children),ve.createElement(an,{active:Boolean(e.checked),className:`${sn.switchVisual} ${"right"===e.labelDisplay?"labelRight":""}`}));function ln(e,t){switch(t){case"available":case"newDocument":return e({kind:"start"});case"paused":return e({kind:"resume"});case"tracking":return e({kind:"pause"});default:return}}function dn(e){switch(e){case"available":case"newDocument":return"Track writing for proof of authorship";case"paused":return"Tracking is paused";case"tracking":return"Tracking is currently on";default:return}}const un=Se.UI.Node.make((({state:e,notify:t})=>ve.createElement(Ne.k,{direction:"row",gap:2,align:"start",justify:"space-between",width:"100%"},ve.createElement(Ue.F.Fragment,null,e.pipe(c.U((({trackingState:e})=>ve.createElement(ve.Fragment,null,ve.createElement(cn,{label:"Track your work",labelDisplay:"right",defaultSelected:"tracking"===e,checked:"tracking"===e,helperMessage:dn(e),onChange:ln(t,e)}),"available"!==e&&"newDocument"!==e&&ve.createElement(ze.z,{iconEnd:Xt.l,size:"small",text:"See report",onClick:t({kind:"viewReport"})})))))))));var hn=n(27389),mn=n(20995);const pn=Se.UI.Node.make((({notify:e,view:t,state:n})=>ve.createElement(hn.v,{activator:ve.createElement(zt.h,{accessibilityLabel:"Settings",icon:mn.a,variant:"tertiary",size:"small","aria-controls":"hwr-settings-menu"})},ve.createElement(Ue.F.Fragment,null,n.pipe(c.U((({enabledForDomain:t,domain:n})=>{const r="docs.google.com"===n?"all new Google Docs":`all new documents on ${n}`;return t?ve.createElement(ve.Fragment,null,ve.createElement(hn.v.Item,{key:"startAutomatically",onClick:e({kind:"resetForDomain"}),"aria-describedby":"domain_tracking_label"},"Turn off automatic tracking"),ve.createElement(He.x,{id:"domain_tracking_label",as:"label",variant:"text-xsmall",color:"base-subdued",marginLeft:2,marginRight:2},"Automatic tracking records proof of your writing activity for ",r)):ve.createElement(ve.Fragment,null,ve.createElement(hn.v.Item,{key:"startAutomatically",onClick:e({kind:"enableForDomain",isNewDocument:!1}),"aria-describedby":"domain_tracking_label"},"Turn on automatic tracking"),ve.createElement(He.x,{id:"domain_tracking_label",as:"label",variant:"text-xsmall",color:"base-subdued",marginLeft:2,marginRight:2},"Automatic tracking records proof of your writing activity for ",r))})))),ve.createElement(hn.v.Separator,{role:"separator"}),ve.createElement(Ue.F.Fragment,null,t("urls").pipe(c.U((e=>ve.createElement(ve.Fragment,null,ve.createElement(hn.v.Item,{key:"howItWorks",href:e.howItWorks,target:"_blank"},"How Authorship works?"),ve.createElement(hn.v.Item,{key:"reportAnIssue",href:e.reportAnIssue,target:"_blank"},"Report an issue")))))),ve.createElement(hn.v.Item,{key:"giveFeedback",onClick:e({kind:"giveFeedback"})},"Give feedback"),ve.createElement(hn.v.Separator,{role:"separator"}),ve.createElement(hn.v.Item,{key:"turnOfAuthorship",onClick:e({kind:"optOut"})},"Turn off Authorship")))),gn=Se.UI.Knot.make(Se.UI.Grid.make((({slots:e,notify:t})=>ve.createElement(Zt.d,{onClickAway:t({kind:"trackingButtonClickAway"})},ve.createElement(Ne.k,{direction:"column",bgColor:"background-base-default",borderRadius:2,style:{boxShadow:Dt.hw.boxShadow,borderColor:Dt.hw.border,position:"relative"}},ve.createElement(Ne.k,{direction:"column",padding:2,width:"304px"},ve.createElement(Ne.k,{direction:"row",align:"center",justify:"space-between"},ve.createElement(Xe.J,{icon:(0,$t.Y)()?Kt:Ht.H,accessibilityLabel:"Grammarly",size:"small"}),ve.createElement(Ne.k,{direction:"row",alignSelf:"end"},ve.createElement(Ue.F.Fragment,null,e.menu),ve.createElement(zt.h,{accessibilityLabel:"Close",icon:Wt.V,variant:"tertiary",onClick:t({kind:"trackingButtonCloseClick"}),size:"small"}))),ve.createElement(Ne.k,{padding:2},ve.createElement(Ue.F.Fragment,null,e.controls)),ve.createElement(Ue.F.Fragment,null,e.plagiarismCheckButton)))))),{menu:pn,controls:un,plagiarismCheckButton:Qt}),fn=Se.UI.Union.make("state",{compact:Ot,expanded:gn}),_n=Se.UI.Union.asOption(fn),kn=Se.UI.Grid.make((({slots:e,view:t})=>ve.createElement(Ue.F.div,{"data-grammarly-part":"human-writing-report-button",style:{position:"fixed",left:t("offsetLeft"),bottom:t("offsetBottom"),zIndex:1e4}},e.popup,e.trackingButton,ve.createElement(Ue.F.div,{style:{position:"absolute",left:"100%",bottom:0}},e.toast)))),bn=Se.UI.Knot.make(kn,{trackingButton:_n,popup:ht,toast:It}),vn=Se.UI.Union.asOption(bn);function yn(e){return Se.Z.fromSideEffect((t=>{e.next(t)}),Z.of(null))}function Cn(e){return Se.Z.fromSideEffect((t=>{e.next(t)}),Z.of(null))}function xn(e,t){return Se.Z.fromSideEffect((e=>{t.next({kind:e.kind})}),e.pipe(ye.oA,c.U((({urls:e})=>({howItWorksURL:e.howItWorks,learnMoreTransparencyURL:e.learnMoreTransparency,learnMoreSafetyURL:e.learnMoreSafety,learnMoreControlURL:e.learnMoreControl})))))}function wn(e,t){return Se.Z.composeUnion({optIn:xn(e,t),clipboardAccess:yn(t),feedback:Cn(t)},(()=>e.pipe(ye.oA,Ce.j("popup"),ye.oA,c.U((e=>({kind:e}))))))}function Sn(e,t){return Se.Z.composeUnion({None:()=>Z.of(null),Some:Se.Z.composeKnot({value:wn(e,t)})},(()=>e.pipe(ye.oA,Ce.j("popup"))))}function En(e,t){return Se.Z.composeUnion({documentTrackingStarted:Se.Z.fromSideEffect((e=>{t.next({...e})}),Z.of(null)),domainTrackingStarted:Se.Z.fromSideEffect((e=>{t.next({...e})}),e.pipe(ye.oA,c.U((({domain:e})=>({domain:e,wasNewDocument:!0}))))),domainTrackingStartedWhenAlreadyTracked:Se.Z.fromSideEffect((e=>{t.next({...e})}),e.pipe(ye.oA,c.U((({domain:e})=>({domain:e,wasNewDocument:!1}))))),optedOut:Se.Z.fromSideEffect((e=>{t.next({...e})}),Z.of(null)),optedIn:Se.Z.fromSideEffect((e=>{t.next({...e})}),Z.of(null)),reportGenerationFailed:Se.Z.fromSideEffect((e=>{t.next({...e})}),Z.of(null)),clipboardWarning:Se.Z.fromSideEffect((e=>{t.next({...e})}),Z.of(null)),clipboardPermissionRequestFailed:Se.Z.fromSideEffect((e=>{t.next({...e})}),Z.of(null)),storageDatabaseCorrupted:Se.Z.fromSideEffect((e=>{t.next({...e})}),Z.of(null)),storageUnrecoverableError:Se.Z.fromSideEffect((e=>{t.next({...e})}),Z.of(null)),storageServerError:Se.Z.fromSideEffect((e=>{t.next({...e})}),Z.of(null))},(()=>e.pipe(ye.oA,Ce.j("toast"),ye.oA,c.U((e=>({kind:e}))))))}function In(e,t){return Se.Z.composeUnion({None:()=>Z.of(null),Some:Se.Z.composeKnot({value:En(e,t)})},(()=>e.pipe(ye.oA,Ce.j("toast"))))}function Tn(e,t){return Se.Z.fromSideEffect((e=>{t.next(e)}),e.pipe(ye.oA))}function Dn(e,t){return Se.Z.composeUnion({None:()=>Z.of(null),Some:Se.Z.composeKnot({value:Se.Z.fromSideEffect((e=>{t.next(e)}),Z.of(null))})},(()=>e.pipe(ye.cp((({plagiarismCheckAvailable:e})=>e?Z.of(g.G(null)):Z.of(g.YP))))))}function An(e,t){return Se.Z.fromSideEffect((e=>{t.next(e)}),e.pipe(ye.oA,c.U((({trackingState:e})=>({trackingState:e})))))}function Rn(e,t){return Se.Z.fromSideEffect((e=>{t.next(e)}),e.pipe(ye.oA,c.U((({urls:e,enabledForDomain:t,domain:n})=>({urls:e,enabledForDomain:t,domain:n})))))}function Mn(e,t){return Se.Z.composeKnot({controls:An(e,t),menu:Rn(e,t),plagiarismCheckButton:Dn(e,t),root:Se.Z.fromSideEffect((e=>{t.next(e)}),Z.of(null))})}function Ln(e,t){return Se.Z.composeUnion({compact:Tn(e,t),expanded:Mn(e,t)},(()=>e.pipe(ye.oA,c.U((({trackingButtonExpanded:e})=>({state:e?"expanded":"compact"}))))))}class Fn{constructor(e,t,n,r,i,s,c=Le,l){this.actions=t,this.errors=n,this._events=r,this._documentId=i,this._gnar=s,this._createTButtonPositionSource=c,this._requestPlagiarismCheck=l,this._state=a.h.create(g.YP),this._tButtonPosition=a.h.create(Me),this.state=this._state.view(),this.tButtonPosition=this._tButtonPosition.view(),this._subs=new o.w0,this._domain=e.view("page").view("domain").get(),this._subs.add(this._handleCSStateChange(e).subscribe()),this._subs.add(this._handleActions().subscribe()),this._subs.add(this._handleErrors().subscribe()),this._subs.add(this._handleEvents().subscribe()),this._subs.add(this._handleEnabledForDomainOnce().subscribe()),this._subs.add(this._autocloseToast().subscribe()),this._subs.add(this._handleToastShow().subscribe()),this._subs.add(c().subscribe(J.wW(this._tButtonPosition)))}_handleCSStateChange(e){return e.pipe(c.U((e=>{this._state.modify((t=>{var n;const i=null!==(n=e.page.humanWritingReport)&&void 0!==n?n:w.wg;return e.page.enabled&&("optedOut"===i.kind||"available"===i.kind||"enabled"===i.kind)?(0,r.zG)(t,g.UI((t=>this._reducePageStateToLocalState(e,t))),g.wp((()=>g.G(this._reducePageStateToLocalState(e))))):g.YP}))})))}_reducePageStateToLocalState({page:{domain:e,humanWritingReport:t=w.wg},dynamicConfig:n},r){var i;return{trackingState:"optedOut"===t.kind?"optedOut":"available"===t.kind?"available":(0,w.MP)(this._documentId,this._domain,t)?(0,w.Ng)(this._documentId,this._domain,t)?"tracking":"paused":"newDocument",optInPopupWasClosedOnce:"available"!==t.kind||t.optInPopUpWasClosedAtLeastOnce,trackingButtonExpanded:!!r&&r.trackingButtonExpanded,enabledForDomain:(0,w.E3)(this._domain,t),domain:e,popup:r?r.popup:g.YP,toast:r?r.toast:g.YP,urls:{...te.ym,...null===(i=null==n?void 0:n.hwr)||void 0===i?void 0:i.urls},plagiarismCheckAvailable:void 0!==this._requestPlagiarismCheck}}_handleEnabledForDomainOnce(){return this.actions.pipe(d.h((e=>"enableForDomain"===e.kind)),h.q(1),l.b((({isNewDocument:e})=>this._state.modify((t=>(0,r.zG)(t,g.tS((t=>{const n={...t,toast:g.G(e?"domainTrackingStarted":"domainTrackingStartedWhenAlreadyTracked")};return g.G(n)}))))))))}_handleToastShow(){return this._state.pipe(ye.oA,Ce.j("toast"),ye.oA,l.b((e=>{switch(e){case"documentTrackingStarted":case"domainTrackingStarted":case"domainTrackingStartedWhenAlreadyTracked":case"optedOut":case"optedIn":case"clipboardWarning":this._gnar.hwrToastShow(this._documentId,"info",e);break;case"clipboardPermissionRequestFailed":case"storageDatabaseCorrupted":case"reportGenerationFailed":case"storageUnrecoverableError":case"storageServerError":this._gnar.hwrToastShow(this._documentId,"error",e)}})))}_autocloseToast(){const e=this.actions.pipe(d.h((e=>"toastHover"===e.kind)),Ce.j("hovered"),xe.O(!1));return this._state.pipe(ye.oA,Ce.j("toast"),ye.oA,u.w((t=>"clipboardWarning"===t?m.E:G.S(e.pipe(u.w((e=>e?m.E:we.timer(te.bd)))),this.actions.pipe(d.h((e=>"dismissToast"===e.kind)))))),l.b((()=>{this._state.modify((e=>(0,r.zG)(e,g.tS((e=>g.G({...e,toast:g.YP}))))))})))}_handleActions(){return this.actions.pipe(l.b((e=>{this._state.modify((t=>(0,r.zG)(t,g.tS((t=>{var n;switch(e.kind){case"trackingButtonClick":return"available"===t.trackingState?(0,r.zG)(t.popup,g.hX((e=>"optIn"===e)),g.WG)?g.G({...t,popup:g.YP,optInPopupWasClosedOnce:!0}):(this._gnar.hwrOptInPopupShow(this._documentId),g.G({...t,popup:g.G("optIn")})):g.G({...t,trackingButtonExpanded:!0,toast:g.YP});case"trackingButtonClickAway":case"trackingButtonCloseClick":case"viewReport":return g.G({...t,trackingButtonExpanded:!1});case"pause":return g.G({...t,trackingState:"paused"});case"resume":case"start":return g.G({...t,trackingState:"tracking"});case"closeOptInPopup":return this._gnar.hwrOptInPopupClose(this._documentId),g.G({...t,trackingState:"newDocument",optInPopupWasClosedOnce:!0,trackingButtonExpanded:!1,popup:g.YP,toast:g.G("optedIn")});case"optOut":return g.G({...t,trackingState:"optedOut",optInPopupWasClosedOnce:!0,trackingButtonExpanded:!1,popup:g.YP,toast:g.G("optedOut")});case"optIn":return g.G({...t,trackingState:"newDocument",optInPopupWasClosedOnce:!0,trackingButtonExpanded:!0,popup:g.YP,toast:g.G("optedIn")});case"enableForDomain":return g.G({...t,trackingState:e.isNewDocument?"tracking":t.trackingState});case"resetForDomain":case"toastHover":return g.G({...t});case"plagiarismCheckButtonRender":return this._gnar.hwrPlagiarismButtonShow(this._documentId),g.G({...t});case"plagiarismCheckRequest":return this._gnar.hwrPlagiarismButtonClick(this._documentId),null===(n=this._requestPlagiarismCheck)||void 0===n||n.call(this),g.G({...t,trackingButtonExpanded:!1});case"optOutToastOkClick":case"dismissToast":case"clipboardWarningResult":return g.G({...t,toast:g.YP});case"clipboardRequestResult":return"allow"===e.result?g.G({...t,popup:g.YP}):g.G({...t,popup:g.YP,toast:g.G("clipboardWarning")});case"giveFeedback":return this._gnar.hwrGiveFeedbackButtonClick(this._documentId,this._domain),g.G({...t,popup:g.G("feedback")});case"feedbackPopupClose":return g.G({...t,popup:g.YP});case"feedbackSubmit":return this._gnar.hwrFeedbackSubmit(this._documentId,this._domain,e.feedback),g.G(t);default:(0,i.L0)(e)}})))))})))}_handleErrors(){return this.errors.pipe(l.b((e=>{this._state.modify((t=>(0,r.zG)(t,g.tS((t=>{switch(e.kind){case"reportGenerationFailed":return g.G({...t,toast:g.G("reportGenerationFailed")});case"clipboardPermissionRequestFailed":return g.G({...t,toast:g.G("clipboardPermissionRequestFailed")});case"databaseCorrupted":return g.G({...t,toast:g.G("storageDatabaseCorrupted")});case"serverError":return g.G({...t,toast:g.G("storageServerError"),trackingState:"paused"});case"unrecoverableError":return g.G({...t,toast:g.G("storageUnrecoverableError"),trackingState:"paused"})}})))))})))}_handleEvents(){return this._events.pipe(d.h((e=>"clipboardAccessRequested"===e.kind)),l.b((e=>{this._state.modify((e=>(0,r.zG)(e,g.tS((e=>g.G({...e,popup:g.G("clipboardAccess"),toast:g.YP}))))))})))}view(){return ve.createElement(Ee.w,null,ve.createElement(Ie.L,{chunkName:"humanWritingReport"},Se.UI.mount(vn,(e=this,Se.Z.composeUnion({None:()=>Z.of(null),Some:Se.Z.composeKnot({value:Se.Z.composeKnot({root:()=>e.tButtonPosition,trackingButton:(t=e.state,n=e.actions,Se.Z.composeUnion({None:()=>Z.of(null),Some:Se.Z.composeKnot({value:Ln(t,n)})},(()=>t.pipe(ye.cp((({trackingState:e})=>"optedOut"===e?Z.of(g.YP):Z.of(g.G(e)))))))),popup:Sn(e.state,e.actions),toast:In(e.state,e.actions)})})},(()=>e.state))))));var e,t,n}dispose(){this._subs.unsubscribe()}}const Un=()=>m.E,Pn=()=>{const e=(0,R.CI)(document);return e?Ae.R(e,"keydown"):m.E};var Gn=n(24666),Bn=n(8794),Nn=n(94728);function On(){if((0,E.Lu)()){const e="navigation"in self&&"addEventListener"in self.navigation?self.navigation:null;if(e)return Ae.R(e,"navigate").pipe(c.U((e=>e.destination.url)),xe.O(self.location.href),c.U(Nn.j),Gn.x(),Bn.T(1),c.U(r.Q1));{const e=document.querySelector(se.j5);return e?Re.x.create(e,{attributes:!1,childList:!0,subtree:!0}).pipe(xe.O(self.location.href),c.U((()=>self.location.href)),c.U(Nn.j),Gn.x(),Bn.T(1),c.U(r.Q1)):m.E}}return m.E}class $n{constructor(e){this._deps=e,this._subscriptions=new o.w0,this._disposables=a.h.create([]),this._trackingFeature=a.h.create(g.YP),this._copyContentListener=a.h.create(g.YP),this._ui=a.h.create(g.YP),this._checkPermissions=new s.x,this._logger=L.Y.create("EditsTrackingControllerImpl"),this.isReportAvailable=a.h.create(!1),this._felog=(0,S.Cc)({variant:"decoupled tracking",documentId:e.documentId}),this._domain=e.CSState.view("page").view("domain").get(),this._subscriptions.add(this._handleCheckPermissions(this._checkPermissions).subscribe()),this._subscriptions.add(this._handleStateChanges(e.CSState).subscribe()),this._subscriptions.add(this._handleUIActions(this._deps.uiActions).subscribe()),this._subscriptions.add(this._handleFeatureEvents(this._deps.events).subscribe()),this._subscriptions.add(this._logStartedTracking(this._deps.uiActions,this._deps.events).subscribe()),this._subscriptions.add(this._handleErrors(this._deps.errors).subscribe()),this._subscriptions.add(this._handleSinglePageDocumentChange(e.singlePageDocumentChange||On())),this._subscriptions.add(this._deps.CSState.view("page").view((({enabled:e,humanWritingReport:t})=>({enabled:e,humanWritingReport:t}))).pipe().subscribe((({enabled:e,humanWritingReport:t})=>{const n=this._deps.documentId,r=this._domain;this.isReportAvailable.set(e&&"enabled"===(null==t?void 0:t.kind)&&((0,w.MP)(n,r,t)||(0,w.Ng)(n,r,t)))}))),this._subscriptions.add(f.m.messages.subscribe({next:e=>{if(x(e)){const t=this._getMessageContent(e),n=this._getChatName(e),r=this._getDebugMessages(e);this._deps.events.next({kind:"chatResponseReceived",content:t,prompt:n,responseId:e.correlationId||"",debugMessages:r})}}}))}_handleStateChanges(e){return e.view("page").view((({enabled:e,humanWritingReport:t})=>({enabled:e,humanWritingReport:t}))).pipe(c.U((({enabled:e,humanWritingReport:t})=>{if(e){if(t)switch(t.kind){case"available":case"optedOut":this._checkInitUI("optedOut"===t.kind),this._disposeTrackingFeature(),this._disposeCopyContentListener();break;case"enabled":this._checkInitUI(),this._checkInitListener(),this._checkInitCopyContentListener(),(0,w.Ng)(this._deps.documentId,this._domain,t)?(this._checkPermissions.next(void 0),this._startTracking()):this._stopTracking();break;case"disabled":case"initial":this._disposeTrackingFeature(),this._disposeUI(),this._disposeCopyContentListener();break;default:(0,i.L0)(t)}}else this._disposeUI(),this._disposeTrackingFeature(),this._disposeCopyContentListener()})))}_handleUIActions(e){return e.pipe(c.U((e=>{switch(e.kind){case"trackingButtonClick":this._deps.gnar.hwrButtonClick(this._deps.documentId);break;case"closeOptInPopup":this._deps.csToBgActions.hwrSetEnabled(!0);break;case"start":case"resume":this._deps.csToBgActions.hwrStartTracking({documentId:this._deps.documentId,domain:this._domain});break;case"enableForDomain":this._deps.gnar.hwrTrackingEnableForDomain(this._deps.documentId,this._domain),this._deps.csToBgActions.hwrStartTrackingDomain({documentId:this._deps.documentId,domain:this._domain});break;case"resetForDomain":this._deps.csToBgActions.hwrStopTrackingDomain({documentId:this._deps.documentId,domain:this._domain});break;case"pause":this._deps.gnar.hwrTrackingPause(this._deps.documentId),this._deps.csToBgActions.hwrStopTracking({documentId:this._deps.documentId,domain:this._domain});break;case"optOut":this._deps.gnar.hwrFeatureOptOut(this._deps.documentId),this._deps.csToBgActions.hwrOptOut();break;case"optIn":this._deps.gnar.hwrFeatureOptIn(this._deps.documentId),this._deps.csToBgActions.hwrOptIn();break;case"viewReport":this._deps.gnar.hwrReportButtonClick(this._deps.documentId),this._viewReport()}})))}_handleErrors(e){return e.pipe(l.b((e=>{switch(e.kind){case"serverError":case"unrecoverableError":this._deps.csToBgActions.hwrStopTracking({documentId:this._deps.documentId,domain:this._domain})}})))}_handleSinglePageDocumentChange(e){return e.subscribe((()=>{this._disposeUI(),this._disposeTrackingFeature()}))}_logStartedTracking(e,t){return e.pipe(d.h((({kind:e})=>"start"===e||"resume"===e)),c.U((({kind:e})=>"resume"===e)),u.w((e=>t.pipe(d.h((({kind:e})=>"knownStateMismatch"===e||"knownStateMatch"===e)),c.U((t=>({event:t,isResume:e})))))),h.q(1),l.b((({event:e,isResume:t})=>{"knownStateMismatch"===e.kind?this._deps.gnar.hwrTrackingStart(this._deps.documentId,t,e.lengthDifference):this._deps.gnar.hwrTrackingStart(this._deps.documentId,t,0)})))}_handleFeatureEvents(e){return e.pipe(l.b((e=>{var t;switch(e.kind){case"sourcedTextAdded":this._deps.gnar.hwrKnownSourcePaste(this._deps.documentId,e.sourceDomain,e.textLength,e.promptDetected);break;case"unknownSourceTextAdded":this._deps.gnar.hwrUnknownSourcePaste(this._deps.documentId,e.textLength),e.textLength>=25&&this._felog.info("Large text change with unknown source detected",void 0,{changeLength:e.textLength});break;case"sourceAdded":this._deps.gnar.hwrKnownSourceDetect(e.sourceDomain,e.textLength,!1);break;case"chatResponseReceived":if(null===(t=e.debugMessages)||void 0===t?void 0:t.length)for(const t of e.debugMessages)this._logger.debug(t)}})))}_checkInitUI(e=!1){this._ui.modify((t=>(0,r.zG)(t,g.wp((()=>{const t=new Fn(this._deps.CSState,this._deps.uiActions,this._deps.errors,this._deps.events,this._deps.documentId,this._deps.gnar,this._getTButtonPositionSource(),this._deps.requestPlagiarismCheck),n=T.V.get({monitorAs:"human-writing-report"}).inject(D.EM.fromDocument(self.document,"grammarly-human-writing-report"),D.zs.appendChild(self.document.documentElement),A.G7.showWhenLoaded(t.view()));return!e&&this._deps.gnar.hwrButtonShow(this._deps.documentId),g.G({viewModel:t,dispose:()=>{n.dispose(),t.dispose()}})})))))}_getTButtonPositionSource(){return(0,E.Lu)()?Fe:Le}_getKeyboardEventsSource(){return(0,E.Lu)()?Pn:Un}_startTracking(){(0,r.zG)(this._trackingFeature.get(),g.UI((e=>{e.startTracking()})))}_stopTracking(){(0,r.zG)(this._trackingFeature.get(),g.UI((e=>{e.stopTracking()})))}_checkInitListener(){this._trackingFeature.modify((e=>(0,r.zG)(e,g.wp((()=>g.G(new be({documentId:this._deps.documentId,sessionId:this._deps.sessionId,textObserver:this._deps.textObserver,selectionChanges:this._deps.selectionSource.data.changes,editsTrackingEvents:this._deps.events,editsTrackingErrors:this._deps.errors,keyboardEvents:this._getKeyboardEventsSource()(),replacementAppliedEvents:this._deps.replacementListener.obs,userId:this._deps.CSState.view("user","id").get(),copiedTextMessage:this._deps.CSState.view("copiedTextMessage"),advancedLoggingEnabled:this._deps.CSState.view("page","advancedHistoryLoggerEnabled"),alertsState:this._deps.alertsState,alertStateChanges:this._deps.alertsStateChanges,env:(0,I.OB)(),storageClient:this._deps.storageClient})))))))}_handleCheckPermissions(e){return e.pipe(u.w((()=>(0,I.OB)().bgRpc.api.isPermissionGranted(_.d.clipboardRead))),d.h((e=>!e)),c.U((()=>{const e=this._deps.CSState.view("page","humanWritingReport").get();return"enabled"===(null==e?void 0:e.kind)&&void 0===(null==e?void 0:e.deniedClipboardAccessSince)})),d.h(Boolean),l.b((()=>{this._deps.events.next({kind:"clipboardAccessRequested"})})),u.w((()=>this._deps.uiActions.pipe(d.h((e=>"clipboardRequestResult"===e.kind&&"allow"===e.result||"clipboardWarningResult"===e.kind)),c.U((e=>"allow"===e.result)),h.q(1)))),u.w((e=>e?(this._deps.gnar.hwrClipboardPermissionRequest(this._deps.documentId),(0,I.OB)().bgRpc.api.requestGrantPermission(_.d.clipboardRead)):(this._deps.gnar.hwrClipboardPermissionDeny(this._deps.documentId),this._deps.csToBgActions.hwrDenyClipboardAccess(),m.E))),p.K((()=>(this._deps.errors.next({kind:"clipboardPermissionRequestFailed"}),m.E))),l.b((e=>{e?(this._deps.gnar.hwrClipboardPermissionAllow(this._deps.documentId),this._deps.csToBgActions.hwrAllowClipboardAccess()):(this._deps.gnar.hwrClipboardPermissionDeny(this._deps.documentId),this._deps.csToBgActions.hwrDenyClipboardAccess())})))}_checkInitCopyContentListener(){(0,E.Lu)()&&this._copyContentListener.modify((e=>(0,r.zG)(e,g.wp((()=>g.G(new F.CopyContentListener((0,I.OB)(),this._deps.CSState.view("page","humanWritingReport"),this._deps.gnar,this._domain,this._deps.dynamicConfig,(0,R.CI)(document)||void 0,self,(0,R.CI)(document)||void 0,!0)))))))}_viewReport(){(0,r.zG)(this._trackingFeature.get(),g.UI((async e=>{try{const t=await e.getReportableDocument();try{const e=await this._deps.backendClient.generateReport(t);self.open(e,"_blank")}catch(e){let t="Unknown error";"string"==typeof(null==e?void 0:e.message)?t=e.message:"string"==typeof e&&(t=e),this._felog.error("reportGenerationFailed",JSON.stringify(t)),this._deps.errors.next({kind:"reportGenerationFailed"})}}catch(e){let t="Can't get reportable document from tracking feature";"string"==typeof(null==e?void 0:e.message)?t=e.message:"string"==typeof e&&(t=e),this._felog.error("reportGenerationFailed",JSON.stringify(t)),this._deps.errors.next({kind:"reportGenerationFailed"})}})))}_disposeUI(){this._ui.modify((e=>(0,r.zG)(e,g.tS((e=>(e.dispose(),g.YP))))))}_disposeTrackingFeature(){this._trackingFeature.modify((e=>(0,r.zG)(e,g.tS((e=>(e.dispose(),g.YP))))))}_disposeCopyContentListener(){this._copyContentListener.modify((e=>(0,r.zG)(e,g.tS((e=>(e.dispose(),g.YP))))))}_getMessageContent(e){const t=e.extraProperties.responseText;if(!t)return"";try{return JSON.parse(t.json)}catch(e){return this._felog.error("storageError","Failed to parse chat name"),""}}_getDebugMessages(e){if(!(0,I.OB)().experimentClient.isGateEnabled(M.K.AgentRuntimeInternalDebug))return;if("Assistant/Brain/Chat"!==e.actionId.id)return;const t=e.extraProperties.debugMessages;if(t)try{const e=JSON.parse(t.json);return Array.isArray(e)?e.map((e=>JSON.stringify(e,null,2))):[]}catch(e){return void this._felog.error("storageError","Failed to parse debug content")}}_getChatName(e){const t=e.extraProperties.historyTitle;if(t)try{return JSON.parse(t.json)}catch(e){return void this._felog.error("storageError","Failed to parse chat name")}}dispose(){this._subscriptions.unsubscribe(),this._disposeUI(),this._disposeTrackingFeature(),this._disposeCopyContentListener()}}},91745:(e,t,n)=>{n.r(t),n.d(t,{CopyContentListener:()=>O});var r=n(13391),i=n(32073),a=n(36344),o=n(84308),s=n(44071),c=n(59179),l=n(954),d=n(20161),u=n(81933),h=n(90572),m=n(79256),p=n(64715),g=n(8065),f=n(17543),_=n(31789),k=n(84714),b=n(18827),v=n(66878),y=n(64271),C=n(29479),x=n(29416),w=n(63532),S=n(39565),E=n(18838),I=n(40594);const T=e=>({getAll:async()=>await e.getAll(),get:async t=>await e.get(t),patch:async t=>await e.set(t),changes:e.changes});var D;!function(e){e.make=function(e,t,n,r){return{valid:!0,copiedText:n,sourceURL:e,sourceName:t,userPrompt:r}}}(D||(D={}));var A=n(94728);class R{constructor(){this.location=self.location,this._title=document.title}get url(){return this.location.href}get title(){return this._title}isGoogleDocs(){return"docs.google.com"==this.location.hostname}get documentID(){return this.isGoogleDocs()?(0,A.j)(this.location.href):null}}var M=n(90624),L=n(74822),F=n(21243),U=n(45523);class P{getPromptForText(){return null}dispose(){}}class G{constructor(e,t){this._promptsSelector=e,this._responsesSelector=t,this._pairs=new Map,this._subs=new i.w0,this._prompts=new L.x,this._pairsOutdated=r.h.create(!0),this._subs.add(this._setupMutationObserver().subscribe((()=>{this._pairsOutdated.set(!0)})))}_searchForPairs(){const e=Array.from(document.querySelectorAll(this._promptsSelector));if(e){const t=Array.from(document.querySelectorAll(this._responsesSelector));t&&t.length===e.length&&e.forEach(((e,n)=>{var r,i;const a=(null===(r=e.textContent)||void 0===r?void 0:r.trim())||null;if(a){const e=(null===(i=t[n].textContent)||void 0===i?void 0:i.trim())||null;e&&this._pairs.set((0,F.Ue)(e),{prompt:a,response:e})}}))}this._pairsOutdated.set(!1)}_setupMutationObserver(){return U.x.create(document,{attributes:!1,subtree:!0,childList:!0}).pipe((0,c.U)((e=>e.filter((e=>e.addedNodes.length>0)).some((e=>Array.from(e.addedNodes).filter((e=>e instanceof HTMLElement)).some((e=>e.matches(this._responsesSelector)||e.querySelector(this._responsesSelector))))))),(0,h.h)(Boolean))}getPromptForText(e){var t;return this._pairsOutdated.get()&&this._searchForPairs(),(null===(t=this._pairs.get((0,F.Ue)(e)))||void 0===t?void 0:t.prompt)||null}dispose(){this._subs.unsubscribe()}}const B=[{name:"OpenAI",is:e=>"chat.openai.com"===e||"chatgpt.com"===e,matcher:()=>new G('div[data-message-author-role="user"]','div[data-message-author-role="assistant"]')},{name:"Google Gemini",is:e=>"gemini.google.com"===e,matcher:()=>new G("div.query-content","div.response-content")},{name:"Claude AI",is:(e,t)=>/claude.ai\/chat\//.test(t),matcher:()=>new G("div.font-user-message","div.font-claude-message")},{name:"Perplexity AI",is:e=>/^(www\.)?perplexity\.ai$/.test(e),matcher:()=>new G(".whitespace-pre-line.break-words","div.prose")}];function N(e){return e.length>25?`${e.slice(0,25)}...`:e}class O{constructor(e,t,n,m,p,g=self,f=self,_=self,k=!1){this._env=e,this._featureState=t,this._gnar=n,this._domain=m,this._dynamicConfig=p,this._keyboardEventsTarget=g,this._mouseEventsTarget=f,this._copyEventsTarget=_,this.ignoreDomainCheck=k,this._log=I.Y.create("CopyContentListener"),this._subs=new i.w0,this._clipboardText=r.h.create(""),this._genAIMatcher=function(){const{hostname:e,href:t}=self.location;for(const n of B)if(n.is(e,t))return n.matcher();return new P}(),null==e.browserApi?(this._trackingEnabled=a.E,this._log.warn("CopyContentListener cannot be initialized, browserApi is not available")):(this._store=(0,M.T)(T(e.browserApi.preferences)),this._trackingEnabled=o.a(s.R(document,"visibilitychange").pipe(c.U((()=>!document.hidden)),l.O(!document.hidden)),t,p).pipe(c.U((([e,t,n])=>e&&(0,E.YI)(m,t,n,k))),d.w((e=>e?this._env.bgRpc.api.isPermissionGranted(S.d.clipboardRead):Promise.resolve(!1))),u.shareReplay({bufferSize:1,refCount:!0})),this._subs.add(this._setupTrackingBecameEnabledHandler()),this._subs.add(this._clipboardText.pipe(h.h((e=>e.length>0))).subscribe((e=>this._onClipboardChange(e)))),this._log.info("CopyContentListener initialized",m))}_readClipboard(){return m.P((()=>navigator.clipboard.readText())).pipe(p.a((e=>e.pipe(g.b(((e,t)=>(0===t&&this._log.debug("Error getting text, will retry",e.message),f.s((()=>t>0),_._(e),k.of(e).pipe(b.g(50))))))))),v.K((e=>(this._log.debug("Error getting text, after one retry, give up for now",e.message),a.E))))}_setupTrackingBecameEnabledHandler(){return this._trackingEnabled.pipe(d.w((e=>e?this._userActionSequenceHandler():a.E))).subscribe()}_userActionSequenceHandler(){const e={capture:!0,once:!1,passive:!0};return y.T(s.R(this._mouseEventsTarget,"mousedown",e),s.R(this._keyboardEventsTarget,"keydown",e),s.R(this._copyEventsTarget,"copy",e),s.R(this._copyEventsTarget,"cut",e)).pipe(d.w((t=>f.s((()=>"copy"===t.type||"cut"===t.type),m.P((()=>u.timer(50).pipe(d.w((()=>this._readClipboard()))))),m.P((()=>this._readClipboard().pipe(d.w((n=>{switch(t.type){case"mousedown":return s.R(this._mouseEventsTarget,"mouseup",e).pipe(C.h(n));case"keydown":return s.R(this._keyboardEventsTarget,"keyup",e).pipe(C.h(n));default:return a.E}}))))).pipe(x.b(150),d.w((e=>this._readClipboard().pipe(c.U((t=>[e,t]))))),h.h((([e,t])=>e!==t)),c.U((([e,t])=>t)))))),w.b((e=>{this._log.debug("Clipboard has changed after a user action. Saving:",N(e)),this._clipboardText.set(e)})))}_onClipboardChange(e){const t=this._genAIMatcher.getPromptForText(e);t&&this._log.debug("Found genAI prompt for text:",t);this._store.get().then((n=>{const r=n.copiedTextMessage;if(null==r||!(null==r?void 0:r.valid)||(null==r?void 0:r.valid)&&r.copiedText!=e){const n=new R;this._log.debug("New clipboard text:",N(e)),this._gnar.hwrKnownSourceDetect(self.location.origin,e.length,Boolean(t)),this._store.set(D.make(n.url,n.title,e,t||void 0))}}))}dispose(){this._subs.unsubscribe(),this._genAIMatcher.dispose()}}},18838:(e,t,n)=>{n.d(t,{C0:()=>l,E3:()=>s,MP:()=>o,Ng:()=>a,YI:()=>c,wg:()=>i});var r=n(42175);const i={kind:"initial",allDomainsTrackingEnabled:!1};function a(e,t,n){if("enabled"===n.kind){const r=n.domainSettings.find((({domain:e})=>e===t));return!!r&&(r.logAllDocuments?!r.pausedDocumentIds.includes(e):r.activeDocumentIds.includes(e))}return!1}function o(e,t,n){var r;if("enabled"===n.kind){const i=n.domainSettings.find((({domain:e})=>e===t));return!!i&&(!!i.logAllDocuments||((null===(r=i.pausedDocumentIds)||void 0===r?void 0:r.includes(e))||i.activeDocumentIds.includes(e)))}return!1}function s(e,t){var n,r;return"enabled"===t.kind&&Boolean(null===(r=null===(n=t.domainSettings)||void 0===n?void 0:n.find((({domain:t})=>t===e)))||void 0===r?void 0:r.logAllDocuments)}function c(e,t,n,i=!1){if("enabled"===(null==t?void 0:t.kind)&&void 0===t.deniedClipboardAccessSince){const a=void 0===t.allowedClipboardAccess?function(e){return"enabled"===(null==e?void 0:e.kind)&&e.domainSettings.some((e=>e.logAllDocuments?e.logAllDocuments:e.activeDocumentIds.length>0))}(t):t.allowedClipboardAccess,o=t.allDomainsTrackingEnabled?""!==e&&r.yg.concat((null==n?void 0:n.blockedDomains)||[]).every((t=>!new RegExp(t).test(e))):r.XW.some((t=>new RegExp(t).test(e)));return a&&(o||i)}return!1}function l(e){return!!e&&("initial"!==e.kind&&"disabled"!==e.kind||"disabled"===e.kind&&e.disabledByUser)}},33494:(e,t,n)=>{n.d(t,{T:()=>i});var r=n(40594);class i{constructor(e){this._deps=e,this._log=r.Y.create("TransitionalStorageClient")}async retrieve(e){const t=await this._deps.receptiveStorageClient.retrieve(e);return null===t?this._checkAndMigrateToReceptiveStorage(e):(this._log.info("Document state retrieved from receptive storage: success"),t)}async store(e){try{return await this._deps.receptiveStorageClient.store(e)}catch(e){return Promise.reject(e)}}async delete(e){try{return await this._deps.providingStorageClient.delete(e),await this._deps.receptiveStorageClient.delete(e)}catch(e){return this._deps.felog.error("storageError",`Couldn't delete document: ${e.message||"Unknown error"}`),Promise.reject(e)}}async _checkAndMigrateToReceptiveStorage(e){const t=await this._deps.providingStorageClient.retrieve(e);if(null!==t)try{await this.store(t),await this._deps.providingStorageClient.delete(e),this._log.info("Document state migrated successfully to new storage"),this._deps.felog.info("Document state migrated successfully to new storage")}catch(e){return this._deps.felog.error("storageError","Could not migrate document state to new storage",void 0,{historyLength:t.deltaEdits.length,error:e.message||"Unknown error"}),Promise.reject(e)}return t}}},77831:(e,t,n)=>{n.r(t),n.d(t,{createStorageClient:()=>P});var r=n(59171),i=n(21243),a=n(73642),o=n(74822),s=n(26156),c=n(20161),l=n(84714),d=n(31789),u=n(90572),h=n(18519),m=n(59179),p=n(40594),g=n(13391);const f="document_state",_="document_state_enc";var k=n(78326),b=n(59835);const v="AES-GCM",y={name:v},C={length:256,...y};function x(e){return{iv:e,...y}}function w(){if(!self.crypto)throw new k._P("Crypto API is not supported in this browser")}async function S(e){w();const t=await self.crypto.subtle.exportKey("raw",e);return new Uint8Array(t)}class E{static ofRequest(e){return new Promise(((t,n)=>{e.onsuccess=n=>t(e.result),e.onerror=t=>n(e.error)}))}static ofTransaction(e){return new Promise(((t,n)=>{e.oncomplete=e=>t(),e.onerror=t=>n(e.error)}))}}function I(e){return t=>`${e}-${t}`}class T{serialize(e){return Promise.resolve(b.bG.create(e))}deserialize(e){const t=b.bG.parse(e);return t?Promise.resolve(t):Promise.reject(new k.EK("Document could not be parsed"))}}class D{constructor(e,t){this.keychain=t,this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder,this.uniqId=I(e),this.userId=e}async serialize(e){try{const t=await this.keychain.getOrProvisionKey(e.documentId,this.userId),n=JSON.stringify(b.vn.create(e)),r=this.textEncoder.encode(n),i=await async function(e,t){w();const n=self.crypto.getRandomValues(new Uint8Array(12));return{iv:n,encrypted:await self.crypto.subtle.encrypt(x(n),t,e)}}(r,t);return{id:this.uniqId(e.documentId),documentId:e.documentId,data:i}}catch(e){throw(0,k.Jn)(e,k._P)}}async deserialize(e){const{documentId:t,data:n}=e,r=await this.keychain.getKey(t,this.userId);if(!r)throw new k.EK("Key not found for document");try{const e=await function(e,t){w();const{iv:n,encrypted:r}=e;return self.crypto.subtle.decrypt(x(n),t,r)}(n,r);return b.vn.parse(JSON.parse(this.textDecoder.decode(e)))}catch(e){throw(0,k.Jn)(e,k.EK)}}}class A{constructor(e,t,n,r,i,a){this.userId=e,this.documentId=t,this.keychain=n,this._onReadCallback=r,this._onReadErrorCallback=i,this._onWriteResultCallback=a,this._initialized=g.h.create(!1),this._encryptionSerializer=new D(this.userId,this.keychain),this._legacySerializer=new T,this._log=p.Y.create("HWRStorage"),this._uniqId=I(e)}async reload(){if(this._log.info("reload"),this._db=await this._openDb(),!this._db)return this._log.error("Cannot open db"),void this._onReadErrorCallback(new k.DU);try{const e=await this._fetchFromEncrypted(this._db);if(e)return void this._onReadCallback(e);const t=await this._fetchFromLegacy(this._db);t?(await this._migrateToEncrypted(this._db,t),this._onReadCallback(t)):this._onReadErrorCallback(new k.Z3)}catch(e){this._onReadErrorCallback((0,k.Jn)(e))}finally{this._initialized.set(!0)}}async deleteDocumentState(){if(this._db)try{const e=this._db.transaction([_],"readwrite");e.objectStore(_).delete(this._uniqId(this.documentId)),await E.ofTransaction(e),this._onWriteResultCallback("success")}catch(e){this._onWriteResultCallback("error",(0,k.Jn)(e))}else this._onWriteResultCallback("error",new k.DU)}async writeDocumentState(e){if(await this._isInitialized(),this._db)try{const t=await this._encryptionSerializer.serialize(e),n=this._db.transaction([_],"readwrite");n.objectStore(_).put(t),await E.ofTransaction(n),this._onWriteResultCallback("success")}catch(e){this._onWriteResultCallback("error",(0,k.Jn)(e))}else this._onWriteResultCallback("error",new k.DU)}async _fetchFromEncrypted(e){const t=this._uniqId(this.documentId),n=e.transaction([_],"readonly"),r=n.objectStore(_),i=await E.ofRequest(r.get(t));return await E.ofTransaction(n),i?await this._encryptionSerializer.deserialize(i):null}async _fetchFromLegacy(e){if(!e.objectStoreNames.contains(f))return null;const t=this.documentId,n=e.transaction([f],"readonly"),r=n.objectStore(f),i=await E.ofRequest(r.get(t));return await E.ofTransaction(n),i?await this._legacySerializer.deserialize(i):null}async _migrateToEncrypted(e,t){this._log.info("Migrating document to encrypted storage");try{const n=t.documentId,r=await this._encryptionSerializer.serialize(t),i=e.transaction([_,f],"readwrite");i.objectStore(_).put(r),i.objectStore(f).delete(n),await E.ofTransaction(i)}catch(e){throw(0,k.Jn)(e,k.e0)}}_isInitialized(){return(0,a.z)(this._initialized.pipe(u.h((e=>e))))}async _openDb(){const e=indexedDB.open("human_writing_report",2);e.onupgradeneeded=this._onUpgradeNeeded.bind(this);try{return await E.ofRequest(e)}catch(e){return null}}_onUpgradeNeeded(e){const t=e.target,n=t.result;if(t.result&&t.transaction)try{n.objectStoreNames.contains(_)||n.createObjectStore(_,{keyPath:"id",autoIncrement:!1})}catch(e){this._onReadErrorCallback((0,k.Jn)(e))}else this._onReadErrorCallback(new k.DU)}}class R{constructor(e){this._deps=e,this._log=p.Y.create("LegacyStorageClient"),this._retrievalEvents=new o.x,this._writeStatusSuccessEvents=new o.x,this._errors=new o.x,this._hwrStorage=new A(e.userId,e.documentId,e.keychain,(e=>{this._log.info("Document state retrieved from document-side storage"),this._retrievalEvents.next(e)}),(e=>{this._log.error("Document-side storageStorage read error:",e),this._errors.next(e)}),((e,t)=>{t?(this._log.error("Document-side storageStorage write error:",t),this._errors.next(t)):(this._log.info("Document-side storageStorage write status update: ",e),this._writeStatusSuccessEvents.next())}))}async retrieve(e){if(e!==this._deps.documentId)return Promise.reject(new Error("Wrong document id"));const t=(0,a.z)(s.S([this._retrievalEvents,this._errors.pipe(c.w((e=>e instanceof k.Z3?l.of(null):d._((()=>e)))))]));return await this._hwrStorage.reload(),t}store(e){return e.documentId!==this._deps.documentId?Promise.reject(new Error("Wrong document id")):(0,a.z)(s.S([this._hwrStorage.writeDocumentState(e),this._errors.pipe(u.h((e=>!(e instanceof k.Z3))),c.w((e=>d._((()=>e))))),this._writeStatusSuccessEvents]).pipe(h.V({each:5e3,with:()=>d._((()=>new Error("Storage timeout")))})))}async delete(e){if(e!==this._deps.documentId)return Promise.reject(new Error("Wrong document id"));try{const e=(0,a.z)(s.S([this._writeStatusSuccessEvents,this._errors.pipe(c.w((e=>e instanceof k.Z3?l.of(null):d._((()=>e)))))]).pipe(m.U((()=>{}))));return await this._hwrStorage.deleteDocumentState(),await e}catch(e){return this._deps.felog.error("storageError",`Couldn't delete document: ${e.message||"Unknown error"}`),Promise.reject(e)}}}var M=n(33494),L=n(97521),F=n(61106);class U{constructor(e){this._client=e}async getKey(e,t){const n=U.createKeyId(e),r=await this.fetchKey(n,t);if(!r)return null;const i=(0,L.K9)(r);return await function(e,t=!1,n=["encrypt","decrypt"]){return w(),self.crypto.subtle.importKey("raw",e,v,t,n)}(i)}async getOrProvisionKey(e,t){let n=0;for(;n<=3;)try{return await this.getKey(e,t)||await this.provisionKey(e,t)}catch(e){if(e instanceof k.s1){if(n++<=2)continue;if(e.reason)throw(0,k.Jn)(e.reason,k._P);throw new k._P("Too many retries")}throw(0,k.Jn)(e)}throw new k._P("Too many retries")}async provisionKey(e,t){const n=U.createKeyId(e),r=await(w(),self.crypto.subtle.generateKey(C,!0,["encrypt","decrypt"]));return await this.storeKeys([{keyId:n,key:r}],t),r}static createKeyId(e){return(0,F.MD)("key-"+e)}async fetchKey(e,t){const n=await this._client.getEncryptionKey({keyId:e,userId:t});return null==n?void 0:n.keyMaterial}async storeKeys(e,t){const n=[];for(const t of e){const e=await S(t.key);n.push({id:t.keyId,keyMaterial:(0,L.J2)(e)})}await this._client.createEncryptionKeys({keys:n,userId:t})}}function P({storageAPI:e,documentId:t,experimentClient:n,encryptionKeysAPI:a,userId:o}){const s=new U(a),c=(0,i.Cc)({documentId:t,storageType:"document"});return r.C.useTransitionalStorageClient(n)?new M.T({receptiveStorageClient:e,providingStorageClient:new R({documentId:t,keychain:s,userId:o,felog:c}),felog:(0,i.Cc)({documentId:t,storageType:"extension"})}):new R({documentId:t,keychain:s,userId:o,felog:c})}},78326:(e,t,n)=>{n.d(t,{DU:()=>l,EK:()=>a,Jn:()=>u,Z3:()=>i,_P:()=>s,e0:()=>d,nl:()=>o,s1:()=>c});class r extends Error{constructor(e,t){super(e),this._reason=t}get reason(){return this._reason}}class i extends r{}class a extends r{}class o extends r{}class s extends r{}class c extends r{}class l extends s{}class d extends s{}function u(e,t=s){return e instanceof r?e:new t(e.message,e)}},59835:(e,t,n)=>{n.d(t,{bG:()=>o,q7:()=>m,vn:()=>a,z_:()=>h});var r,i,a,o,s,c,l,d=n(49955),u=n(5388);function h(e){return e===u.P.oggyRevision||e===u.P.oggyRevisionSequential||e===u.P.oggyRevisionDelayed||e===u.P.touchTypist}function m(e){return void 0!==e.replacement.pos&&(e.source===u.P.snippets||e.source===u.P.oggyGenAI||e.source===u.P.g2||h(e.source))}!function(e){e.create=function(e){return{char:e.character,timestamp:e.timestamp,isSelfAuthored:e.isSelfAuthored,sourceContentId:e.sourceContentId}},e.parse=function(e){return{character:e.char,timestamp:e.timestamp,isSelfAuthored:e.isSelfAuthored,sourceContentId:e.sourceContentId}}}(r||(r={})),function(e){e.create=function(e){return{...e}}}(i||(i={})),function(e){e.create=function(e){return{id:e.documentId,chars:e.chars.map(r.create),sourcedContentStore:e.sourcedContentStore,deltaEdits:e.deltaEdits,title:e.title}},e.parse=function(e){return{documentId:e.id,chars:e.chars.map(r.parse),sourcedContentStore:e.sourcedContentStore,deltaEdits:e.deltaEdits,title:e.title}}}(a||(a={})),function(e){e.create=function(e){return{id:e.documentId,chararray:e.chars.map(c.create),copyStore:{storeType:e.sourcedContentStore.kind,data:e.sourcedContentStore.data.map(l.create)},deltas:e.deltaEdits.map(s.create)}},e.parse=function(e){try{const t=e;if(t.id&&Array.isArray(t.chararray)&&t.copyStore&&t.copyStore.storeType&&Array.isArray(t.copyStore.data)&&Array.isArray(t.deltas)){const e=t.chararray.map(c.parse).filter(d.CH.is),n=t.copyStore.data.map(l.parse).filter((e=>null!==e)),r=t.deltas.map(s.parse).filter(d.mm.is);return e.length!==t.chararray.length||n.length!==t.copyStore.data.length||r.length!==t.deltas.length?null:{documentId:t.id,chars:e,sourcedContentStore:{kind:t.copyStore.storeType,data:n},deltaEdits:r}}return null}catch(e){return null}}}(o||(o={})),function(e){e.create=function(e){return{timestamp:e.timestamp,delta:e.delta,copyContentId:e.sourceContentId,isSelfAuthored:e.isSelfAuthored}},e.parse=function(e){try{const t=e;return t.timestamp&&!isNaN(t.timestamp)&&t.delta?{timestamp:Number(t.timestamp),delta:t.delta,sourceContentId:t.copyContentId?String(t.copyContentId):void 0,isSelfAuthored:t.isSelfAuthored}:null}catch(e){return null}}}(s||(s={})),function(e){e.create=function(e){return{timestamp:e.timestamp,text:e.character,copiedContentId:void 0!==e.sourceContentId&&null!==e.sourceContentId&&""!==e.sourceContentId?e.sourceContentId:void 0,isSelfAuthored:e.isSelfAuthored}},e.parse=function(e){try{const t=e;return void 0!==t.text&&t.text.length&&t.timestamp&&void 0!==t.isSelfAuthored?{character:String(t.text),timestamp:Number(t.timestamp),sourceContentId:t.copiedContentId?String(t.copiedContentId):void 0,isSelfAuthored:Boolean(t.isSelfAuthored)}:null}catch(e){return null}}}(c||(c={})),function(e){e.create=function(e){return{id:e.id,url:e.url,sourceName:e.sourceName,text:e.text,timestamps:e.timestamps,isSelfAuthoredTags:e.isSelfAuthoredTags,originalCopiedContentIds:e.originalSourceContentIds,prompt:e.prompt||null}},e.parse=function(e){try{const t=e;if(t.id&&t.url&&t.sourceName&&t.text&&Array.isArray(t.timestamps)&&Array.isArray(t.isSelfAuthoredTags)&&Array.isArray(t.originalCopiedContentIds)){const e=t.timestamps.filter((e=>!isNaN(e))),n=t.isSelfAuthoredTags.map(Boolean),r=t.originalCopiedContentIds.filter((e=>null===e||"string"==typeof e));return e.length===n.length&&n.length===r.length?{id:t.id,url:t.url,sourceName:t.sourceName,text:t.text,timestamps:e,isSelfAuthoredTags:n,originalSourceContentIds:r,prompt:t.prompt||void 0}:null}return null}catch(e){return null}}}(l||(l={}))},21243:(e,t,n)=>{n.d(t,{$2:()=>b,Cc:()=>C,Hq:()=>u,QY:()=>l,Ue:()=>c,Xw:()=>h,aS:()=>s,fo:()=>_,k4:()=>f,mS:()=>v,tg:()=>k});var r=n(14527),i=n(95869),a=n(39963);const o=n(72138);function s(e,t){if(e.length<=t)return e;if(t<=3)return"...";const n=Math.ceil((t-3)/2),r=Math.floor((t-3)/2);return`${e.substring(0,n)}...${e.substring(e.length-r,e.length)}`}function c(e){return e.replace(/[.,/#!$%^&*;:{}=\-_`~()\s]/g,"").toLowerCase()}var l,d,u;function h(e){var t;return(null===(t=/^(hwr:\/\/.+$|https?:\/\/[^/]+)/.exec(e))||void 0===t?void 0:t[1])||"Undetermined"}!function(e){e.getNumInsertedLetters=function(e){return e.ops.reduce(((e,t)=>i.s.isInsertString(t)?e+i.s.getInsertLength(t):e),0)},e.getNumDeletedLetters=function(e){const t=e.ops.filter((e=>i.s.isDelete(e)));let n=0;return t.forEach((e=>{i.s.isDelete(e)&&(n+=e.delete)})),n},e.getSummary=function(e,t){return t.ops.reduce(((t,n)=>{let{retained:r,retainedPrefix:a,deleted:o,inserted:s,maximalReplacement:c}=t.summary,l=t.pointer;return i.s.isRetain(n)&&(r=`${r}${e.substring(l,l+n.retain)}`,a=0===o.length&&0===s.length?`${a}${e.substring(l,l+n.retain)}`:a,c=c.length?`${c}${e.substring(t.pointer,t.pointer+n.retain)}`:c,l+=n.retain),i.s.isDelete(n)&&(o=`${o}${e.substring(l,l+n.delete)}`,l+=n.delete),i.s.isInsertString(n)&&(s=`${s}${n.insert}`,c=`${c}${n.insert}`),{pointer:l,summary:{retained:r,retainedPrefix:a,deleted:o,inserted:s,maximalReplacement:c}}}),{pointer:0,summary:{retained:"",retainedPrefix:"",deleted:"",inserted:"",maximalReplacement:""}}).summary},e.extractMaximalReplacementString=function(e,t){return t.ops.reduce(((t,n)=>(i.s.isInsertString(n)?t.text=`${t.text}${n.insert}`:i.s.isDelete(n)?t.originalTextPointer+=n.delete:i.s.isRetain(n)&&(t.text.length&&(t.text=`${t.text}${e.substring(t.originalTextPointer,t.originalTextPointer+n.retain)}`),t.originalTextPointer+=n.retain),t)),{text:"",originalTextPointer:0}).text||null},e.singleDelta=function(e,t){if(e===t)return new r.i([]);let n=0;const i=Math.min(e.length,t.length);for(;n<i&&e[n]===t[n];)n++;let a=0;for(;n+a<i&&t[t.length-a-1]===e[e.length-a-1];)a++;const o=e.length-(n+a),s=t.length-(n+a),c=[...n>0?[{retain:n}]:[],...o>0?[{delete:o}]:[],...s>0?[{insert:t.substring(n,n+s)}]:[]];return new r.i(c)},e.isNoTextChangesDelta=function(e){return e.ops.every((e=>i.s.isInsertString(e)?!e.insert.length:!i.s.isDelete(e)||!e.delete))}}(l||(l={})),function(e){e.isTextEqual=function(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;++n)if(e[n].character!=t[n].character)return!1;return!0},e.isContentEqual=function(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;++n)if(e[n].character!=t[n].character||e[n].sourceContentId!=t[n].sourceContentId||e[n].isSelfAuthored!=t[n].isSelfAuthored)return!1;return!0}}(d||(d={})),function(e){e.hasPerLetterTags=function(e){return e.isSelfAuthoredTags.length==e.text.length},e.toLoggableString=function(e){const t=s(e.text,40);return`CopiedContent [text length=${e.text.length}, has per letter tags=$hasPerLetterTags({sourcedContent)}, text=${t}]`},e.eq=function(e,t){if(e.length!==t.length)return!1;const n=e.slice().sort(((e,t)=>e.text.localeCompare(t.text)||e.sourceName.localeCompare(t.sourceName))),r=t.slice().sort(((e,t)=>e.text.localeCompare(t.text)||e.sourceName.localeCompare(t.sourceName)));return n.every(((e,t)=>e.text===r[t].text&&e.sourceName===r[t].sourceName))}}(u||(u={}));const m=new Set(["'","‘","’","＇","ߴ","ߵ"]),p=new Set(['"',"«","»","","“","”","„","‟","‹","›","❮","❯","❝","❞","❛","❜","〝","〞","⹂"]),g={a:new Set(["æ"]),s:new Set(["ß"]),"\n":new Set(["\v","\r","\v","\f"])};function f(e,t,n){var r,i,a,o;const s=l.getSummary(e,t);return".."===s.deleted&&"…"===s.inserted&&"."===(null===(r=n[0])||void 0===r?void 0:r.key)||"…"===s.deleted&&"..."===s.inserted&&""===(null===(i=n[0])||void 0===i?void 0:i.key)||"-"===s.deleted&&"–"===s.inserted&&"-"===(null===(a=n[0])||void 0===a?void 0:a.key)||"–"===s.deleted&&"--"===s.inserted&&""===(null===(o=n[0])||void 0===o?void 0:o.key)?1:0}function _(e,t){return!!e.length&&e.split("").every(((e,n)=>{var r;return void 0!==(null===(r=t[n])||void 0===r?void 0:r.key)&&function(e,t){var n;return 1===e.length&&1===t.length&&(e===t||0===e.localeCompare(t,void 0,{sensitivity:"case"})||Boolean(null===(n=g[e])||void 0===n?void 0:n.has(t))||"'"===e&&m.has(t)||'"'===e&&p.has(t))}(t[n].key,e)}))}function k(e){return e.map((e=>({...e,key:/\p{Letter}/u.test(e.key)?"#":e.key})))}function b(e){try{return e.replace(/<[^>]*>/g,"").replace(/^(\s*)([*\-+]|\d+\.)\s+/gm,"").replace(/!\[(.*?)\][[(].*?[\])]/g,"$1").replace(/\[([^\]]*?)\][[(].*?[\])]/g,"$1").replace(/^(\n)?\s*#{1,6}\s*( (.+))? +#+$|^(\n)?\s*#{1,6}\s*( (.+))?$/gm,"$1$3$4$6").replace(/^[=-]{2,}\s*$/gm,"").replace(/^\s*[*\- ]+\s*$/gm,"").replace(/^(\s{0,3}>\s?)+/gm,"").replace(/([*_]+)(\S)(.*?\S)??\1/g,"$2$3").replace(/([*_]+)(\S)(.*?\S)??\1/g,"$2$3").replace(/(`{3,})[\s\S]+?\1\s*/g,"").replace(/`(.+?)`/g,"$1").replace(/~(.*?)~/g,"$1")}catch(t){return e}}function v(e,t){return o(e.replace(/\s|\p{C}/gu,""),t.replace(/\s|\p{C}/gu,""))}function y(e={},t){let n={...e};return t&&(n="object"==typeof t?{...n,...t}:{...n,data:t}),n}function C(e={}){const t=(0,a.Tb)().humanWritingReport;return{error:(n,r,i,a)=>{t.error(n,r,i,y(e,a))},warning:(n,r,i,a)=>{t.warning(n,r,i,y(e,a))},info:(n,r,i)=>{t.info(n,r,y(e,i))}}}},7833:(e,t,n)=>{n.d(t,{$x:()=>o,F8:()=>k,Go:()=>i,Kt:()=>w,Lq:()=>h,Q:()=>F,Q6:()=>c,QO:()=>R,QR:()=>A,Qy:()=>v,Vk:()=>S,Wp:()=>r,XG:()=>a,_m:()=>g,d0:()=>m,f:()=>d,gH:()=>b,gL:()=>E,gv:()=>l,ij:()=>D,j5:()=>x,jW:()=>_,l$:()=>f,lO:()=>T,os:()=>C,q6:()=>u,qz:()=>M,rx:()=>I,tN:()=>U,uj:()=>p,y1:()=>s,yv:()=>L,yw:()=>y});const r=".kix-appview-editor",i=".docos-input",a=".docs-texteventtarget-iframe",o=".kix-cursor",s=".kix-cursor-caret",c="#docs-butterbar-container",l="docs-butterbar-container-compact",d="#docs-revisions-sidebar",u="#docs-wiz-sidebar-placeholder",h='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',m="#docs-toolbar-mode-switcher",p="edit-mode",g="suggest-mode",f="titlebar-mode-indicator-container",_="#titlebar-mode-indicator-container .titlebar-request-access-button",k="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",b="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",v=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",y=".kix-page-paginated",C=".kix-page-paginated.canvas-first-page",x=".docs-horizontal-ruler",w=".docs-vertical-ruler",S="#fontSizeSelect input",E=".docs-ruler-background",I=".docs-ruler-background-inner",T=".docs-ruler-indent-first-line",D=".modal-dialog.docs-dialog .fatal-error-message",A='#docs-titlebar-share-client-button div[role="button"]',R=".kix-ai-text-generator-preview-view-insert-button",M=".kix-ai-text-generator-preview-view",L=".kix-ai-text-generator-prompt-view",F=".kix-ai-text-generator-prompt-view-input",U=".kix-ai-text-generator-preview-view-generated-text"},94728:(e,t,n)=>{n.d(t,{j:()=>i});var r=n(79407);function i(e){const t=function(e){const t=e.match(/document\/d\/([\w-]+)\//),n=e.match(/[?&]tab=(.*?)(?:[&#]|$)/);return t?{docId:t[1],tabKey:null==n?void 0:n[1]}:null}(e);if(!t)return null;const n=t.tabKey&&"t.0"!==t.tabKey?`${t.docId}-${t.tabKey}`:t.docId;return r.createHash("superfasthash").hash(n)}},2087:(e,t,n)=>{n.d(t,{J:()=>d});var r=n(90023),i=n(92379),a=n(2852),o=n(85837),s=n(99887),c=n(63532),l=n(55987);const d=({onChange:e,labelId:t,className:n,checkboxClassName:d,labelClassName:u,checked:h,children:m,disabled:p,useDS:g,dataGrammarlyPart:f="ui-kit-checkbox",tabIndex:_=0,onMount:k=r.Q1})=>{const[b,v]=i.useState(null!=h&&h);i.useEffect((()=>{v(Boolean(h))}),[h]);const y=t=>{t.preventDefault(),t.stopPropagation(),v(!b),null==e||e(!b)},{ref:C,onMount:x}=a.P.useElWatcher();return i.useEffect((()=>{const e=C.pipe(s.oA,c.b(k)).subscribe();return()=>e.unsubscribe()}),[]),i.createElement("div",{"data-grammarly-part":f,...(0,o.Sh)(l.checkboxContainer,n)},i.createElement("div",{...(0,o.Sh)(l.checkbox,d,b?l.checkboxChecked:null,g?l.checkboxDS:null),role:"checkbox","aria-checked":b,tabIndex:_,"aria-labelledby":t,onKeyDown:e=>{" "===e.key&&y(e)},onClick:p?r.Q1:y,ref:x},b?i.createElement("div",{className:l.checkboxCheckmark}):null),i.createElement("label",{id:t,onClick:y,className:u},m))}},46154:(e,t,n)=>{n.d(t,{q:()=>L});var r=n(92379),i=n(85837),a=n(95295);const o=({children:e,style:t,dataGrammarlyPart:n="ui-kit-iframe",...i})=>{const[o,s]=r.useState(null),c=r.useCallback((e=>{var t,n;let r=null;"contentDocument"in e.target&&(r=null!==(n=null===(t=e.target.contentDocument)||void 0===t?void 0:t.body)&&void 0!==n?n:null),s(r),r&&(r.style.margin="0",r.style.height="100vh",r.style.overflowY="hidden")}),[]);return r.createElement("iframe",{...i,style:{border:"none",...t},onLoad:c,srcDoc:"<html><body></body></html>","data-grammarly-part":n},o&&(0,a.createPortal)(e,o))};var s=n(28510),c=n(90595),l=n(29483),d=n(58799),u=n.n(d);const h=({placeholder:e,ariaLabel:t,onChange:n})=>{const[i,a]=r.useState("");return r.useEffect((()=>{n(i)}),[i]),r.createElement(r.Fragment,null,r.createElement(s.b,null,u().__css),r.createElement("div",{role:"textbox",className:u().textBox,contentEditable:!0,onInput:e=>{a(e.target.innerText)},"data-placeholder":e,"aria-placeholder":e,"aria-label":t}))},m=({placeholder:e,onChange:t,ariaLabel:n,iframeTitle:i,className:a})=>(0,l.OB)().experimentClient.isGateEnabled(c.K.CentralizeStopEventPropagation)?r.createElement("div",{className:a,style:{width:"100%",height:"128px",maxHeight:"inherit"}},r.createElement(h,{onChange:t,ariaLabel:n,placeholder:e})):r.createElement(o,{dataGrammarlyPart:"ui-kit-textbox",className:a,style:{width:"100%",height:"100%"},title:i},r.createElement(h,{onChange:t,ariaLabel:n,placeholder:e}));var p=n(42496),g=n(2087),f=n(53345);const _=e=>e.domain?r.createElement(r.Fragment,null,e.withHelpText&&r.createElement("div",{className:f.feedbackFormShareDomainTitle},"Help improve Grammarly by sharing the domain you’re on:"),r.createElement(g.J,{checked:e.checked,labelId:"feedback-form-share-domain-checkbox",onChange:e.onChange,className:f.feedbackFormShareDomainCheckbox},"Include the domain ",r.createElement("b",null,e.domain)," with my feedback")):null;var k=n(59819),b=n(72032);const v=e=>{const t=(0,b.T)("go");return e.isEnabled?r.createElement(k.T,{composition:"mark",accessibilityLabel:"",brand:t,height:26,className:f.feedbackFormLogoLine}):null},y=e=>{var t;if(!e.isEnabled)return null;const n=null!==(t=e.title)&&void 0!==t?t:r.createElement("span",null,"How do you like ",r.createElement("br",null)," Grammarly?");return r.createElement("h3",{...(0,i.Sh)(f.feedbackFormTitle,e.isCompact&&f.compact)},n)},C=e=>r.createElement(r.Fragment,null,r.createElement(g.J,{checked:e.checked,labelId:"feedback-form-share-user-text-checkbox",onChange:e.onChange,className:f.feedbackFormShareUserTextCheckbox},r.createElement("p",null,"Share my text with Grammarly")),r.createElement("p",{className:f.fedbackFormShareUserTextCheckboxLabel},"The text you checked with Grammarly will also be shared to improve the quality of our suggestions. Your feedback and text will not be associated with your account and will be deleted within 100 days. We will not use your feedback to train any models."));var x=n(79584);const w=({options:e,onChange:t=(()=>null),ariaLabel:n,className:a})=>{const o=[],[s,c]=r.useState(null);r.useEffect((()=>{var n;null!==s&&(null===(n=o[s])||void 0===n||n.focus()),t(null!==s?e[s].value:null)}),[s]);const l=null!==s?e[s]:null;return r.createElement("div",{"data-grammarly-part":"ui-kit-radio-group",className:a},r.createElement("div",{className:x.radioGroup,role:"radiogroup","aria-label":n,onKeyDown:t=>{if(" "!==t.key||l){if("ArrowRight"===t.key||"ArrowDown"===t.key){t.preventDefault(),t.stopPropagation();c(((s||0)+1)%e.length)}else if("ArrowLeft"===t.key||"ArrowUp"===t.key){t.preventDefault(),t.stopPropagation();const n=(s||0)-1;c(n<0?e.length-1:n)}}else t.preventDefault(),t.stopPropagation(),c(0)}},e.map(((e,t)=>{const n=(null==l?void 0:l.value)===e.value,a=0===t;return r.createElement("div",{key:e.value,...(0,i.Sh)(x.radioGroupOption,n?x.radioGroupOptionSelected:null),role:"radio",tabIndex:n||a&&!l?0:-1,"aria-checked":n,onClick:e=>{e.preventDefault(),e.stopPropagation(),c(t)},ref:e=>o.push(e)},e.render())}))))};var S,E=n(78767),I=n(60493);!function(e){e.bad="bad",e.ok="ok",e.good="good"}(S||(S={}));const T=e=>{const t=[S.bad,S.ok,S.good];return e.isEnabled?r.createElement(r.Fragment,null,r.createElement(w,{ariaLabel:"Feedback Score",options:t.map((e=>({value:e,render:()=>r.createElement("div",{className:I.feedbackFormOption},r.createElement("div",{...(0,i.Sh)(I.feedbackFormOptionIcon,D(e))}),r.createElement("div",null,function(e){switch(e){case S.bad:return"I dislike it";case S.ok:return"It’s OK";case S.good:return"I like it";default:(0,E.vE)(e)}}(e)))}))),onChange:e.onChange,...(0,i.Sh)(f.feedbackFormScore,e.compactDisplay&&f.compact)}),!e.hideTextBoxTitle&&r.createElement("div",{className:f.feedbackFormTextBoxTitle},"Anything we can improve?")):null};function D(e){switch(e){case S.bad:return I.feedbackFormOptionIconDisheartening;case S.ok:return I.feedbackFormOptionIconNeutral;case S.good:return I.feedbackFormOptionIconSmiling;default:(0,E.vE)(e)}}const A=e=>{var t,n,a;const[o,s]=r.useState(null),[c,l]=r.useState(""),[d,u]=r.useState(null!==(t=e.domainSharedByDefault)&&void 0!==t&&t),[h,g]=r.useState(!1);return r.createElement("form",{"data-grammarly-part":"surveys-feedback-form-fields",...(0,i.Sh)(f.feedbackFormContainer,"center"===e.align&&f.feedbackFormContainerAlignCenter,e.fixSubmitButtonOverflowBottomPadding&&f.feedbackFormContainerBottomPadding)},r.createElement("div",{className:f.feedbackFormFields},r.createElement(v,{isEnabled:!e.hideLogo}),r.createElement(y,{isEnabled:!e.hideTitle,title:e.title,isCompact:null!==(n=e.compactDisplay)&&void 0!==n&&n}),r.createElement(T,{isEnabled:e.withScore,compactDisplay:e.compactDisplay,hideTextBoxTitle:e.hideTextBoxTitle,onChange:s}),r.createElement(m,{onChange:l,placeholder:null!==(a=e.placeholderText)&&void 0!==a?a:"Your thoughts here",ariaLabel:"Feedback Text",iframeTitle:"Feedback text field",...(0,i.Sh)(f.feedbackFormTextBox,e.compactDisplay&&f.compact)}),r.createElement(_,{domain:e.domain,checked:e.domainSharedByDefault,withHelpText:!e.hideDomainHelpText,onChange:u}),e.showShareTextCheckbox&&r.createElement(C,{checked:h,onChange:g})),r.createElement(p.z,{type:"submit",onClick:t=>{t.preventDefault();const n=d?e.domain:void 0;e.withScore&&o?e.onSubmit({score:o,text:c,domain:n,shareUserText:h}):!e.withScore&&c&&e.onSubmit({text:c,domain:n,shareUserText:h})},disabled:e.withScore?!o:!c,width:"full","data-grammarly-part":"surveys-feedback-form-submit-button"},"Submit"))},R=e=>r.createElement("div",{"data-grammarly-part":"surveys-feedback-form-thank-you",...(0,i.Sh)(f.feedbackFormContainer,f.feedbackFormContainerAlignCenter,e.fixSubmitButtonOverflowBottomPadding&&f.feedbackFormContainerBottomPadding)},r.createElement("div",{className:f.feedbackFormSuccessMessageTextContainer},r.createElement("div",{className:f.feedbackFormSuccessMessageIcon}),r.createElement("div",{className:f.feedbackFormSuccessMessageTitle},"Thank you!"),r.createElement("div",{className:f.feedbackFormSuccessMessageSubtitle},"Your feedback helps us improve.")),r.createElement(p.z,{onClick:e.onClose,width:"full"},"Done"));var M=n(35431);const L=({hideLogo:e=!1,align:t="center",fixSubmitButtonOverflowBottomPadding:n=!1,showPostSubmitScreen:i=!0,...a})=>{const[o,s]=r.useState(!1),c=o&&i;return r.createElement("div",{style:a.style,"data-grammarly-part":"surveys-feedback-form",role:"region","aria-label":"Provide feedback","aria-live":"polite"},c?r.createElement(R,{fixSubmitButtonOverflowBottomPadding:n,onClose:a.onClose}):r.createElement(A,{...a,hideLogo:e,align:t,fixSubmitButtonOverflowBottomPadding:n,onSubmit:e=>{a.withScore?((0,M.n8)(e),a.onSubmit(e)):((0,M.TY)(e),a.onSubmit(e)),s(!0)}}))}},35431:(e,t,n)=>{function r(e){return"score"in e}function i(e){if(!r(e))throw new Error("Received unexpected feedback form data without score")}function a(e){if(r(e))throw new Error("Received unexpected feedback form data with score")}n.d(t,{TY:()=>a,dK:()=>r,n8:()=>i})},72032:(e,t,n)=>{n.d(t,{T:()=>i,n:()=>a});var r=n(18473);function i(e){return(0,r.Y)()?e:"grammarly"}function a(){return(0,r.Y)()?"Superhuman Go":"Grammarly"}},57401:(e,t,n)=>{var r=n(29929),i=n(7278)(r);i.push([e.id,"._z3YOv-textBox{font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#0e101a;font-size:14px;line-height:21px;font-feature-settings:'ss03' on;background:#f9faff;border:1px solid #e7e9f5;box-sizing:border-box;border-radius:4px;padding:10px 8px;overflow-y:auto;cursor:text;width:100%;height:100%;}._z3YOv-textBox:empty:before{font-feature-settings:'ss03' on;font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#6d758d;font-size:14px;line-height:21px;content:attr(data-placeholder)}",""]),i.locals={textBox:"_z3YOv-textBox"},e.exports=i},77375:e=>{e.exports={accordionContent:"RZ1tY",shown:"Rodx_",accordionHeader:"zZM6o",accordionItem:"SVcPo",accordionRoot:"ieqWq",accordionTrigger:"lQxeR",linkIcon:"oS7tX",headerContainer:"iMmjP",accordionIcon:"jaZE7",rotate:"Rbcv_"}},55987:e=>{e.exports={checkboxContainer:"Te37e",checkbox:"mFHkX",checkboxDS:"DdH2q",checkboxChecked:"JhHnz",checkboxCheckmark:"zShXt",spin:"tww6q"}},79584:e=>{e.exports={radioGroup:"KAzfW",radioGroupOption:"WkjDU",radioGroupOptionSelected:"onilo"}},53345:e=>{e.exports={feedbackFormContainer:"kjElf",feedbackFormContainerBottomPadding:"bXqDs",feedbackFormContainerAlignCenter:"hkEx2",feedbackFormFields:"Ua5wJ",feedbackFormTitle:"GnQ_a",feedbackFormTextBoxTitle:"kWEW0",feedbackFormLogoLine:"osGQI",compact:"b7yYp",feedbackFormScore:"ZOSRK",feedbackFormTextBox:"l8New",feedbackFormShareDomainTitle:"Qbnj_",feedbackFormShareDomainCheckbox:"VBCx1",feedbackFormShareUserTextCheckbox:"abP8L",fedbackFormShareUserTextCheckboxLabel:"hxgnL",feedbackFormSuccessMessageTextContainer:"ARBzt",feedbackFormSuccessMessageIcon:"kJIzg",feedbackFormSuccessMessageTitle:"iXQnf",feedbackFormSuccessMessageSubtitle:"Ydufo",spin:"Vv6WG"}},60493:e=>{e.exports={feedbackFormOption:"sp8vS",feedbackFormOptionIcon:"eH6DL",feedbackFormOptionIconDisheartening:"DhaWh",feedbackFormOptionIconNeutral:"BS_8d",feedbackFormOptionIconSmiling:"dUZNd",spin:"uouSO"}}}]);