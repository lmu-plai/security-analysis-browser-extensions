(self.webpackChunk=self.webpackChunk||[]).push([[4926],{45128:(e,t,n)=>{n.d(t,{Z:()=>a});var i=n(28338);const o=class e{constructor(t,n=new URLSearchParams){this.base=t,this.params=n;const o=e._toString(t,n).length;(0,i.kG)(o<e.MAX_URL_LENGTH,"url exceeded length limit",String(o));const a=t.toLowerCase();(0,i.kG)(!1===a.startsWith("javascript:")&&!1===a.startsWith("data:"),"url is not allowed to use javascript: or data: protocols",t)}addParams(t){const n=Object.entries(t).reduce(((e,[t,n])=>(e.append(t,n),e)),(i=this.params,new URLSearchParams(i.toString())));var i;return new e(this.base,n)}toString(){return e._toString(this.base,this.params)}static _toString(e,t){const n=t.toString();return`${e}${n.length?`?${n}`:""}`}};o.MAX_URL_LENGTH=2083;let a=o},66878:(e,t,n)=>{n.d(t,{K:()=>r});var i=n(16537),o=n(96643),a=n(19064);function r(e){return(0,a.e)((function(t,n){var a,d=null,c=!1;d=t.subscribe((0,o.x)(n,void 0,void 0,(function(o){a=(0,i.Xf)(e(o,r(e)(t))),d?(d.unsubscribe(),d=null,a.subscribe(n)):c=!0}))),c&&(d.unsubscribe(),d=null,a.subscribe(n))}))}},78129:(e,t,n)=>{n.d(t,{G:()=>a});var i=n(19064),o=n(96643);function a(){return(0,i.e)((function(e,t){var n,i=!1;e.subscribe((0,o.x)(t,(function(e){var o=n;n=e,i&&t.next([o,e]),i=!0})))}))}},71410:(e,t,n)=>{n.d(t,{i:()=>a});var i=n(88028),o=n(83477);const a=e=>{var t;return i.z.isVBar(e)&&i.h.isWithComment(e)&&e.surface.sourceAgent===o.a&&void 0!==(null==(t=e.surface.additionalElements)?void 0:t.plagiarism)}},119:(e,t,n)=>{var i,o,a,r;n.d(t,{P:()=>i,a:()=>r}),o=i||(i={}),(a=o.Kind||(o.Kind={})).markAsAddedButtonClick="markAsAddedButtonClick",a.dismissButtonClick="dismissButtonClick",a.copyCitationButtonClick="copyCitationButtonClick",a.cardShow="cardShow",o.markAsAddedButtonClick=function(e){return{kind:"markAsAddedButtonClick",pushedContentItemId:e}},o.dismissButtonClick=function(e){return{kind:"dismissButtonClick",pushedContentItemId:e}},o.copyCitationButtonClick=function(e){return{kind:"copyCitationButtonClick",pushedContentItemId:e}},o.cardShow=function(e){return{kind:"cardShow",pushedContentItemId:e}},(e=>{var t;(t=e.Kind||(e.Kind={})).updateCitationStyle="updateCitationStyle",t.openUphook="openUphook",t.trackUphook="trackUphook",t.textTooShortViewMounted="textTooShortViewMounted",t.loadingViewMounted="loadingViewMounted",t.loadedViewMounted="loadedViewMounted",t.lockedViewMounted="lockedViewMounted",e.updateCitationStyle=function(e){return{kind:"updateCitationStyle",citationStyle:e}},e.openUphook=function(e){return{kind:"openUphook",paywallUphook:e}},e.trackUphook=function(e,t){return{kind:"trackUphook",paywallUphook:e,event:t}},e.textTooShortViewMounted=function(){return{kind:"textTooShortViewMounted"}},e.loadingViewMounted=function(){return{kind:"loadingViewMounted"}},e.loadedViewMounted=function(){return{kind:"loadedViewMounted"}},e.lockedViewMounted=function(){return{kind:"lockedViewMounted"}}})(r||(r={}))},44926:(e,t,n)=>{n.r(t),n.d(t,{activate:()=>_});var i=n(50750),o=n(66878),a=n(36344),r=n(90572),d=n(59179),c=n(954),s=n(8867),u=n(32073),l=n(84308),p=n(20161),k=n(84178),h=n(84714),g=n(78129),C=n(98189),w=n(74822),S=n(29416),v=n(13391),m=n(45128),b=n(28338),f=n(64443),y=n(7627),V=n(83477),P=n(119),K=n(77115),M=n(35020),A=n(71410),B=n(67177),I=n(12518),x=n(90023),U=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),E=e=>{throw TypeError(e)};var L=(e=>(e.ComponentImpression="componentImpression",e.ComponentClicked="componentClicked",e))(L||{}),T=(e=>(e.ContentReceived="plagiarismContentReceived",e.CheckStartRequested="plagiarismCheckStartRequested",e.CheckStarted="plagiarismCheckStarted",e.CheckStartFailed="plagiarismCheckStartFailed",e.CheckStopRequested="plagiarismCheckStopRequested",e.CheckStopped="plagiarismCheckStopped",e.CheckStoppedFailed="plagiarismCheckStoppedFailed",e))(T||{}),R=(e=>(e.TextTooShortView="agentPanel/plagiarism/textTooShortView",e.LoadingView="agentPanel/plagiarism/loadingView",e.LoadedView="agentPanel/plagiarism/loadedView",e.LockedView="agentPanel/plagiarism/lockedView",e.MarkAsAddedButton="agentPanel/plagiarism/markAsAddedButton",e.DismissButton="agentPanel/plagiarism/dismissButton",e.CopyCitationButton="agentPanel/plagiarism/copyCitationButton",e.Card="agentCard/plagiarism",e))(R||{});function O(e,t,n,i,C,w,S,m,b){return new s.y((f=>{const y=new u.w0,U=v.h.create(new Set);y.add(S.subscribe((e=>{if(e.kind===P.P.Kind.markAsAddedButtonClick)return U.modify((t=>new Set(t).add(e.pushedContentItemId)))})));const E=v.h.create(null);y.add((0,l.a)([t.asyncScores.view("plagiarism").pipe((0,r.h)(K.C_),(0,d.U)((e=>100*e.outcomeScores.Originality))),n.getCollection(A.i,C).view((e=>M.$.values(e).filter(A.i))),U,m,t.asyncCheckingState.view("plagiarism").view((e=>"idle"!==e))]).subscribe((([e,t,n,i,o])=>{b.next({event:T.ContentReceived,detail:{remainingSuggestionCount:t.length,citedSuggestionCount:n.size,originalityScorePercent:e}}),E.set(V.P.loaded(n,t,e,i,o))})));const L=C.pipe((0,p.w)((e=>e?w.view(V.i).pipe((0,r.h)(Boolean),(0,k.q)(1)):(0,h.of)(!1))));return y.add(L.pipe((0,c.O)(null),(0,g.G)(),(0,p.w)((([t,n])=>n?function(e,t,n){return new s.y((i=>{const o=(0,x.zG)(e.request({commandId:"start",payload:"",agentId:V.a}),B.Vn((e=>(n.error("Error while starting checks",e),e))));t.next({event:T.CheckStartRequested,detail:{}}),o().then((e=>{I.nM(e)?(t.next({event:T.CheckStartFailed,detail:{error:e.left.message}}),i.error(e.left)):(t.next({event:T.CheckStarted,detail:{}}),i.next(null),i.complete())}))}))}(e,b,i).pipe((0,d.U)((()=>null)),(0,c.O)(E.get()??V.P.loading())):!0===t?function(e,t,n){return new s.y((i=>{const o=(0,x.zG)(e.request({commandId:"stop",payload:"",agentId:V.a}),B.Vn((e=>(n.error("Error while stopping checks",e),e))));t.next({event:T.CheckStopRequested,detail:{}}),o().then((e=>{I.nM(e)?(t.next({event:T.CheckStoppedFailed,detail:{error:e.left.message}}),i.error(e.left)):(t.next({event:T.CheckStopped,detail:{}}),i.complete())}))}))}(e,b,i):a.E)),(0,o.K)((e=>(i.error("Error while starting/stopping checks",e),a.E))),(0,p.w)((e=>null!==e?(0,h.of)(e):E.pipe((0,r.h)(K.C_))))).subscribe(f)),y}))}function G(e){const t=e.capiConnectionStatus.view((e=>"connected"===e.kind?e.sessionId:null)).pipe((0,C.n)((e=>null===e))),n=new w.x;return{state:e.userService.user.view("free").pipe((0,p.w)((s=>s?function(e,t){return(0,i.D)(e.getUphookConfig("plagiarismAgentPanelPaywall")).pipe((0,o.K)((e=>(t.error("Error while fetching uphook config",e),a.E))),(0,r.h)(K.C_),(0,d.U)((e=>V.P.locked(e))),(0,c.O)(V.P.locked(null)))}(e.uphookHubClient,e.logger):t.pipe((0,p.w)((t=>null===t?(0,h.of)(V.P.loading(e.citationStyle.get())):O(e.agentGenericService,e.capiCheckingState,e.pushedContentService,e.logger,e.isPanelOpen,e.wordCount,e.cardActions,e.citationStyle,n))),(0,c.O)(s?V.P.locked(null):(0,V.i)(e.wordCount.get())?V.P.loading(e.citationStyle.get()):V.P.textTooShort(e.citationStyle.get())))))),trackingEvents:n}}const _=async({bus:e,userService:t,document:n,pushedContentService:i,capiConnectionStatus:o,capiCheckingState:a,navigation:d,uphookHubClient:c,environment:s,agentGenericService:u,trackingServiceProvider:l})=>{var p=[];try{const g=((e,t,n)=>{var i;return null!=t?("object"!=typeof t&&"function"!=typeof t&&E("Object expected"),n&&(i=t[U("asyncDispose")]),void 0===i&&(i=t[U("dispose")]),"function"!=typeof i&&E("Object not disposable"),e.push([n,i,t])):n&&e.push([n]),t})(p,new DisposableStack),C=f.C8.Logging.getLogger("PlagiarismCheckerAgent"),w=g.use(e.state.panelState.create(n.id,V.P.initial())),K=v.h.create(y.aO.APA),M=l.getTrackingService(),{state:A,trackingEvents:B}=G({agentGenericService:u,uphookHubClient:c,userService:t,capiCheckingState:a,pushedContentService:i,capiConnectionStatus:o,isPanelOpen:d.isPanelOpen,wordCount:n.textInfo.view((e=>(null==e?void 0:e.wordCount)??null)),cardActions:e.events.cardAction.view(n.id),citationStyle:K,logger:C});g.adopt(A.subscribe((e=>w.set(e))),(e=>e.unsubscribe()));const I=()=>{var e;const t=o.get();return{agentId:V.a,capiSessionId:"connected"===t.kind?t.sessionId:void 0,documentWordCount:null==(e=n.textInfo.get())?void 0:e.wordCount}};return g.adopt(B.pipe((0,r.h)((({event:e})=>e!==T.ContentReceived))).subscribe((({event:e,detail:t})=>M.trackEvent(e,{...I(),...t}))),(e=>e.unsubscribe())),g.adopt(B.pipe((0,r.h)((({event:e})=>e===T.ContentReceived)),(0,S.b)(100)).subscribe((({event:e,detail:t})=>M.trackEvent(e,{...I(),...t}))),(e=>e.unsubscribe())),g.adopt(e.events.panelAction.view(n.id).subscribe((e=>{const t=function(e,t,n){const i=t();switch(n.kind){case P.a.Kind.textTooShortViewMounted:case P.a.Kind.loadingViewMounted:case P.a.Kind.loadedViewMounted:case P.a.Kind.lockedViewMounted:return{event:L.ComponentImpression,detail:{componentId:{[P.a.Kind.textTooShortViewMounted]:R.TextTooShortView,[P.a.Kind.loadingViewMounted]:R.LoadingView,[P.a.Kind.loadedViewMounted]:R.LoadedView,[P.a.Kind.lockedViewMounted]:R.LockedView}[n.kind],detail:n.kind===P.a.Kind.loadedViewMounted&&i.kind===V.P.Kind.Loaded?{...e(),remainingSuggestionCount:i.pushedContentItems.length,citedSuggestionCount:i.citedPushedContentItemsIds.size,originalityScorePercent:i.originalityScorePercent}:e()}};case P.a.Kind.updateCitationStyle:case P.a.Kind.openUphook:case P.a.Kind.trackUphook:return null;default:(0,b.L0)(n)}}(I,(()=>w.get()),e);switch(t&&M.trackEvent(t.event,t.detail),e.kind){case P.a.Kind.updateCitationStyle:K.set(e.citationStyle);break;case P.a.Kind.openUphook:s.actions.openPopup(new m.Z(e.paywallUphook.content.ctaUrl));break;case P.a.Kind.trackUphook:c.trackUphookEvent(e.paywallUphook,e.event);break;case P.a.Kind.textTooShortViewMounted:case P.a.Kind.loadingViewMounted:case P.a.Kind.loadedViewMounted:case P.a.Kind.lockedViewMounted:break;default:(0,b.L0)(e)}})),(e=>e.unsubscribe())),g.adopt(e.events.cardAction.view(n.id).subscribe((e=>{const t=function(e,t){switch(t.kind){case P.P.Kind.markAsAddedButtonClick:case P.P.Kind.dismissButtonClick:case P.P.Kind.copyCitationButtonClick:return{event:L.ComponentClicked,detail:{componentId:{[P.P.Kind.markAsAddedButtonClick]:R.MarkAsAddedButton,[P.P.Kind.dismissButtonClick]:R.DismissButton,[P.P.Kind.copyCitationButtonClick]:R.CopyCitationButton}[t.kind],detail:e()}};case P.P.Kind.cardShow:return{event:L.ComponentImpression,detail:{componentId:R.Card,detail:e()}};default:(0,b.L0)(t)}}(I,e);t&&M.trackEvent(t.event,t.detail)})),(e=>e.unsubscribe())),g.move()}catch(e){var k=e,h=!0}finally{((e,t,n)=>{var i="function"==typeof SuppressedError?SuppressedError:function(e,t,n,i){return(i=Error(n)).name="SuppressedError",i.error=e,i.suppressed=t,i},o=e=>t=n?new i(e,t,"An error was suppressed during disposal"):(n=!0,e),a=i=>{for(;i=e.pop();)try{var r=i[1]&&i[1].call(i[2]);if(i[0])return Promise.resolve(r).then(a,(e=>(o(e),a())))}catch(e){o(e)}if(n)throw t};a()})(p,k,h)}}}}]);