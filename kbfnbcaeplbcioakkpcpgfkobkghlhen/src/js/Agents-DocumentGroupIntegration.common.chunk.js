(self.webpackChunk=self.webpackChunk||[]).push([[9153],{77784:(e,t,i)=>{function s(){return"agents/@impl"}function n(e){return`agents/${e}`}function o(e,...t){return r(e,...t)}function r(e,...t){return`agents/@impl/${e}${d(t)}`}function a(e,t,...i){return c(e,t,...i)}function c(e,t,...i){return`${n(e)}/${t}${d(i)}`}function u(e,...t){return`agents/${e}${d(t)}`}function d(e){const t=e.filter(Boolean).join("/");return t?`/${t}`:""}i.d(t,{EZ:()=>r,Lu:()=>n,Yx:()=>c,e7:()=>s,rL:()=>u,wS:()=>o,yp:()=>a})},45107:(e,t,i)=>{i.r(t),i.d(t,{AgentsDocumentGroupIntegration:()=>L});var s=i(90572),n=i(10556),o=i(13391),r=i(94857),a=i(39963),c=i(78767),u=i(40594),d=i(77784),h=i(80891);class l{constructor(e){this._experimentClient=e}isAssigned(e,...t){if(e instanceof h.Cc)return this._experimentClient.isGateEnabled(e);const i=this._experimentClient.getTreatment(e);return null!==i&&i!==h.q4&&t.includes(i)}getTreatment(e){const t=this._experimentClient.getTreatment(e);return t===h.q4?null:t}peekExperiment(e,...t){const i=this._experimentClient.peekTreatment(e);return null!==i&&i!==h.q4&&t.includes(i)}}var g=i(90023),p=i(12518),v=i(11393);class _{constructor(e,t){const i=u.Y.create("AgentsTrackingServiceProvider");this._trackingService={trackEvent:(s,n)=>{e.sendFeedback({eventName:s,eventData:JSON.stringify(n),agentId:t})().then((e=>(0,g.zG)(e,p.pF((e=>{throw e}))))).then((e=>{i.debug("Tracking event sent successfully",{event:s,detail:n,response:e})})).catch((e=>{e instanceof v.W5?i.debug("Didn't receive the success response for tracking request on time (it doesn't necessarily mean that the event was not tracked)",{event:s,detail:n,error:e}):i.debug("Tracking request failed",{event:s,detail:n,error:e})}))}}}getTrackingService(){return this._trackingService}}class m{constructor(e,t){this._actions=e,this._telemetry=t,this._log=u.Y.create("AgentsUphookHubClient")}async getUphookConfig(e){try{const t=await this._actions.getConfiguration(e);return(0,g.zG)(t,p.g_((e=>{throw e}),(e=>e)))}catch(t){throw this._telemetry.agents.cs.error(`Failed to get uphook config for ${e}`,t),this._log.warn(`Failed to get uphook config for ${e}`,t),t}}async trackUphookEvent(e,t){try{const i=await this._actions.trackConfiguration(t,e);(0,g.zG)(i,p.g_((e=>{throw e}),(()=>{})))}catch(i){const s=`Failed to track uphook event for ${(null==e?void 0:e.upgradeHookSlot)||"unknown"} uphook with event kind ${t}`;throw this._telemetry.agents.cs.error(s,i),this._log.warn(s,i),i}}}var f=i(35218),k=i(6219);const S=e=>{const t=new Set;return"edge"!==e.browser&&"msie"!==e.browser&&t.add(k.L.Flag.supportsSVGDominantBaseline),{has:e=>t.has(e)}};class C{constructor(){this.openUrl=e=>(0,p.Y3)((()=>{document.location.href=e.toString()}),p.KC),this.openPopup=e=>(0,p.Y3)((()=>{const t=self.open(e.toString(),"_blank","noopener,noreferrer");t&&(t.opener=null)}),p.KC)}}var b=i(11851),w=i(15782),x=i(58303),y=i(17479),A=i(76707),I=i(59179),F=i(31603),R=i(67177),T=i(25453);class D{constructor(e){this._checkingService=e,this._handlers=[],this._log=u.Y.create("AgentsCapiClient"),this._checkingService.pipe(s.h(x.pC),I.U((e=>e.value.capiMessages)),F.J(),s.h((e=>(0,y.rE)(e)||(0,A.eJ)(e))),I.U((e=>e))).subscribe((e=>{this._handlers.forEach((t=>(this._log.debug("Handling CAPI Message",e),t(e),T._.Result.STOP_HANDLING)))}))}enqueueExternalCommand(e){this._log.debug("Enqueueing External Command",e);const t=(0,g.zG)(this._checkingService.get(),x.g_((()=>""),(e=>e.sessionUuid||""))),{action:i,...s}=e({sessionId:t,id:1,currentRevision:0,nextRevision:()=>1});return(0,g.zG)(this._checkingService.get(),R.Yo((()=>new v.YG("Checking service is not available"))),R.tS((e=>e.sendMessage(i,s,!0))))}registerExternalMessageHandler(e){this._handlers.includes(e)||this._handlers.push(e)}unregisterExternalMessageHandler(e){this._handlers=this._handlers.filter((t=>t!==e))}}var P=i(20680),E=i(79256),$=i(84714),Y=i(36344),G=i(20161),U=i(559),B=i(40866);class M{constructor(){this._pendingRevision=0,this._finishedRevisions={regular:-1,plagiarism:-1,ai_detector:-1,writing_expert_check:-1,ai_studio:-1,audience_adapt:-1},this._wasChecked={regular:!1,plagiarism:!1,ai_detector:!1,writing_expert_check:!1,ai_studio:!1,audience_adapt:!1},this.reset()}getCheckState(e){return this._pendingRevision>this._finishedRevisions[e]?this._wasChecked[e]?"checking":"full":"idle"}getRevisionCheckState(){return this.getCheckState("regular")}getAsyncChecksState(){return{plagiarism:this.getCheckState("plagiarism"),ai_detector:this.getCheckState("ai_detector"),writing_expert_check:this.getCheckState("writing_expert_check"),ai_studio:this.getCheckState("ai_studio"),audience_adapt:this.getCheckState("audience_adapt")}}stage(e){this._pendingRevision=Math.max(this._pendingRevision,e)}finishRevision(e){this._finishedRevisions.regular=Math.max(this._finishedRevisions.regular,e),this._wasChecked.regular=!0}finishAsyncCheck(e,t){this._finishedRevisions[e]=Math.max(this._finishedRevisions[e],t),this._wasChecked[e]=!0}reset(){this._pendingRevision=0,this._finishedRevisions={regular:-1,plagiarism:-1,ai_detector:-1,writing_expert_check:-1,ai_studio:-1,audience_adapt:-1}}}var N=i(61797);function H(e){const t=new DisposableStack,i=function(e,t,i,s,n){const o=()=>N.RI.resFromText(t());return{id:e,isActive:s,getText:o,textChanges:(0,P.z)((0,E.P)((()=>(0,$.of)(o()))),i),textInfo:n}}(e.documentId,e.getPlainText,e.textChanges,e.isTextFieldFocused,o.h.combine(e.statisticsService.wordsCount,e.statisticsService.charsCount,((e,t)=>({wordCount:e,charCount:t})))),n=new D(e.checkingService.view(x.ij)),r=b.W.create(n),a=w.J.create(n),{capiEvents:u,sessionChecksState:d,capiCheckingState:h,capiConnectionStatus:l}=t.use(function(e,t,i){const n=new DisposableStack,r=(0,P.z)((0,E.P)((()=>{const e=t.get();return e?(0,$.of)({...e,kind:"session_started",allowedFeatures:e.allowedFeatures,isNewSession:void 0===e.reconnectedInfo||void 0!==e.reconnectedInfo.reconnectFailedReason,sessionUuid:e.sessionUuid,domainName:e.domainName,domainCategory:e.domainCategory,defaultDocumentContext:x.YP}):Y.E})),e.pipe((0,s.h)(c.C_),(0,G.w)((e=>e.capiEvents)))),a=new M,u=o.h.create(a.getRevisionCheckState()),d=o.h.create(a.getAsyncChecksState()),h=o.h.create(null),l=o.h.create({}),p=o.h.create({kind:"connecting"});n.adopt(e.pipe((0,G.w)((e=>e?e.checkingRevisionInfo:Y.E))).subscribe((e=>{a.stage(B.Q.getRevisionNumber(e.revision)),u.set(a.getRevisionCheckState()),d.set(a.getAsyncChecksState())})),(e=>e.unsubscribe())),n.adopt(r.subscribe((e=>{if(U.hX.is("session_started")(e))p.set({kind:"connected",sessionId:e.sessionUuid,isNewSession:e.isNewSession,allowedFeatures:e.allowedFeatures}),a.reset(),u.set(a.getRevisionCheckState()),d.set(a.getAsyncChecksState());else if(U.hX.is("finish")(e))a.finishRevision(e.revision),u.set(a.getRevisionCheckState()),h.set({revision:e.revision,outcomeScores:e.outcomeScores,scoreStatus:x.FS(e.scoreStatus)});else if(U.hX.is("feedback_ack")(e))h.modify((t=>{var i;return{revision:null!==(i=null==t?void 0:t.revision)&&void 0!==i?i:-1,outcomeScores:e.outcomeScores,scoreStatus:e.scoreStatus}}));else if(U.hX.is("async_check_finished")(e))a.finishAsyncCheck(e.check,e.revision),d.set(a.getAsyncChecksState()),l.modify((t=>({...t,[e.check]:{revision:e.revision,outcomeScores:e.outcomeScores}})));else if(U.hX.is("disconnect")(e)){const e=p.get();p.set({kind:"disconnected",sessionId:"connecting"===e.kind?null:e.sessionId})}})),(e=>e.unsubscribe()));const v=o.h.create(x.YP);return n.adopt(i.subscribe((e=>{v.set(e?x.G({wordsCount:e.wordCount,charsCount:e.charCount,messages:x.YP,readabilityScore:0,readingTime:(0,g.MZ)({h:0,m:0,s:0}),speakingTime:(0,g.MZ)({h:0,m:0,s:0}),sessionStats:(0,g.MZ)({})}):x.YP)})),(e=>e.unsubscribe())),{capiConnectionStatus:p,capiCheckingState:{checkingState:u,asyncCheckingState:d,scores:h,asyncScores:l},capiEvents:r,sessionChecksState:{textInfo:v,checkingState:u,asyncChecksState:d,score:o.h.create(x.YP),scoreStatus:o.h.create(x.YP)},[Symbol.dispose]:()=>n.dispose()}}(e.checkingService,e.capiStartAckMessage,i.textInfo));return{document:i,capiConnectionStatus:l,capiCheckingState:h,agentGenericService:r,fileUploadService:a,pushedContentService:e.pushedContentService,capiEvents:u,sessionChecksState:d,[Symbol.dispose]:()=>t.dispose()}}var q=i(24196),z=i(40795);function X(e){return{[Symbol.asyncDispose]:async()=>{if(!e)return;const t=await e;t&&(!function(e){return Symbol.dispose in e}(t)?function(e){return Symbol.asyncDispose in e}(t)&&await t[Symbol.asyncDispose]():t[Symbol.dispose]())}}}class L{constructor(e){var t;this._disposables=new AsyncDisposableStack,this._logger=u.Y.create("AgentsDocumentGroupIntegration"),this._focusedTextField=o.h.create(null),this._platformInfo=r.W.detect(),this._environment=(t=this._platformInfo,new f.f(S(t),new C)),this._telemetry=(0,a.Tb)(),this._experimentClient=e.experimentClient,this._messageBusClient=e.messageBusClient,this._platformBus=this._messageBusClient.platformBus,this._agentDefinitions=(0,z.c)(e.experimentClient),this._experimentationService=new l(e.experimentClient),this._uphookHubClient=(0,q.sI)(e.experimentClient)?new m(e.actions,this._telemetry):{getUphookConfig:()=>Promise.resolve(void 0),trackUphookEvent:()=>Promise.resolve()},this._userService={user:e.user.view((e=>({id:e.id,firstName:e.firstName,email:e.email,free:!e.premium,anonymous:e.anonymous})))},this._activeDocumentForTab=this._disposables.use(this._platformBus.state.activeDocument.create(e.tabId,null)),this._activePanelAgentId=this._disposables.use(this._platformBus.state.activePanelAgentId.view(null));const i=this._disposables.use(this._platformBus.state.activeTabId.view(null)).view((t=>t===e.tabId));this._disposables.adopt(o.h.combine(i,this._focusedTextField,((e,t)=>e?t:null)).subscribe((e=>this._activeDocumentForTab.set(e))),(e=>e.unsubscribe()))}runDocumentActivations(e){const t=this._runActivations("documentActivate",e.textFieldSupportsAgents,(t=>{const i=t.use(H(e));return this._disposables.adopt(e.isTextFieldFocused.pipe((0,s.h)(Boolean)).subscribe((()=>this._focusedTextField.set({id:e.documentId,supportsAgents:e.textFieldSupportsAgents}))),(t=>{var i;(null===(i=this._focusedTextField.get())||void 0===i?void 0:i.id)===e.documentId&&this._focusedTextField.set(null),t.unsubscribe()})),{environment:this._environment,platformInfo:this._platformInfo,userService:this._userService,uphookHubClient:this._uphookHubClient,...i}}),((e,t)=>{var i,s;const n=new _(t.agentGenericService,e.id),o={...t,trackingServiceProvider:n};return null===(s=(i=e.integrations).documentActivate)||void 0===s?void 0:s.call(i,o).then((t=>({...t,...X(null!=t?t:{}),agentId:e.id})))}),e.documentId);return{dispose:()=>t.dispose()}}runTextDecorationActivations(e){return this._runActivations("textDecorationsActivate",e.textFieldSupportsAgents,(()=>({documentId:e.documentId})),((e,t)=>{var i,s;return null===(s=(i=e.integrations).textDecorationsActivate)||void 0===s?void 0:s.call(i,t).then((i=>({...i,...X(i),agentId:e.id,isActive:t.navigation.isPanelOpen})))}),e.documentId)}runInlineCardActivations(e){return this._runActivations("inlineCardActivate",e.textFieldSupportsAgents,(()=>({documentId:e.documentId})),((e,t)=>{var i,s;return null===(s=(i=e.integrations).inlineCardActivate)||void 0===s?void 0:s.call(i,t).then((t=>({...t,...X(t),agentId:e.id})))}),e.documentId)}_runActivations(e,t,i,s,o){if(!(0,q.w4)(this._experimentClient))return{integrations:[],dispose:c.EI};const r=new AsyncDisposableStack;this._disposables.defer((()=>r.disposeAsync()));const a=[],u={documentActivate:"doc",textDecorationsActivate:"text-decorations",inlineCardActivate:"inline-card"},h=i(r);if(!t)return{integrations:a,dispose:()=>{r.disposeAsync()}};for(const t of this._agentDefinitions){this._logger.debug(`Running ${u[e]} activation for ${t.id} on document ${o}`);const i=this._messageBusClient.createPort({name:(0,d.yp)(t.id,u[e],o)}),c=s(t,{documentId:o,bus:r.use((0,n.kX)({port:i,clientId:(0,d.Yx)(t.id,u[e],o),keyPrefix:(0,d.Lu)(t.id),protocol:t.protocol})),navigation:{isPanelOpen:this._activePanelAgentId.view((e=>e===t.id))},experimentation:this._experimentationService,...h});null==c||c.then((i=>this._logger.debug(`Activation result for ${t.id}.${e} on document ${o}:`,i))),c&&(r.use(X(c)),a.push(c))}return{integrations:a,dispose:()=>{r.disposeAsync()}}}[Symbol.asyncDispose](){return this._disposables.disposeAsync()}}}}]);