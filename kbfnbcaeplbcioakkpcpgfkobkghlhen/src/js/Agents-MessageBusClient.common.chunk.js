(self.webpackChunk=self.webpackChunk||[]).push([[4943],{10556:(t,e,s)=>{s.d(e,{D8:()=>n.D,TJ:()=>n.T,kX:()=>i.k});var i=s(16386),n=s(24071)},90150:(t,e,s)=>{s.d(e,{S:()=>d});var i,n,o,r=t=>{throw TypeError(t)},a=(t,e,s)=>e.has(t)||r("Cannot "+s),l=(t,e,s)=>(a(t,e,"read from private field"),s?s.call(t):e.get(t)),c=(t,e,s)=>e.has(t)?r("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),h=(t,e,s,i)=>(a(t,e,"write to private field"),e.set(t,s),s);class d{constructor(t){c(this,i,new DisposableStack),c(this,n,new Map),c(this,o),h(this,o,t)}send(t){l(this,o).send(t)}subscribe(t){const e=new DisposableStack;e.defer((()=>{const e=l(this,n).get(t);null==e||e[Symbol.dispose](),l(this,n).delete(t)}));const s=new DisposableStack;return l(this,n).set(t,s),null!==l(this,o)&&s.use(l(this,o).subscribe(t)),e}connectToServerPort(t){h(this,o,t);for(const[t,e]of l(this,n)){e[Symbol.dispose]();const s=l(this,o).subscribe(t);l(this,n).set(t,s)}}[Symbol.dispose](){l(this,i).dispose()}}i=new WeakMap,n=new WeakMap,o=new WeakMap},24978:(t,e,s)=>{s.d(e,{C:()=>n});var i=s(10452);class n extends i.l{constructor(t){super(t)}}},10452:(t,e,s)=>{s.d(e,{l:()=>nt});var i,n,o,r,a,l,c,h,d,u,p,b,m,v,f,k,y,I,g,w,S,P,_,M,W,D,C,B,x,j,T,$,O,E,A,N,R=s(49486),V=s(76352),z=s(76890),L=s(44428),X=s(94311),Z=Object.defineProperty,F=Object.defineProperties,G=Object.getOwnPropertyDescriptors,J=Object.getOwnPropertySymbols,Y=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,H=t=>{throw TypeError(t)},K=(t,e,s)=>e in t?Z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Q=(t,e)=>{for(var s in e||(e={}))Y.call(e,s)&&K(t,s,e[s]);if(J)for(var s of J(e))q.call(e,s)&&K(t,s,e[s]);return t},U=(t,e,s)=>e.has(t)||H("Cannot "+s),tt=(t,e,s)=>(U(t,e,"read from private field"),s?s.call(t):e.get(t)),et=(t,e,s)=>e.has(t)?H("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),st=(t,e,s,i)=>(U(t,e,"write to private field"),e.set(t,s),s),it=(t,e,s)=>(U(t,e,"access private method"),s);class nt{constructor(t){var e,s;et(this,b),et(this,i,new DisposableStack),et(this,n),et(this,o),et(this,r),et(this,a),et(this,l,!1),et(this,c,null),et(this,h,tt(this,i).adopt(new Map,(t=>t.clear()))),et(this,d,tt(this,i).adopt(new Map,(t=>t.clear()))),et(this,u,tt(this,i).adopt(new Map,(t=>t.clear()))),et(this,p,tt(this,i).adopt(new Map,(t=>t.clear()))),st(this,n,t.serverPort),st(this,o,null!=(e=t.tracingOptions)?e:{enabled:!1}),st(this,r,t.retainedValueStorage),st(this,a,`${(0,X.v)()}${void 0!==t.name?`(${t.name})`:""}`),tt(this,i).use(null==(s=tt(this,n))?void 0:s.subscribe((t=>it(this,b,v).call(this,t)))),tt(this,i).defer((()=>{var e;return null==(e=t.retainedValueStorage)?void 0:e.clear()})),void 0!==tt(this,n)&&this.connect()}isConnected(){return!tt(this,l)}waitConnected(){var t,e;return null!=(e=null==(t=tt(this,c))?void 0:t.promise)?e:Promise.resolve()}connect(){return t=this,e=null,s=function*(){var t;if(!tt(this,n))return Promise.resolve();null==(t=tt(this,c))||t.reject(new Error("Connection attempt superseded by a newer one")),st(this,l,!0),tt(this,p).forEach((t=>t.setBufferingEnabled(!0)));const e=`${tt(this,a)}|${(0,X.v)()}`,s=(0,z.B)();return st(this,c,{attempId:e,resolve:()=>{var t;(null==(t=tt(this,c))?void 0:t.attempId)===e&&(st(this,l,!1),st(this,c,null),tt(this,p).forEach((t=>t.setBufferingEnabled(!1))),s.resolve())},reject:t=>{var i;(null==(i=tt(this,c))?void 0:i.attempId)===e&&(st(this,l,!1),st(this,c,null),s.reject(t))},promise:s.promise}),tt(this,n).send({kind:"handshake",id:e,subscriptions:[...tt(this,h).values()].map((t=>({key:t.key,clientId:t.clientId,subscriptionId:t.portId,timestamp:t.timestamp}))),retainedValues:[...tt(this,u).entries()].map((([t,e])=>({key:t,value:e.value,clientId:e.lastWriterClientId,timestamp:e.modifiedTimestamp})))}),s.promise},new Promise(((i,n)=>{var o=t=>{try{a(s.next(t))}catch(t){n(t)}},r=t=>{try{a(s.throw(t))}catch(t){n(t)}},a=t=>t.done?i(t.value):Promise.resolve(t.value).then(o,r);a((s=s.apply(t,e)).next())}));var t,e,s}createPort(t){const e=null==t?void 0:t.name,s=`${tt(this,a)}|${(0,X.v)()}${void 0!==e?`(${e})`:""}`,n=tt(this,i).use(new ot({send:t=>it(this,b,y).call(this,s,t),notifyDispose:()=>it(this,b,m).call(this,s),shouldBufferMessages:tt(this,l),tracingOptions:void 0!==(null==t?void 0:t.tracingOptions)?t.tracingOptions:tt(this,o),portId:s}));return tt(this,p).set(s,n),n}[Symbol.dispose](){tt(this,i).dispose()}}i=new WeakMap,n=new WeakMap,o=new WeakMap,r=new WeakMap,a=new WeakMap,l=new WeakMap,c=new WeakMap,h=new WeakMap,d=new WeakMap,u=new WeakMap,p=new WeakMap,b=new WeakSet,m=function(t){const e=tt(this,p).get(t);if(void 0!==e){for(const[e,s]of tt(this,h).entries())s.portId===t&&it(this,b,_).call(this,t,{kind:"unsubscribe",subscriptionId:e});e[Symbol.dispose](),tt(this,p).delete(t)}},v=function(t){switch(t.kind){case"publish":it(this,b,k).call(this,t);break;case"handshake-ack":it(this,b,f).call(this,t)}},f=function(t){var e;(null==(e=tt(this,c))?void 0:e.attempId)===t.id&&tt(this,c).resolve()},k=function(t){var e,s;const i=tt(this,u).get(t.key);if(void 0!==i){if(t.timestamp<i.modifiedTimestamp)return;tt(this,u).set(t.key,{value:t.value,lastWriterClientId:t.clientId,modifiedTimestamp:t.timestamp}),null==(e=tt(this,r))||e.set(t.key,t.value)}if(null==(s=t.route)||!s.includes(tt(this,a)))return void 0!==t.toSubscriptionId?it(this,b,M).call(this,t):void 0!==t.toClientId?it(this,b,W).call(this,t):it(this,b,D).call(this,t)},y=function(t,e){switch(e.kind){case"publish":it(this,b,I).call(this,e);break;case"subscribe":it(this,b,w).call(this,t,e);break;case"unsubscribe":it(this,b,_).call(this,t,e);break;case"handshake":it(this,b,g).call(this,t,e)}},I=function(t){var e,s,i;const o=tt(this,u).get(t.key);void 0!==o&&t.timestamp>=o.modifiedTimestamp&&(tt(this,u).set(t.key,{value:t.value,lastWriterClientId:t.clientId,modifiedTimestamp:t.timestamp}),null==(e=tt(this,r))||e.set(t.key,t.value));const l=((t,e)=>F(t,G(e)))(Q({},t),{route:[...null!=(s=t.route)?s:[],tt(this,a)]});void 0!==t.toClientId?it(this,b,W).call(this,l):it(this,b,D).call(this,l),null==(i=tt(this,n))||i.send(l)},g=function(t,e){var s,i;const o=tt(this,p).get(t);if(void 0!==o){for(const s of e.subscriptions)it(this,b,S).call(this,{key:s.key,portId:t,timestamp:s.timestamp,clientId:s.clientId,subscriptionId:s.subscriptionId});for(const t of e.retainedValues)tt(this,u).set(t.key,{value:t.value,lastWriterClientId:t.clientId,modifiedTimestamp:t.timestamp}),null==(s=tt(this,r))||s.set(t.key,t.value);o.outbound({kind:"handshake-ack",id:e.id}),null==(i=tt(this,n))||i.send(e)}else(0,R.P)("No port for handshake message",t)},w=function(t,e){var s;tt(this,h).has(e.subscriptionId)?(0,R.P)("Subscription with this id already exists",e.subscriptionId):(it(this,b,S).call(this,Q({portId:t},e)),void 0!==e.retain&&it(this,b,P).call(this,e,e.retain.value,t),null==(s=tt(this,n))||s.send(e))},S=function(t){const e={key:t.key,portId:t.portId,timestamp:t.timestamp,clientId:t.clientId};tt(this,h).set(t.subscriptionId,e);let s=tt(this,d).get(t.key);void 0===s&&(s=new Set,tt(this,d).set(t.key,s)),s.add(t.subscriptionId)},P=function(t,e,s){var i,n,o,l,c;if("write"===(null==(i=t.retain)?void 0:i.kind)&&t.timestamp>=(null!=(o=null==(n=tt(this,u).get(t.key))?void 0:n.modifiedTimestamp)?o:Number.MIN_SAFE_INTEGER)&&!(0,L._)(e,null==(l=tt(this,u).get(t.key))?void 0:l.value))tt(this,u).set(t.key,{value:e,lastWriterClientId:t.clientId,modifiedTimestamp:t.timestamp}),null==(c=tt(this,r))||c.set(t.key,e),void 0!==tt(this,p).get(s)&&it(this,b,D).call(this,{kind:"publish",key:t.key,value:e,timestamp:t.timestamp,clientId:t.clientId,route:[tt(this,a)],excludeSubscriptionId:t.subscriptionId});else{const i=tt(this,u).get(t.key);if(void 0===i)return;void 0!==tt(this,p).get(s)&&!(0,L._)(e,i.value)&&it(this,b,M).call(this,{kind:"publish",key:t.key,value:i.value,timestamp:i.modifiedTimestamp,clientId:i.lastWriterClientId,route:[tt(this,a)],toSubscriptionId:t.subscriptionId})}},_=function(t,e){var s,i;const o=tt(this,h).get(e.subscriptionId);if(void 0===o)return void(0,R.P)("No subscription with this id",e.subscriptionId);if(o.portId!==t)return void(0,R.P)("Subscription does not belong to this port",e.subscriptionId,t);tt(this,h).delete(e.subscriptionId);const a=tt(this,d).get(o.key);void 0!==a&&(a.delete(e.subscriptionId),0===a.size&&(tt(this,d).delete(o.key),tt(this,u).delete(o.key),null==(s=tt(this,r))||s.delete(o.key))),null==(i=tt(this,n))||i.send(e)},M=function(t){const e=tt(this,h).get(t.toSubscriptionId);if(void 0===e)return void(0,R.P)("No subscription with this id",t.toSubscriptionId);const s=tt(this,p).get(e.portId);void 0!==s?s.outbound(t):(0,R.P)("No port for subscription with this id",t.toSubscriptionId)},W=function(t){const e=it(this,b,C).call(this,t.key,t.toClientId,void 0);for(const s of e)s.outbound(t)},D=function(t){const e=it(this,b,C).call(this,t.key,void 0,t.excludeSubscriptionId);for(const s of e)s.outbound(t)},C=function(t,e,s){const i=new Set,n=tt(this,d).get(t);for(const t of null!=n?n:[]){if(void 0!==s&&t===s)continue;const n=tt(this,h).get(t);if(void 0===n||void 0!==e&&e!==n.clientId)continue;const o=tt(this,p).get(n.portId);void 0!==o&&i.add(o)}return i};class ot{constructor(t){var e;et(this,E),et(this,B,new DisposableStack),et(this,x),et(this,j),et(this,T,tt(this,B).use(new V.x)),et(this,$,[]),et(this,O),st(this,j,t.send),st(this,O,t.shouldBufferMessages),tt(this,B).defer((()=>t.notifyDispose())),st(this,x,null!=(e=t.tracingOptions)?e:{enabled:!1}),this.portId=t.portId}send(t){it(this,E,N).call(this,"inbound",t),tt(this,O)&&"handshake"!==t.kind?tt(this,$).push(t):(it(this,E,A).call(this),tt(this,j).call(this,t))}subscribe(t){const e=new DisposableStack;return tt(this,B).defer((()=>e.dispose())),e.use(tt(this,T).subscribe({next:t,complete:()=>e.dispose()})),e}[Symbol.dispose](){tt(this,B).dispose()}outbound(t){it(this,E,N).call(this,"outbound",t),tt(this,T).next(t)}setBufferingEnabled(t){st(this,O,t),t||it(this,E,A).call(this)}}B=new WeakMap,x=new WeakMap,j=new WeakMap,T=new WeakMap,$=new WeakMap,O=new WeakMap,E=new WeakSet,A=function(){if(tt(this,$).length>0){for(const t of tt(this,$))tt(this,j).call(this,t);tt(this,$).length=0}},N=function(t,e){}},44428:(t,e,s)=>{function i(t,e){if(t===e)return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;if(Array.isArray(t)&&Array.isArray(e))return t.length===e.length&&t.every(((t,s)=>i(t,e[s])));if(Array.isArray(t)!==Array.isArray(e))return!1;const s=Object.keys(t),n=new Set(Object.keys(e));if(s.length!==n.size)return!1;for(const o of s)if(!n.has(o)||!i(t[o],e[o]))return!1;return!0}s.d(e,{_:()=>i})},57780:(t,e,s)=>{s.d(e,{b:()=>o});var i=s(1651),n=s(50204);const o={events:{documentSessionDisposed:(0,i.d)()},state:{activeTabId:(0,n.x)(),"activeDocument/:tabId":(0,n.x)(),lastActivePanelAgentId:(0,n.x)(),activePanelAgentId:(0,n.x)()}}},53128:(t,e,s)=>{s.r(e),s.d(e,{DefaultAgentsMessageBusClient:()=>a});var i=s(10556),n=s(57780),o=s(9486),r=s(77784);class a{constructor(t){this._disposables=new DisposableStack,this._messageBusRouter=this._disposables.use(new o.o({message:t.message,routerName:(0,r.rL)(t.script,t.tabId)})),this.platformBus=this._disposables.use((0,i.kX)({port:this._messageBusRouter.createPort({name:(0,r.wS)(t.script,t.tabId)}),clientId:(0,r.EZ)(t.script,t.tabId),keyPrefix:(0,r.e7)(),protocol:n.b}))}createPort(...t){return this._messageBusRouter.createPort(...t)}[Symbol.dispose](){this._disposables.dispose()}}},9486:(t,e,s)=>{s.d(e,{o:()=>d});var i=s(74822),n=s(21070),o=s(79256),r=s(18519),a=s(71051),l=s(90150),c=s(24978),h=s(9621);class d{constructor(t){this._init=t,this._baseDisposables=new DisposableStack,this._reconnectSubject=new i.x,this._volatileMessageBusServerPort=this._baseDisposables.use((0,h.S)(this._init.message,(()=>this._reconnectSubject.next()))),this._messageBusServerPort=this._baseDisposables.use(new l.S(this._volatileMessageBusServerPort)),this._messageBusContentScriptRouter=this._baseDisposables.use(new c.C({tracingOptions:{enabled:!1,color:"green"},serverPort:this._messageBusServerPort,name:this._init.routerName})),this._baseDisposables.adopt(this._reconnectSubject.pipe((0,n.z)((()=>(0,o.P)((()=>(this._volatileMessageBusServerPort=this._baseDisposables.use((0,h.S)(this._init.message,(()=>this._reconnectSubject.next()))),this._messageBusServerPort.connectToServerPort(this._volatileMessageBusServerPort),this._messageBusContentScriptRouter.connect()))).pipe((0,r.V)(1e3),(0,a.X)({count:5}))))).subscribe(),(t=>t.unsubscribe()))}createPort(...t){return this._messageBusContentScriptRouter.createPort(...t)}[Symbol.dispose](){this._baseDisposables.dispose()}}},77784:(t,e,s)=>{function i(){return"agents/@impl"}function n(t){return`agents/${t}`}function o(t,...e){return r(t,...e)}function r(t,...e){return`agents/@impl/${t}${h(e)}`}function a(t,e,...s){return l(t,e,...s)}function l(t,e,...s){return`${n(t)}/${e}${h(s)}`}function c(t,...e){return`agents/${t}${h(e)}`}function h(t){const e=t.filter(Boolean).join("/");return e?`/${e}`:""}s.d(e,{EZ:()=>r,Lu:()=>n,Yx:()=>l,e7:()=>i,rL:()=>c,wS:()=>o,yp:()=>a})},9621:(t,e,s)=>{s.d(e,{S:()=>o});var i=s(74822),n=s(99161);function o(t,e){const s=new DisposableStack,o=t.createPortConnection(n.Tt.messageBusPort),r=new i.x;return o.onDisconnect((()=>{s.disposed||e()})),o.onMessage((t=>{s.disposed||r.next(t)})),{send:t=>{s.disposed||o.postMessage(t)},subscribe:t=>{const e=s.use(new DisposableStack);return e.adopt(r.subscribe(t),(t=>t.unsubscribe())),e},[Symbol.dispose]:()=>s.dispose()}}}}]);